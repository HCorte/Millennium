      PROGRAM OLMCON
        IMPLICIT NONE
        INCLUDE 'INCLIB:SYSDEFINE.DEF'
        INCLUDE 'INCLIB:GLOBAL.DEF'
        INCLUDE 'INCLIB:PROCOM.DEF'
        INCLUDE 'INCLIB:TASKID.DEF'  
        INCLUDE 'INCLIB:QUECOM.DEF'      
C        INCLUDE 'OLMCON.DEF'

        CHARACTER YN, ALLONE, BLOCKBUF
        LOGICAL RUNPROG /.TRUE./ 
        INTEGER*4 APULST(3),LOGLST(3),PSTLST(3)
      
11      CONTINUE
        IF(RUNPROG) THEN
          PRINT *, 'THIS PROGRAM IS TO REMOVE A BUFFER FROM APPLICATION QUEUE, CONTINUE THE PROGRAMA (Y/N) or W for watch?'
          READ *, YN
          
          IF(YN .EQ. 'Y' .OR. YN .EQ. 'y') THEN

            PRINT *, 'REMOVE ALL BUFFER (A or a) OR ONE BUFFER (O or o)'
            READ *, ALLONE
            IF(ALLONE .EQ. 'A' .OR. ALLONE .EQ. 'a') THEN   
                PRINT *, 'REMOVE ALL (A) or BLOCK OF BUFFS (B)'  
                READ *, BLOCKBUF
                IF(BLOCKBUF .EQ. 'A' .OR. BLOCKBUF .EQ. 'a') THEN           
                  CALL RALLBUFFS_FROMAPPQUEUE(QUETAB(1,DIS),.FALSE.)
                ELSE 
                  CALL RALLBUFFS_FROMAPPQUEUE(QUETAB(1,DIS),.TRUE.)       
                ENDIF
            ELSEIF (ALLONE .EQ. 'O' .OR. ALLONE .EQ. 'o') THEN
                CALL RBUFF_FROMAPPQUEUE(QUETAB(1,DIS))
            ELSE 
                CALL RBUFF_FROMAPPQUEUE(QUETAB(1,DIS))
            ENDIF
          
            GOTO 11
          ENDIF
C          IF(YN .EQ. 'W' .OR. YN .EQ. 'w') THEN
C            CALL QIMAGE(QUETAB(1,APU),APULST,3)
C            CALL QIMAGE(QUETAB(1,LOG),LOGLST,3)
C            CALL QIMAGE(QUETAB(1,PST),PSTLST,3)
C            PRINT *, 'LIST OF BUFFERS APU -- LOG -- PST'
C            PRINT 100,APULST(1),LOGLST(1),PSTLST(1)
C            PRINT 101,APULST(2),LOGLST(2),PSTLST(2)
C            PRINT 101,APULST(3),LOGLST(3),PSTLST(3)           
C            GOTO 11
C          ENDIF
          IF(YN .EQ. 'N' .OR. YN .EQ. 'n') THEN
            RUNPROG = .FALSE.
          ENDIF
        ENDIF
        PRINT *,'PROGRAM AS ENDED...'

C100	FORMAT(1X,'<',I4.0,'>',3X,'<',I4.0,'>',3X,'<',I4.0,'>')
C101	FORMAT(2X,I4.0,5X,I4.0,5X,I4.0)        

      END

      SUBROUTINE RBUFF_FROMAPPQUEUE(LIST)
        IMPLICIT NONE  
        INCLUDE 'INCLIB:SYSDEFINE.DEF'
        INCLUDE 'INCLIB:GLOBAL.DEF'
        INCLUDE 'INCLIB:PROCOM.DEF'   
        INCLUDE 'INCLIB:TASKID.DEF'  
        INCLUDE 'INCLIB:QUECOM.DEF'
	INCLUDE 'INCLIB:GLIST.DEF'                     
C        INCLUDE 'OLMCON.DEF'

        INTEGER*4 OPT,ST, BUFNUM, STAT
	INTEGER*4 LIST(*)        
C        CHARACTER QUEUE
        INTEGER*4 QUEUE, APPQUEUESIZE

10	CONTINUE    


        CALL LISTSIZE(QUETAB(1,DIS),APPQUEUESIZE)
        PRINT *, 'APP QUEUE SIZE:', APPQUEUESIZE

        PRINT *, 'ENTER BUFFER NUM TO REMOVE AND FREE:'
        READ *, BUFNUM
        PRINT *, BUFNUM
C        PRINT *, 'ENTER QUEUE NAME FROM WHICH THE BUFFER IS AT THE MOMENT:'
C        READ *, QUEUE
C        PRINT *, QUEUE

C        QUEUE = QUETAB(1,DIS)


        CALL RTL (BUFNUM, QUETAB(1,DIS), STAT)
        IF (STAT .EQ. GLIST_STAT_EMPTY) THEN
          BUFNUM = 0
        ENDIF 
        CALL RELBUF(BUFNUM)
        
        PRINT *, 'REMOVEL STATUS:', STAT
        IF(STAT .EQ. GLIST_STAT_EMPTY) PRINT *, 'APPLICATION QUEUE LIST EMPTY...'
        IF(STAT .EQ. GLIST_STAT_GOOD) PRINT *, 'REMOVED BUFFER FROM APPLICATION QUEUE FY =)'
        IF(STAT .EQ. GLIST_STAT_LASTONE) PRINT *, 'LAST BUFFER FROM THE APPLICATION QUEUE GOOD TO GO'

C        CALL LIST_SIZE(QUETAB(1,DIS))
        CALL LISTSIZE(QUETAB(1,DIS),APPQUEUESIZE)
        PRINT *, 'APP QUEUE SIZE:', APPQUEUESIZE        

      END      

      SUBROUTINE RALLBUFFS_FROMAPPQUEUE(LIST,ALLBLOCK)
        IMPLICIT NONE  
        INCLUDE 'INCLIB:SYSDEFINE.DEF'
        INCLUDE 'INCLIB:GLOBAL.DEF'
        INCLUDE 'INCLIB:PROCOM.DEF'   
        INCLUDE 'INCLIB:TASKID.DEF'  
        INCLUDE 'INCLIB:QUECOM.DEF'
	INCLUDE 'INCLIB:GLIST.DEF'                     
C        INCLUDE 'OLMCON.DEF'

        INTEGER*4 OPT,ST, BUFNUM, STAT
	INTEGER*4 LIST(*)        
C        CHARACTER QUEUE
        INTEGER*4 QUEUE, APPQUEUESIZE /0/
        INTEGER*4 MAX_LENGTH /20/
	INTEGER*4 I, LIMIT, TOP, USED
        INTEGER*4 IND
        LOGICAL ALLBLOCK

10	CONTINUE    

        TOP = LIST(GLIST_TOP)
C        CALL LIST_SIZE(QUETAB(1,DIS))
        CALL LISTSIZE(QUETAB(1,DIS),USED)
        PRINT *, 'APP QUEUE SIZE:', USED 
      
        IND = TOP
        DO 20 I = 1, USED
          IND = IND + 1
          IF(IND.GT.LIST( GLIST_MAX_OFFSET))THEN
            IND = GLIST_START
          ENDIF
          PRINT *, 'DISPAT BUFFER POS',I , ' : ' ,LIST(IND)

          CALL RTL (BUFNUM, QUETAB(1,DIS), STAT)
          IF (STAT .EQ. GLIST_STAT_EMPTY) THEN
            BUFNUM = 0
          ENDIF 
          CALL RELBUF(BUFNUM)
          
C          PRINT *, 'REMOVEL STATUS:', STAT
          IF(STAT .EQ. GLIST_STAT_EMPTY) PRINT *, 'APPLICATION QUEUE LIST EMPTY...'
          IF(STAT .EQ. GLIST_STAT_GOOD) PRINT *, 'REMOVED BUFFER FROM APPLICATION QUEUE FY =)'
          IF(STAT .EQ. GLIST_STAT_LASTONE) PRINT *, 'LAST BUFFER FROM THE APPLICATION QUEUE GOOD TO GO'

          IF(ALLBLOCK) THEN
            IF(I.GT.MAX_LENGTH ) GOTO 9000
          ENDIF
20	CONTINUE
C
9000	CONTINUE

C        CALL LIST_SIZE(QUETAB(1,DIS))
        CALL LISTSIZE(QUETAB(1,DIS),USED)
        PRINT *, 'APP QUEUE SIZE:', USED        

      END

      SUBROUTINE LIST_SIZE (LIST_ARRAY)
        IMPLICIT NONE    
        INCLUDE 'INCLIB:SYSPARAM.DEF'
        INCLUDE	'INCLIB:SYSEXTRN.DEF'
        INCLUDE 'INCLIB:GLIST.DEF'
        
        
        INTEGER*4 LIST_ARRAY(:)
        INTEGER*4 APPQUEUESIZE /0/
        
        APPQUEUESIZE = size(LIST_ARRAY)
        PRINT *, 'APP QUEUE SIZE:', APPQUEUESIZE

      END

