C
C SUBROUTINE OLMSNP
C
C
C VIS_OLMSNP.FOR
C
C V03 30-MAR-2016 SCML M16 PROJECT
C V02 20-JUL-2015 SCML Adding support for IGS internal cancel flags
C V01 08-APR-2014 SCML Placard Project
C
C EUR SYSTEM CONTROL SNAPSHOT
C
C
C ERROR MESSAGE #  DESCRIPTION
C ---------------  -----------------------------------------------------
C       5          PASSWORD ERROR WHILE TRYING TO CHANGE EM TIMEOUT
C       6          PASSWORD ERROR WHILE TRYING TO CHANGE EM FIN TIMEOUT
C
C
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C Copyright 2016 SCML Corporation. All rights reserved.
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C
C=======OPTIONS /CHECK=NOOVERFLOW/EXT
SUBROUTINE OLMSNP(CLINE, EGAM)
    IMPLICIT NONE
C
    INCLUDE 'INCLIB:SYSPARAM.DEF'
    INCLUDE 'INCLIB:SYSEXTRN.DEF'
C
    INCLUDE 'INCLIB:GLOBAL.DEF'
    INCLUDE 'INCLIB:PRMLOG.DEF'
    INCLUDE 'INCLIB:AGTINF.DEF'
    INCLUDE 'INCLIB:PRMAGT.DEF'
    INCLUDE 'INCLIB:VISCOM.DEF'
    INCLUDE 'INCLIB:CONCOM.DEF'
    INCLUDE 'INCLIB:PROCOM.DEF'
    INCLUDE 'INCLIB:TASKID.DEF'
    INCLUDE 'INCLIB:ENCCOM.DEF'
    INCLUDE 'INCLIB:QUECOM.DEF'
    INCLUDE 'INCLIB:X2XQUE.DEF'
    INCLUDE 'INCLIB:GTNAMES.DEF'
    INCLUDE 'INCLIB:OLMCOM.DEF' !New Memory for Olimpo Communication channel          
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C       INPUT ARGUMENTS
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    INTEGER*4  CLINE(20)
    INTEGER*4  EGAM    !EXTERNAL GAME NUMBER (IN EUROMILLIONS SYSTEM)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C       LOCAL VARIABLES
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
    INTEGER*4  GSOLM    !GAME SUPRESS (LI, Totoloto and Totobola from Olimpo)
    INTEGER*4  GSGRR    !GAME SUPRESS GAME RESULTS REPORT
    INTEGER*4  GSICA    !GAME SUPRESS INTERNAL CANCELLATION

    INTEGER*4 OLMLST(3),OLMTTL        
    INTEGER*4  BUF(CDLEN)     
    INTEGER*4  MESS(EDLEN)          
    CHARACTER*7  DEFTPASS                                                   !DEFAULT PASSWORD
    CHARACTER*7  PASSENT                                                    !ENTERED PASSWORD
    INTEGER*4  VALUE
    INTEGER*4  POS
C
    INTEGER*4  MAXPRM
    PARAMETER (MAXPRM=22)
C
    REAL*8       K(MAXPRM)                                                  !SNAPSHOT PARAMETER DESCRIPTION
C


C
    DATA   K/'COMOLM  ','OLMCOn  ','OLMTMo  ','FINTMo  ',
 *           'SUPOLm  '/
    DATA DEFTPASS/'SUPORTE'/
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C       BEGIN PROCESS
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    MESS(1) = 63 !que é este valor do euromil???
    MESS(2) = TEOLM
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C EURSNP INPUT
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC  
    VALUE = 0
    !TEMP  = 0 parece que esta variavel não está a ser usada no euromil
    POS   = 1      
    CALL KEY(CLINE,K,MAXPRM,POS,KEYNUM)
C
    IF(POS.GT.40) GOTO 300                                                  !NO INPUT
    IF(KEYNUM.EQ.0)GOTO 200                                                 !INPUT ERROR        
C
    CALL NUMB(CLINE,POS,VALUE)                                              !GET VALUE
    IF(VALUE.LT.0)  GOTO 205        

CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C       BUILD OLMSNP SCREEN IMAGE
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
300     CONTINUE
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C       GET BUFFER UTILIZATION INFORMATION 
C       To do Later(press BUF followed by the number of buffs used to show)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
    CALL QIMAGE(QUETAB(1,OLM),OLMLST,3)
C        CALL LISTSIZE(QUETAB(1,OLM),OLMTTL)                            !COMOLM
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C      GET GAME FLAGS
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
   WRITE(CLIN4,904)OLMLST(1)
   WRITE(CLIN5,905)OLMLST(2)
   WRITE(CLIN6,905)OLMLST(3)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C force some changes to enter pass first the allow those changes
C
506     CONTINUE
    CALL PASSWORD(5,PASPAS)
    IF (PASSENT .NE. DEFTPASS) THEN
      MESS(3) = 5
      CALL QUEMES(MESS)
      GOTO 206
    ENDIF
    IF(VALUE.LT.1.OR.VALUE.GT.50) GOTO 2051
    BUF(1)=IGSTOUT
    BUF(2)=VALUE
    BUF(3)=TCPAR
    GOTO 250
C
C INVALID PASSWORD
C
206     CONTINUE
    WRITE(CLIN23,802)
802     FORMAT('Invalid Password')

    RETURN
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
904     FORMAT(1X,'<',I4.0,'>')
905     FORMAT(2X,I4.0)        
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C       DISPLAY SYSTEM STATS
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C        WRITE(CLIN16,950)
C        WRITE(CLIN17,9501) EURS_NXTXRF,                                         !NEXT CROSS REFERENCE NUMBER
C     *                     EURS_TOTEURTMO,                                      !TOTAL # OF MESSAGES TIMED OUT
C     *                     EURS_TOTEURATO                                       !TOTAL # OF MESSAGES ALREADY TIMED OUT
C        WRITE(CLIN18,9502) EURS_TOTOKYPUT,                                      !TOTAL # OF MESSAGES SENT TO EUROMILLIONS SYSTEM
C     *                     EURS_TOTOKYGET,                                      !TOTAL # OF MESSAGES RECEIVED FROM EUROMILLIONS SYSTEM
C     *                     EURS_TOTWAGTMO,                                      !TOTAL # OF WAGERS TIMED OUT
C     *                     EURS_TOTWAGATO                                       !TOTAL # OF WAGERS ALREADY TIMED OUD
C        WRITE(CLIN19,9503) EURS_TOTERRPUT,                                      !TOTAL # OF ERRORS WHILE SENDING MESSAGES TO EUROMILLIONS SYSTEM
C     *                     EURS_TOTERRGET,                                      !TOTAL # OF ERRORS WHILE GETTING MESSAGES FROM EUROMILLIONS SYSTEM
C     *                     EURS_TOTCANTMO,                                      !TOTAL # OF CANCELS TIMED OUT
C     *                     EURS_TOTCANATO                                       !TOTAL # OF CANCELS ALREADY TIMED OUT
C        WRITE(CLIN20,9504) EURS_TOTICANOK,                                      !TOTAL # OF INTERNAL CANCELS MESSAGES SENT
C     *                     EURS_TOTICANER,                                      !TOTAL # OF INTERNAL CANCELS MESSAGES FAILED TO SEND
C     *                     EURS_TOTVALTMO,                                      !TOTAL # OF VALIDATIONS TIMED OUT
C     *                     EURS_TOTVALATO                                       !TOTAL # OF VALIDATIONS ALREADY TIMED OUT
C        WRITE(CLIN21,9505) EURS_TOTICANNS,                                      !TOTAL # OF INTERNAL CANCELS MESSAGES NOT SENT
C     *                     EURS_TOTPAYTMO,                                      !TOTAL # OF PAYMENTS TIMED OUT
C     *                     EURS_TOTPAYATO                                       !TOTAL # OF PAYMENTS ALREADY TIMED OUT
C        WRITE(CLIN22,9506) EURS_TOTFINTMO,                                      !TOTAL # OF FINANCIAL REPORTS TIMED OUT (OTHER THAN THE BILLING REPORT)
C     *                     EURS_TOTFINATO                                       !TOTAL # OF FINANCIAL REPORTS ALREAYD TIMED OUT (OTHER THAN THE BILLING REPORT)
C
    RETURN        