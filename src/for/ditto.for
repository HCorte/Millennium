C
C PROGRAM DITTO
C $Log:   GXAFXT:[GOLS]DITTO.FOV  $
C  
C     Rev 1.0   17 Apr 1996 12:55:04   HXK
C  Release of Finland for X.25, Telephone Betting, Instant Pass Thru Phase 1
C  
C     Rev 1.0   21 Jan 1993 16:06:04   DAB
C  Initial Release
C  Based on Netherlands Bible, 12/92, and Comm 1/93 update
C  DEC Baseline
C
C ** Source - ditto.for **
C
C DITTO.FOR
C
C V01 01-AUG-90 XXX REWRITTEN FOR VAX
C
C
C
C
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C This item is the property of GTECH Corporation, Providence, Rhode
C Island, and contains confidential and trade secret information. It
C may not be transferred from the custody or control of GTECH except
C as authorized in writing by an officer of GTECH. Neither this item
C nor the information it contains may be used, transferred,
C reproduced, published, or disclosed, in whole or in part, and
C directly or indirectly, except as expressly authorized by an
C officer of GTECH, pursuant to written agreement.
C
C Copyright 1991 GTECH Corporation. All rights reserved.
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C
C
C=======OPTIONS /CHECK=NOOVERFLOW
	PROGRAM DITTO
	IMPLICIT NONE
C
	INCLUDE 'INCLIB:SYSPARAM.DEF'
	INCLUDE 'INCLIB:SYSEXTRN.DEF'
C
	INTEGER*4 L, BLKX, ERR, OFF, ACTLEN, IJK, J, I, K, STA
	INTEGER*4 NUMBLK, SKPBLK, SKPFIL, NUMOUT, BLKLEN, OUTLUN
	INTEGER*4 BLKNUM, FILNUM, REWFLG, ST, INLEN, TEMP
C
	CHARACTER*80 TAPNAM
	CHARACTER DATATY
	CHARACTER CNULL
	DATA CNULL/Z0/
	CHARACTER     TAPBUF(32768), ANSWER
	CHARACTER*120 OUTPUT(4)
	INTEGER*4     QQ(8192)
	INTEGER*4     FDB(7)
	EQUIVALENCE (TAPBUF(1),QQ(1))
C
C
C
	CHARACTER*20 DEVICE
C
	PARAMETER (INLEN=5)       !OFFSET OF LENGTH READ IN FDB
C
	CHARACTER HEX(0:15)
	DATA HEX /'0','1','2','3','4','5','6','7',
     *	          '8','9','A','B','C','D','E','F'/
C
C
	CALL COPYRITE
C
	REWFLG=0
	FILNUM=1
	BLKNUM=0
C
100	CONTINUE
	CALL WIMG(5,'ENTER MAG TAPE DEVICE NAME: ')
	ACCEPT '(A)',DEVICE
	IF(DEVICE.EQ.'E ')CALL GSTOP(GEXIT_SUCCESS)
	CALL TAPOPEN(FDB,DEVICE,ST)
	IF(ST.NE.0)THEN
	  TYPE *,'CANNOT OPEN THAT DEVICE'
	  GO TO 100
	ENDIF
 
	CALL WIMG(5,'TYPE L TO SPOOL OUTPUT (DEFAULT=CON:) ')
	ACCEPT '(A)',ANSWER
	OUTLUN=5
	IF(ANSWER.EQ.'L')OUTLUN=2
C
C
C
	CALL WIMG(5,'ENTER DATA TYPE (A=ASCII,E=EBCDIC)(DEF=A): ')
	ACCEPT '(A)',DATATY
	IF(DATATY.NE.'E') DATATY='A'
C
	CALL WIMG(5,'ENTER TAPE NAME FOR REPORT: ')
	ACCEPT '(A)',TAPNAM
C
C
	BLKLEN=32768
2000	CONTINUE
	CALL WIMG(5,'REWIND? (E=EXIT)(DEF=N): ')
	ACCEPT '(A)',ANSWER
	IF(ANSWER.EQ.'E')CALL GSTOP(GEXIT_SUCCESS)
	IF(ANSWER.EQ.'Y') THEN
	  REWFLG=0
	ELSE
	  REWFLG=1
	ENDIF
C
C***	IF(OUTLUN.NE.2) GO TO 2400
C***	OPEN (2,FILE='PR:',RECL=131)
C
2400	CONTINUE
	NUMOUT=12               !FORCE HEAD OF FORM
C
	CALL WIMG(5,'NUMBER OF FILES TO SKIP (DEF=0): ')
	ACCEPT 9003,SKPFIL
	FILNUM=FILNUM+SKPFIL
	CALL WIMG(5,'NUMBER OF BLOCKS TO SKIP (DEF=0): ')
	ACCEPT 9003,SKPBLK
	BLKNUM=BLKNUM+SKPBLK
	IF(SKPFIL.NE.0)BLKNUM=SKPBLK
	CALL WIMG(5,'NUMBER OF BLOCKS TO DUMP (DEF=0): ')
	ACCEPT 9003,NUMBLK
9003	FORMAT(BN,I5)
C
C
	CALL TAPINT(FDB,1,BLKLEN)
	IF(REWFLG.EQ.0) THEN
	  CALL XREWIND(FDB,STA)
	  REWFLG=1
	  FILNUM=SKPFIL+1
	  BLKNUM=SKPBLK
	ENDIF
C
C
C
	IF(SKPFIL.GT.0)THEN
	  DO 3010 K=1,SKPFIL
	    CALL FEOT(FDB,STA)
3010	  CONTINUE
	ELSE IF(SKPFIL.LT.0) THEN
	  DO 3015 K=-1,SKPFIL,-1
	    CALL BEOT(FDB,STA)
3015	  CONTINUE
	ENDIF
	IF(SKPBLK.GT.0)THEN
	  DO 3020 K=1,SKPBLK
	    CALL FORWRD(FDB,STA)
3020	  CONTINUE
	ELSE IF(SKPBLK.LT.0)THEN
	  DO 3025 K=-1,SKPBLK,-1
	    CALL BACK(FDB,STA)
3025	  CONTINUE
	ENDIF
C
	OUTPUT(1)=' '
	OUTPUT(2)=' '
	OUTPUT(3)=' '
	OUTPUT(4)=' '
C
	DO 5000 IJK=1,NUMBLK
C
	CALL RTAPEW(FDB,QQ,STA)
	BLKNUM=BLKNUM+1
	IF(STA.EQ.'88'X)THEN
	  IF(NUMOUT.GE.12)THEN
	    WRITE(OUTLUN,9009)TAPNAM
	    NUMOUT=0
	  ENDIF
	  WRITE(OUTLUN,9011)FILNUM,BLKNUM
9011	  FORMAT(/,' FILE:BLK',I3,':',I5,' *** T A P E M A R K ***'///)
	  NUMOUT=NUMOUT+1
	  FILNUM=FILNUM+1
	  BLKNUM=0
	  GO TO 5000
	ENDIF
C
	IF(STA.LT.0) TYPE *,'ERROR ON READ=',STA
C
	ACTLEN=FDB(INLEN)
	DO 4000 J=1,ACTLEN
	  OFF=MOD(J-1,100)+20
	  TEMP=ICHAR(TAPBUF(J))
	  OUTPUT(1)(OFF:OFF) = TAPBUF(J)
	  OUTPUT(2)(OFF:OFF) = HEX(ISHFT(TEMP,-4))
	  OUTPUT(3)(OFF:OFF) = HEX(IAND (TEMP,'0F'X))
	  IF(J.NE.ACTLEN.AND.OFF.NE.119) GO TO 4000
 
	  IF(DATATY.EQ.'E')THEN
	    CALL EBCASC(OUTPUT(1)(1:OFF),ERR)
	  ELSE
	    CALL ASCASC(OUTPUT(1)(1:OFF),ERR)
	  ENDIF
C
	  BLKX=(J-1)/100
	  WRITE  (OUTPUT(4),9012)BLKX,((K*10),K=1,MAX(1, (OFF-19)/10) )
9012	  FORMAT(13X,I5,'01',5H.....,I4,9(6H......,I4))
C
	  IF(J.LE.119.OR.NUMOUT.GE.12)THEN
	    WRITE (OUTPUT(1)(1:17),9013)FILNUM,BLKNUM
9013	    FORMAT('FILE:BLK',I3,':',I5)
	  ELSE
	    OUTPUT(1)(1:17)=' '
	  ENDIF
C
	  IF(NUMOUT.GE.12)THEN
	    WRITE(OUTLUN,9009)TAPNAM
9009	    FORMAT('1',' DITTO DUMP OF: ',80A1,//)
	    NUMOUT=0
	  ENDIF
C
3100	  CONTINUE
	  IF(OUTLUN.EQ.2)THEN
	    WRITE(2,9010)( OUTPUT(L)(1:119),L=1,4 )
9010	    FORMAT( 4(/,X,A) )
	  ELSE
	    WRITE(OUTLUN,9010) ( OUTPUT(L)( 1: 69),L=1,4 )
	    WRITE(OUTLUN,90101)( OUTPUT(L)(70:119),L=1,4 )
90101	    FORMAT( 4(/,X,19X,A) )
	  ENDIF
C
	  NUMOUT=NUMOUT+1
C
	  OUTPUT(1) = ' '
	  OUTPUT(2) = ' '
	  OUTPUT(3) = ' '
	  OUTPUT(4) = ' '
C
C
4000	CONTINUE
C
5000	CONTINUE
C
	GO TO 8000
C
8000	IF(OUTLUN.EQ.2) CLOSE(2)
	GO TO 2000
C
	END
