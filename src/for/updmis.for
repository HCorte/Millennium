C
C SUBROUTINE UPDMIS
C $Log:   GXAFXT:[GOLS]UPDMIS.FOV  $
C  
C     Rev 1.0   17 Apr 1996 15:43:22   HXK
C  Release of Finland for X.25, Telephone Betting, Instant Pass Thru Phase 1
C  
C     Rev 1.3   15 Nov 1993 20:02:32   GXA
C  Added Opinion Poll updating.
C  
C     Rev 1.2   19 Aug 1993 21:55:02   HXK
C  fixed bug with update of instant validations
C  
C     Rev 1.1   25 Jun 1993 17:18:26   HXK
C  ADDED INSTANT AND OTHER MISCELLANEOUS FUNCTIONS
C  
C     Rev 1.0   21 Jan 1993 17:58:14   DAB
C  Initial Release
C  Based on Netherlands Bible, 12/92, and Comm 1/93 update
C  DEC Baseline
C
C ** Source - updmis.for **
C
C UPDMIS.FOR
C
C V01 01-AUG-90 XXX RELEASED FOR VAX
C
C V02 24-MAY-90  TFH     TAKING IT OUT FOR DENMARK
C V01 04-OCT-89  LOU R   INITIAL RELEASE FOR FINLAND.
C
C FINANCIAL UPDATE SUBROUTINE FOR MISCELLANEOUS NON LOTTERY FUNCTIONS
C
C CALLING SEQUENCE
C     CALL UPDMIS(TRABUF)
C INPUT
C     TRABUF - INTERNAL FORMAT OF TRANSACTION
C OUTPUT
C     NONE
C
C
C
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C This item is the property of GTECH Corporation, Providence, Rhode
C Island, and contains confidential and trade secret information. It
C may not be transferred from the custody or control of GTECH except
C as authorized in writing by an officer of GTECH. Neither this item
C nor the information it contains may be used, transferred,
C reproduced, published, or disclosed, in whole or in part, and
C directly or indirectly, except as expressly authorized by an
C officer of GTECH, pursuant to written agreement.
C
C Copyright 1993 GTECH Corporation. All rights reserved.
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C
C=======OPTIONS /CHECK=NOOVERFLOW
	SUBROUTINE UPDMIS(TRABUF)
	IMPLICIT NONE
C
	INCLUDE 'INCLIB:SYSPARAM.DEF'
	INCLUDE 'INCLIB:SYSEXTRN.DEF'
	INCLUDE 'INCLIB:GLOBAL.DEF'
	INCLUDE 'INCLIB:DESTRA.DEF'
	INCLUDE 'INCLIB:AGTCOM.DEF'
	INCLUDE 'INCLIB:CONCOM.DEF'

        INTEGER*4 TYPE, STAT, TER, ITMNUM, AMOUNT, IGMNUM
        INTEGER*4 COUNT, CNTITM



        TYPE=TRABUF(TSFUN)
        STAT=TRABUF(TSTAT)
        TER=TRABUF(TTER)
        IF(STAT.NE.GOOD) GOTO 9000
        IF(TYPE.EQ.TITEMS) GOTO 1000      !MISCELANEOUS ITEM SALE
        IF(TYPE.EQ.TINSS)  GOTO 2000      !INSTANT TICKET SALE
        IF(TYPE.EQ.TINSV)  GOTO 3000      !INSTANT TICKET VALIDATION
        IF(TYPE.EQ.TPCSH)  GOTO 4000      !PETTY CASH TRANSACTION
        IF(TYPE.EQ.TFRC)  GOTO 5000       !FRACTIONAL WAGER
        IF(TYPE.EQ.TUNFRC)GOTO 5000       !UNFRACTION WAGER
	IF(TYPE.EQ.TPOLL) GOTO 6000	  !OPINION POLL TRANSACTION
C
        GOTO 9000
C
C UPDATE AGENT COMMON WITH MISCELLANEOUS ITEM SALES
C
1000    CONTINUE
        ITMNUM=(PRM_NUMINS*2)+TRABUF(TSDT1)
        CNTITM=TRABUF(TSDT3)
        AMOUNT=TRABUF(TSDT2)
        AGTMIS(ITMNUM,1,TER)=AGTMIS(ITMNUM,1,TER)+CNTITM
        AGTMIS(ITMNUM,2,TER)=AGTMIS(ITMNUM,2,TER)+AMOUNT
        GOTO 9000
C
C UPDATE AGENT COMMON WITH INSTANT TICKET SALE
C
2000    CONTINUE
        IGMNUM=TRABUF(TSDT1)
        AMOUNT=TRABUF(TSDT3)
        AGTMIS(IGMNUM,1,TER)=AGTMIS(IGMNUM,1,TER)+TRABUF(TSDT2)
        AGTMIS(IGMNUM,2,TER)=AGTMIS(IGMNUM,2,TER)+AMOUNT
        GOTO 9000
C
C UPDATE AGENT COMMON WITH INSTANT TICKET VALIDATION
C
3000    CONTINUE
        IGMNUM=PRM_NUMINS+TRABUF(TSDT1)
        AMOUNT=TRABUF(TSDT2)
        COUNT=1
        IF(AMOUNT.LT.0) COUNT=-1
        AGTMIS(IGMNUM,1,TER)=AGTMIS(IGMNUM,1,TER)+COUNT
        AGTMIS(IGMNUM,2,TER)=AGTMIS(IGMNUM,2,TER)+AMOUNT
        GOTO 9000
C
C UPDATE AGENT COMMON WITH PETTY CASH TRANSACTION
C
4000    CONTINUE
        ITMNUM=(PRM_NUMINS*2)+PRM_NUMISAL+TRABUF(TSDT2)
        AGTMIS(ITMNUM,1,TER)=AGTMIS(ITMNUM,1,TER)+TRABUF(TSDT3)
        AGTMIS(ITMNUM,2,TER)=AGTMIS(ITMNUM,2,TER)+TRABUF(TSDT1)
        GOTO 9000
C
C UPDATE AGENT COMMON WITH FRACTIONAL WAGERING
C
5000    CONTINUE
        AGTTAB(ALSTRA,TER)=TRABUF(TSER)
        AGTHTB(ATRNUM,TER)=TRABUF(TTRN)
        AGTHTB(ACHKSM,TER)=-1
	GOTO 9000
C
C UPDATE AGENT COMMON WITH OPINION POLL DATA
C
6000	CONTINUE
        AGTTAB(ALSTRA,TER)=TRABUF(TSER)
        AGTHTB(ATRNUM,TER)=TRABUF(TTRN)
        AGTHTB(ACHKSM,TER)=-1
	AGTTAB(AGTLKN,TER)= TRABUF(TSDT1)
C
C COMMON RETURN
C
9000    CONTINUE
        RETURN
        END
