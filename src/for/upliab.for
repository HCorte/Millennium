C
C SUBROUTINE UPLIAB
C $Log:   GXAFXT:[GOLS]UPLIAB.FOV  $
C  
C     Rev 1.0   17 Apr 1996 15:44:28   HXK
C  Release of Finland for X.25, Telephone Betting, Instant Pass Thru Phase 1
C  
C     Rev 1.0   21 Jan 1993 17:58:58   DAB
C  Initial Release
C  Based on Netherlands Bible, 12/92, and Comm 1/93 update
C  DEC Baseline
C
C ** Source - upliab.for **
C
C UPLIAB.FOR
C
C V02 07-OCT-91 MTK INITAL RELEASE FOR NETHERLANDS
C V01 01-AUG-90 XXX RELEASED FOR VAX
C
C
C
C
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C This item is the property of GTECH Corporation, Providence, Rhode
C Island, and contains confidential and trade secret information. It
C may not be transferred from the custody or control of GTECH except
C as authorized in writing by an officer of GTECH. Neither this item
C nor the information it contains may be used, transferred,
C reproduced, published, or disclosed, in whole or in part, and
C directly or indirectly, except as expressly authorized by an
C officer of GTECH, pursuant to written agreement.
C
C Copyright 1991 GTECH Corporation. All rights reserved.
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C
C=======OPTIONS /CHECK=NOOVERFLOW
	SUBROUTINE UPLIAB(TRABUF,CFLAG,BETOFF,WARN)
	IMPLICIT NONE
C
	INCLUDE 'INCLIB:SYSPARAM.DEF'
	INCLUDE 'INCLIB:SYSEXTRN.DEF'
	INCLUDE 'INCLIB:GLOBAL.DEF'
	INCLUDE 'INCLIB:DESTRA.DEF'
	INCLUDE 'INCLIB:POLCOM.DEF'
	INCLUDE 'INCLIB:CONCOM.DEF'
	INCLUDE 'INCLIB:NBRCOM.DEF'
C
	INTEGER*4  STR, BOX, CMB, WHL
	PARAMETER (STR=1)
	PARAMETER (BOX=2)
	PARAMETER (CMB=3)
	PARAMETER (WHL=4)
C
	INTEGER*4 J ,K, N, DAY, STROFF, BOXOFF, OPT, TYP, AMT, NUM
	INTEGER*4 OFF, SIGN, GIND, PEND, PBEG, BETOFF, UPDCNT
	INTEGER*4 BT3TAB(NUMPL3),BT4TAB(NUMPL4),CMBTAB(24),DAYS(POLDAY)
	LOGICAL CANCEL,LIMIT,CFLAG,WARN
C
C
	DATA BT3TAB/STR,STR,STR,STR,BOX,BOX,CMB,CMB,WHL,WHL/
	DATA BT4TAB/STR,STR,STR,STR,BOX,BOX,BOX,BOX,
     *	            CMB,CMB,CMB,CMB,WHL,WHL,WHL,WHL/
C
C CHECK FOR VALID TRANSACTION
C
	IF(TRABUF(TTYP).NE.TWAG.AND.TRABUF(TTYP).NE.TCAN.AND.
     *     TRABUF(TTYP).NE.TINC) RETURN
	IF(TRABUF(TGAMTYP).NE.TNBR) RETURN
C
C
	PBEG=0
	PEND=0
	LIMIT=.FALSE.
	WARN=.FALSE.
	GIND=TRABUF(TGAMIND)
	PBEG=TRABUF(TWBEG)-NBRDRW(GIND)+1
	PEND=TRABUF(TWEND)-NBRDRW(GIND)+1
	UPDCNT=0
	IF(TRABUF(TWNAND).NE.0) THEN
	  IF(PBEG.GE.1.AND.PBEG.LE.POLDAY) THEN
	    UPDCNT=UPDCNT+1
	    DAYS(UPDCNT)=PBEG
	  ENDIF
	  IF(PEND.GE.1.AND.PEND.LE.POLDAY) THEN
	    UPDCNT=UPDCNT+1
	    DAYS(UPDCNT)=PEND
	  ENDIF
	ELSE
  	  IF(PBEG.LT.1) PBEG=1
	  IF(PEND.GT.POLDAY) PEND=POLDAY
	  IF(PBEG.GT.POLDAY) RETURN
	  IF(PEND.LT.1) RETURN
	  DO 10 J=PBEG,PEND
	  UPDCNT=UPDCNT+1
	  DAYS(UPDCNT)=J
10	  CONTINUE
	ENDIF
	IF(UPDCNT.EQ.0) RETURN
C
C CHECK FOR CANCEL TRANSACTION
C
	SIGN=1
	CANCEL=.FALSE.
	IF(TRABUF(TTYP).EQ.TCAN.OR.TRABUF(TTYP).EQ.TINC) THEN
	  CANCEL=.TRUE.
	  SIGN=-1
	ENDIF
	
C
C
	IF(TRABUF(TWNTYP).EQ.NB3TYP) GOTO 1000
	IF(TRABUF(TWNTYP).EQ.NB4TYP) GOTO 2000
	RETURN
C
C PROCESS 3-DIGIT GAME
C
1000	CONTINUE
	DO 1040 OFF=0,TRABUF(TWNBET)-1
	NUM=TRABUF(TWNNUM1+OFF*3)
	AMT=TRABUF(TWNAMT1+OFF*3)/NBRPRC(GIND)*SIGN
	TYP=TRABUF(TWNPOL1+OFF*3)
	
C
C
	OPT=BT3TAB(TYP)
	IF(OPT.EQ.CMB) AMT=AMT/2
	IF(TYP.EQ.TNB3W3) AMT=AMT/3
	IF(TYP.EQ.TNB3W6) AMT=AMT/6
	BOXOFF=P3OFF(NUM+1,BOXADR)
	STROFF=NUM+PSTR
	IF(TYP.EQ.TNB3F2) STROFF=NUM+PFP2
	IF(TYP.EQ.TNB3B2) STROFF=NUM+PBP2
	IF(TYP.EQ.TNB3S2) STROFF=NUM+PSM2
C
	
C
	DO 1030 K=1,UPDCNT
	DAY=DAYS(K)
	IF(OPT.EQ.STR.OR.OPT.EQ.CMB)
     *	  POOLT(STROFF,DAY,GIND)=POOLT(STROFF,DAY,GIND)+AMT
	IF(OPT.EQ.BOX.OR.OPT.EQ.CMB)
     *	  POOLT(BOXOFF,DAY,GIND)=POOLT(BOXOFF,DAY,GIND)+AMT
	IF(OPT.EQ.WHL) THEN
	  CALL PERM3(NUM,CMBTAB,N)
	  DO 1020 J=1,N
	  STROFF=CMBTAB(J)+PSTR
	  POOLT(STROFF,DAY,GIND)=POOLT(STROFF,DAY,GIND)+AMT
1020	  CONTINUE
	ENDIF
1030	CONTINUE
1040	CONTINUE
	IF(CANCEL.OR.CFLAG.OR.NBRLIM(1,GIND).LT.0) RETURN
C
C CHECK IF LIABILITY LIMIT HAS BEEN EXCEEDED
C
	CALL CHKNUM(TRABUF,UPDCNT,DAYS,LIMIT,BETOFF,WARN)
	IF(LIMIT) THEN
	  TRABUF(TERR)=LIAB
	  TRABUF(TSTAT)=REJT
	  SIGN=-1
	  CANCEL=.TRUE.
	  GOTO 1000
	ENDIF
	RETURN
C
C PROCESS 4-DIGIT GAME
C
2000	CONTINUE
	DO 2040 OFF=0,TRABUF(TWNBET)-1
	NUM=TRABUF(TWNNUM1+OFF*3)
	AMT=TRABUF(TWNAMT1+OFF*3)/NBRPRC(GIND)*SIGN
	TYP=TRABUF(TWNPOL1+OFF*3)
C
C
	OPT=BT4TAB(TYP)
	IF(OPT.EQ.CMB) AMT=AMT/2
	IF(TYP.EQ.TNB4W4) AMT=AMT/4
	IF(TYP.EQ.TNB4W6) AMT=AMT/6
	IF(TYP.EQ.TNB4W12)AMT=AMT/12
	IF(TYP.EQ.TNB4W24)AMT=AMT/24
	BOXOFF=P4OFF(NUM+1,BOXADR)
	STROFF=NUM+PSTR
	IF(TYP.EQ.TNB4F2) STROFF=NUM+PFP2
	IF(TYP.EQ.TNB4B2) STROFF=NUM+PBP2
	IF(TYP.EQ.TNB4M2) STROFF=NUM+PSM2
C
C
	DO 2030 K=1,UPDCNT
	DAY=DAYS(K)
	IF(OPT.EQ.STR.OR.OPT.EQ.CMB)
     *	  POOLT(STROFF,DAY,GIND)=POOLT(STROFF,DAY,GIND)+AMT
	IF(OPT.EQ.BOX.OR.OPT.EQ.CMB)
     *	  POOLT(BOXOFF,DAY,GIND)=POOLT(BOXOFF,DAY,GIND)+AMT
	IF(OPT.EQ.WHL) THEN
	  CALL PERM4(NUM,CMBTAB,N)
	  DO 2020 J=1,N
	  STROFF=CMBTAB(J)+PSTR
	  POOLT(STROFF,DAY,GIND)=POOLT(STROFF,DAY,GIND)+AMT
2020	  CONTINUE
	ENDIF
2030	CONTINUE
2040	CONTINUE
	IF(CANCEL.OR.CFLAG.OR.NBRLIM(1,GIND).LT.0) RETURN
C
C CHECK IF LIABILITY LIMIT HAS BEEN EXCEEDED
C
	CALL CHKNUM(TRABUF,UPDCNT,DAYS,LIMIT,BETOFF,WARN)
	IF(LIMIT) THEN
	  TRABUF(TERR)=LIAB
	  TRABUF(TSTAT)=REJT
	  SIGN=-1
	  CANCEL=.TRUE.
	  GOTO 2000
	ENDIF
	RETURN
	END
