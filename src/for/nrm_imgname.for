C
C SUBROUTINE IMGNAME
C $Log:   GXAFXT:[GOLS]IMGNAME.FOV  $
C  
C     Rev 1.0   17 Apr 1996 13:35:42   HXK
C  Release of Finland for X.25, Telephone Betting, Instant Pass Thru Phase 1
C  
C     Rev 1.0   21 Jan 1993 16:38:22   DAB
C  Initial Release
C  Based on Netherlands Bible, 12/92, and Comm 1/93 update
C  DEC Baseline
C
C ** Source - nrm_runtsk.for **
C
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C IMGNAME(PID,IMAGE_NAME,NAME_LENGTH, STATUS, PRCNAMEXP)
C
C Calling sequence:
C
C	CALL IMGNAME(PID, IMAGE_NAME, NAME_LENGTH,STATUS,PRCNAMEXP)
C
C INPUT:
C	PID		This is a PID of the process.
C
C OUTPUT:
C	IMAGE_NAME	This is the name of the image.
C	NAME_LENGTH	This is the actual length of the IMAGE_NAME string.
C	STATUS		Status: 4 - there is no process (like in STTSK)
c				0 - there is a process
C
C++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C
C
C=======OPTIONS /CHECK=NOOVERFLOW	    ! V04
	SUBROUTINE IMGNAME(PID,IMAGE_NAME,NAME_LENGTH,STATUS,PRCNAMEXP)
	IMPLICIT NONE
C
	INCLUDE	    'INCLIB:SYSPARAM.DEF'
	INCLUDE	    'INCLIB:SYSEXTRN.DEF'
	INCLUDE	    '($SYSSRVNAM)'
	INCLUDE	    '($JPIDEF)'
        INCLUDE	    '($SSDEF)'
C
	INTEGER*4   PID
	CHARACTER   IMAGE_NAME*80	    ! V04
	INTEGER*4   NAME_LENGTH, STATUS
	CHARACTER   PRCNAMEXP*(*)
C
	STRUCTURE   /JPISTRUC/
	    INTEGER*2	BUFLEN
	    INTEGER*2	ITMCOD
	    INTEGER*4	BUFADR
	    INTEGER*4	LENADR
	END STRUCTURE
C
	RECORD	    /JPISTRUC/ ITEMLIST(2)
C
	INTEGER*4   ST
C
	ITEMLIST(1).BUFLEN = 80			! V04
	ITEMLIST(1).ITMCOD = JPI$_IMAGNAME
	ITEMLIST(1).BUFADR = %LOC(IMAGE_NAME)
	ITEMLIST(1).LENADR = %LOC(NAME_LENGTH)
C
	ITEMLIST(2).BUFLEN = 0			!TO TERMINATE LIST
	ITEMLIST(2).ITMCOD = 0			!TO TERMINATE LIST V04
C
100	CONTINUE
	ST = SYS$GETJPIW( ,PID,,ITEMLIST(1),,,)
	IF(ST.EQ.SS$_SUSPENDED) THEN
	    TYPE *,'WAITING FOR THE STATUS OF THE PROCESS: ', PRCNAMEXP
	    CALL XWAIT(100,1,ST)
	    GOTO 100
	ENDIF
	IF(ST.EQ.SS$_NONEXPR) THEN
	    STATUS = 4
	    GOTO 10000
	ENDIF
	IF(ST.EQ.SS$_NORMAL) THEN
	    STATUS = 0
	    GOTO 10000
	ENDIF
C
C	IF ERROR CODE IS DIFFERENT FROM ABOVE - SOFTWARE PROBLEM
C
	TYPE *,'CANNOT OBTAIN STATUS OF THE PROCESS: ', PRCNAMEXP,
     *	  ', ERROR= ', ST
	STATUS = 0
	NAME_LENGTH = 1
C
10000	CONTINUE
C
	RETURN
	END
