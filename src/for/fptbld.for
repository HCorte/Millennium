C  GXSRC:FPTBLD.FOR
C  
C V08 11-MAR-2010 RXK Claims replaced with returns
C V07 16-OCT-2000 UXN AlphaIPS release.
C V06 17-FEB-1997 WPW Remove on-line game names.
C V05 14-FEB-1997 WPW Changed the on-line game name size from 20(!) to 8 bytes.
C V04 01-SEP-1994 MCM SWAPPING BYTES IS NO LONGER NECESSARY FOR THE DEC LMS
C V03 25-AUG-1994 MCM MOVED THE 4 BYTES RESERVED TO THE END OF THE MESSAGE
C V02 12-JUL-1994 MCM REMOVED AGTCOM (NOT USED)
C V01 15-MAY-1993 DSL INITIAL RELEASE FOR GEORGIA FINANCIAL TRANSACTION
C		      FPT0001
C
C SUBROUTINE TO BUILD AND FINANCIAL PASS-THROUGH TRANSACTION 
C
C CALLING SEQUENCE:
C     CALL FPTBLD(STATUS)
C OUTPUT
C     STATUS - QUEUEING STATUS (0 = GOOD, -1 = NO BUFFERS AVAILABLE)
C
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C This item is the property of GTECH Corporation, Providence, Rhode
C Island, and contains confidential and trade secret information. It
C may not be transferred from the custody or control of GTECH except
C as authorized in writing by an officer of GTECH. Neither this item
C nor the information it contains may be used, transferred,
C reproduced, published, or disclosed, in whole or in part, and
C directly or indirectly, except as expressly authorized by an
C officer of GTECH, pursuant to written agreement.
C
C Copyright 1996 GTECH Corporation. All rights reserved.
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C
C=======OPTIONS /CHECK=NOOVERFLOW
	SUBROUTINE FPTBLD(STATUS)	
	IMPLICIT NONE
C
	INCLUDE 'INCLIB:SYSPARAM.DEF'
	INCLUDE 'INCLIB:SYSEXTRN.DEF'
	INCLUDE 'INCLIB:GLOBAL.DEF'
	INCLUDE 'INCLIB:CONCOM.DEF'
	INCLUDE 'INCLIB:PROCOM.DEF'
	INCLUDE 'INCLIB:PRMLOG.DEF'
	INCLUDE 'INCLIB:QUECOM.DEF'
	INCLUDE 'INCLIB:TASKID.DEF'
	INCLUDE 'INCLIB:GTNAMES.DEF'
C
	INTEGER*4  STATUS

	INTEGER*4  MAXLEN 
	PARAMETER(MAXLEN=56)
C
	INTEGER*4  IND, BUF
	BYTE	   B_FPTBUF(MAXLEN)
	INTEGER*4  I4TEMP,I,OFF,GTYP,GNUM
	INTEGER*2  I2TEMP(2)
	BYTE	   I1TEMP(4)
	EQUIVALENCE(I4TEMP,I2TEMP,I1TEMP)
        INTEGER*4  SALES(NUMTOT, NUMFIN)
C
C GET TOTAL SALES BY GAME TYPE
C
	CALL FASTSET(0,SALES,NUMTOT*NUMFIN*MAXTYP)
C
        DO 30 GNUM = 1, MAXGAM
           IF(GNTTAB(GAMIDX,GNUM).EQ.0) GOTO 30
           GTYP = GNTTAB(GAMTYP,GNUM)
           IF(GTYP.EQ.TINS) GOTO 30

           DO 20 I = 1, NUMFIN
              OFF=I
              IF(OFF.EQ.TREF) OFF=TVAL
              SALES(TRACNT,OFF) = SALES(TRACNT,OFF) + DAYTYP(TRACNT,I,GNUM)
              SALES(DOLAMT,OFF) = SALES(DOLAMT,OFF) + 
     *                           (DAYTYP(DOLAMT,I,GNUM))*DYN_BETUNIT/DOLL_BASE
20         CONTINUE
30      CONTINUE
C									
C BUILD CROSS SYSTEM MSG IN B_FPTBUF
C
C GET BUFFER, IF AVAILABLE
C
        STATUS = 0
        CALL GETBUF(BUF)
	IF(BUF.EQ.0) THEN
	   STATUS=-1 
	   RETURN
	ENDIF
C
C SET LENGTH
C
        IND=1                              
        I4TEMP=MAXLEN
        B_FPTBUF(IND+0) = I1TEMP(1)
        B_FPTBUF(IND+1) = I1TEMP(2)
        IND=IND+2
C
C SET GTECH BUFFER NUMBER
C
        I4TEMP=BUF
        B_FPTBUF(IND+0) = I1TEMP(1)
        B_FPTBUF(IND+1) = I1TEMP(2)
        IND=IND+2
C
C SET GTECH CROSS REFERENCE NUMBER
C
	I4TEMP=FPTOFF+P(ACTTIM)
	B_FPTBUF(IND+0) = I1TEMP(1)
	B_FPTBUF(IND+1) = I1TEMP(2)
	B_FPTBUF(IND+2) = I1TEMP(3)
	B_FPTBUF(IND+3) = I1TEMP(4)
	IND=IND+4
C
C SET TRANSACTION TYPE CODE
C
	I4TEMP=21
	B_FPTBUF(IND+0) = I1TEMP(1)
	B_FPTBUF(IND+1) = I1TEMP(2)
	IND=IND+2
C
C SET ONLINE GAME NUMBER
C
        I4TEMP = 1
	B_FPTBUF(IND+0) = I1TEMP(1)
	B_FPTBUF(IND+1) = I1TEMP(2)
	IND=IND+2
C
C SET SALES COUNT 
C
        I4TEMP = SALES(TRACNT,TWAG)
        B_FPTBUF(IND+0) = I1TEMP(1)
        B_FPTBUF(IND+1) = I1TEMP(2)
        B_FPTBUF(IND+2) = I1TEMP(3)
        B_FPTBUF(IND+3) = I1TEMP(4)
        IND=IND+4
C
C SET CANCELS COUNT
C
        I4TEMP = SALES(TRACNT,TCAN)
        B_FPTBUF(IND+0) = I1TEMP(1)
        B_FPTBUF(IND+1) = I1TEMP(2)
        B_FPTBUF(IND+2) = I1TEMP(3)
        B_FPTBUF(IND+3) = I1TEMP(4)
        IND=IND+4
C
C SET INTERNAL CANCELS COUNT
C
        I4TEMP = SALES(TRACNT,TINC)
        B_FPTBUF(IND+0) = I1TEMP(1)
        B_FPTBUF(IND+1) = I1TEMP(2)
        B_FPTBUF(IND+2) = I1TEMP(3)
        B_FPTBUF(IND+3) = I1TEMP(4)
        IND=IND+4
C
C SET VALIDATIONS COUNT
C
        I4TEMP = SALES(TRACNT,TVAL)
        B_FPTBUF(IND+0) = I1TEMP(1)
        B_FPTBUF(IND+1) = I1TEMP(2)
        B_FPTBUF(IND+2) = I1TEMP(3)
        B_FPTBUF(IND+3) = I1TEMP(4)
        IND=IND+4
C
C SET RETURNS COUNT
C
        I4TEMP = SALES(TRACNT,TRET)
        B_FPTBUF(IND+0) = I1TEMP(1)
        B_FPTBUF(IND+1) = I1TEMP(2)
        B_FPTBUF(IND+2) = I1TEMP(3)
        B_FPTBUF(IND+3) = I1TEMP(4)
        IND=IND+4
C
C SET SALES AMOUNT
C
        I4TEMP = SALES(DOLAMT,TWAG)
        B_FPTBUF(IND+0) = I1TEMP(1)
        B_FPTBUF(IND+1) = I1TEMP(2)
        B_FPTBUF(IND+2) = I1TEMP(3)
        B_FPTBUF(IND+3) = I1TEMP(4)
        IND=IND+4
C
C SET CANCELS AMOUNT
C
        I4TEMP = SALES(DOLAMT,TCAN)
        B_FPTBUF(IND+0) = I1TEMP(1)
        B_FPTBUF(IND+1) = I1TEMP(2)
        B_FPTBUF(IND+2) = I1TEMP(3)
        B_FPTBUF(IND+3) = I1TEMP(4)
        IND=IND+4
C
C SET INTERNAL CANCELS AMOUNT
C
        I4TEMP = SALES(DOLAMT,TINC)
        B_FPTBUF(IND+0) = I1TEMP(1)
        B_FPTBUF(IND+1) = I1TEMP(2)
        B_FPTBUF(IND+2) = I1TEMP(3)
        B_FPTBUF(IND+3) = I1TEMP(4)
        IND=IND+4
C
C SET VALIDATIONS AMOUNT
C
        I4TEMP = SALES(DOLAMT,TVAL)
        B_FPTBUF(IND+0) = I1TEMP(1)
        B_FPTBUF(IND+1) = I1TEMP(2)
        B_FPTBUF(IND+2) = I1TEMP(3)
        B_FPTBUF(IND+3) = I1TEMP(4)
        IND=IND+4
C
C SET RETURNS AMOUNT
C
        I4TEMP = SALES(DOLAMT,TRET)
        B_FPTBUF(IND+0) = I1TEMP(1)
        B_FPTBUF(IND+1) = I1TEMP(2)
        B_FPTBUF(IND+2) = I1TEMP(3)
        B_FPTBUF(IND+3) = I1TEMP(4)
        IND=IND+4
C
C CLEAR AND INITIALIZE PROCOM BUFFER
C
    	HPRO(TRCODE,BUF) = TYPFPT						
	HPRO(INPLEN,BUF) = OUTLEN_MAX					

	CALL MOVBYT(B_FPTBUF,1, BPRO(BINSTAB+1,BUF), 1, MAXLEN)
	CALL QUETRA(CRS, BUF)
C
	RETURN
	END
