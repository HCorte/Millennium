C
C SUBROUTINE IWRIBF
C $Log:   GXAFXT:[GOLS]IWRIBF.FOV  $
C  
C     Rev 1.0   17 Apr 1996 13:41:46   HXK
C  Release of Finland for X.25, Telephone Betting, Instant Pass Thru Phase 1
C  
C     Rev 1.0   21 Jan 1993 16:43:32   DAB
C  Initial Release
C  Based on Netherlands Bible, 12/92, and Comm 1/93 update
C  DEC Baseline
C
C ** Source - nrm_hshseqi4.for **
C
C
C
C
C
C *** IWRIBF
C
C This will buffer records for output
C
C
C=======OPTIONS /CHECK=NOOVERFLOW
	SUBROUTINE IWRIBF(I4REC,LUN,BIGBUF,IOBUF,STATUS)
	IMPLICIT NONE
C
	INCLUDE 'INCLIB:SYSPARAM.DEF'
	INCLUDE 'INCLIB:SYSEXTRN.DEF'
C
	INCLUDE 'INCLIB:HSHCOM.DEF'
C
	INTEGER*4 I4REC(*)               !  INPUT: RECORD TO WRITE
	INTEGER*4 LUN                    !  INPUT: LOGICAL UNIT #
	INTEGER*4 BIGBUF(*)              !SCRATCH: BUFFER AREA
	INTEGER*4 IOBUF(*)               !SCRATCH: I/O BUFFER
	INTEGER*4 STATUS                 ! OUTPUT: 0=OK, ELSE ERROR #
	INTEGER*4 K, THSOFF, OLDLNK, NEWBLK, LENREC, NUMREC, NEWI4KEY
C
	INTEGER*4 I4TEMP
	INTEGER*2 I2TEMP(2)
	EQUIVALENCE (I4TEMP,I2TEMP)
C
C
C
	IF(FCB(FCBBIG,LUN).EQ.0 .OR.
     *	   BIGBUF(BUFLUN) .NE.LUN)THEN
	  STATUS=ERRUNT
	  GO TO 9000
	ENDIF
C
	IF(BIGBUF(BUFFRE)+FCB(FCBMSZ,LUN)+1 .GT. FCB(FCBBIG,LUN))THEN
	  CALL IFLUSH(LUN,BIGBUF,IOBUF,STATUS)
	  IF(STATUS.NE.0)GO TO 9000
	ENDIF
C
	NEWI4KEY=I4REC(FCB(FCBI4K,LUN))
	NUMREC=ISHFT(NEWI4KEY,-30) + 1
	LENREC=NUMREC*FCB(FCBLN4,LUN)
	NEWI4KEY=IAND(NEWI4KEY,INDMSK)
C
	NEWBLK=MOD(NEWI4KEY,FCB(FCBHSH,LUN)) + 1
C
	OLDLNK=BIGBUF(BUFCNT+NEWBLK)            !GET OLD LINK
	THSOFF=BIGBUF(BUFFRE)                   !CURRENT OFFSET
	BIGBUF(BUFCNT+NEWBLK)=THSOFF            !SET START ADDRESS
	BIGBUF(THSOFF)=OLDLNK                   !LINK TOGETHER
	BIGBUF(BUFFRE)=THSOFF+LENREC+1          !NEXT AVAILABLE
C
	DO 2100 K=1,LENREC
	  BIGBUF(THSOFF+K)=I4REC(K)
2100	CONTINUE
C
	STATUS=0
C
9000	CONTINUE
	RETURN
	END
