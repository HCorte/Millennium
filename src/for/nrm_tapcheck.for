C
C SUBROUTINE TAPCHECK
C $Log:   GXAFXT:[GOLS]TAPCHECK.FOV  $
C  
C     Rev 1.0   17 Apr 1996 15:27:02   HXK
C  Release of Finland for X.25, Telephone Betting, Instant Pass Thru Phase 1
C  
C     Rev 1.0   21 Jan 1993 17:48:04   DAB
C  Initial Release
C  Based on Netherlands Bible, 12/92, and Comm 1/93 update
C  DEC Baseline
C
C ** Source - nrm_tapeio.for **
C
C
C
C
C*********************************************************************
C
C *** TAPCHECK	  CHECK TO BE SURE TAPE IS MOUNTED
C
C*********************************************************************
C
C=======OPTIONS /CHECK=NOOVERFLOW
	SUBROUTINE TAPCHECK ( DEVNAM, STATUS)
	IMPLICIT NONE
C
	INCLUDE	    'INCLIB:SYSPARAM.DEF'
	INCLUDE	    'INCLIB:SYSEXTRN.DEF'
C
	INCLUDE	    'INCLIB:TAPEIO.DEF'
	INCLUDE	    '($SYSSRVNAM)'
	INCLUDE	    '($DVIDEF)'
	INCLUDE	    '($DEVDEF)'
	INCLUDE	    '($MTDEF)'
C
	CHARACTER   DEVNAM*(*)
	INTEGER*4   STATUS
C
C The following structure is used to pass itemlist elements to SYS$GETDVIW
C
	STRUCTURE /GETDVI_STRUC/
	  INTEGER*2	BUFLEN		    !LENGTH OF BUFFER
	  INTEGER*2	ITMCOD		    !ITEM CODE
	  INTEGER*4	BUFADR		    !BUFFER ADDRESS
	  INTEGER*4	RLNADR		    !RETURN LENGTH ADDRESS
	END STRUCTURE
C
	RECORD	/GETDVI_STRUC/ ITEMLIST(4)  !UP TO 4 DIFFERENT ITEMS
C
	INTEGER*4	DEVCHAR
	INTEGER*4	DEVCHARLEN
C
	INTEGER*4	DEVDEPEND
	INTEGER*4	DEVDEPENDLEN
C
	INTEGER*4	ST
C
C
C
C Check to be sure the tape is mounted
C
	ITEMLIST(1).BUFLEN = 4
	ITEMLIST(1).ITMCOD = DVI$_DEVCHAR	!DVC INDEPENDENT STUFF
	ITEMLIST(1).BUFADR = %LOC(DEVCHAR)
	ITEMLIST(1).RLNADR = %LOC(DEVCHARLEN)
C
	ITEMLIST(2).BUFLEN = 4
	ITEMLIST(2).ITMCOD = DVI$_DEVDEPEND	!DVC DEPENDENT STUFF
	ITEMLIST(2).BUFADR = %LOC(DEVDEPEND)
	ITEMLIST(2).RLNADR = %LOC(DEVDEPENDLEN)
C
	ITEMLIST(3).BUFLEN = 0
	ITEMLIST(3).ITMCOD = 0			!END OF LIST
C
C Get information about the tape
C
	ST = SYS$GETDVI(,,DEVNAM,ITEMLIST,,,,)
	IF(.NOT.ST) THEN
	  TYPE *,IAM(),'FILE ', DEVNAM, ' TAPCHECK ERROR'
	  CALL LIB$SIGNAL(%VAL(ST))
	  STATUS = -1
	  GOTO 9000
	ENDIF
C
	IF(IAND(DEVCHAR,DEV$M_MNT).EQ.0)THEN
	  TYPE *,IAM(),'TAPE NOT MOUNTED ',DEVNAM
	  STATUS = -1
	  GOTO 9000
	ENDIF
C
	IF(IAND(DEVCHAR,DEV$M_FOR).EQ.0)THEN
	  TYPE *,IAM(),'TAPE NOT MOUNTED AS FOREIGN ',DEVNAM
	  STATUS = -2
	  GOTO 9000
	ENDIF
C
	STATUS = 0
C
C
9000	CONTINUE
	RETURN
	END
