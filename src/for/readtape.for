C
C SUBROUTINE READTAPE
C $Log:   GXAFXT:[GOLS]READTAPE.FOV  $
C  
C     Rev 1.0   17 Apr 1996 14:39:00   HXK
C  Release of Finland for X.25, Telephone Betting, Instant Pass Thru Phase 1
C  
C     Rev 1.0   21 Jan 1993 17:27:32   DAB
C  Initial Release
C  Based on Netherlands Bible, 12/92, and Comm 1/93 update
C  DEC Baseline
C
C ** Source - readtmf.for **
C
C
C
C SUBROUTINE TO READ TRANSACTION FROM LOG/TMFDMP TAPE
C
C=======OPTIONS /CHECK=NOOVERFLOW
	SUBROUTINE READTAPE(LOGREC,FDB,EOT)
	IMPLICIT NONE
C
	INCLUDE 'INCLIB:SYSPARAM.DEF'
	INCLUDE 'INCLIB:SYSEXTRN.DEF'
	INCLUDE 'INCLIB:PRMLOG.DEF'
	INCLUDE 'INCLIB:DATBUF.DEF'
	INCLUDE 'INCLIB:DESLOG.DEF'
	INTEGER*4 LOGREC(*),FDB(*),TAPBUF(LREC,128)
	INTEGER*4 LENGTH, CNT, RTYPE, TT, ST, IND
	BYTE I1TAPBUF(LREC*4,128)
	CHARACTER*8 TAPTYP(3)
	INTEGER*2 DATE(LDATE_LEN)
	CHARACTER ANS
	LOGICAL EOT
	INTEGER*4   EOTCNT/0/
	EQUIVALENCE (TAPBUF,I1TAPBUF)
	DATA IND/999999/
	DATA TAPTYP/'  Logger','  Tmfdmp','  Tcfdmp'/
C
C
10	CONTINUE
	IND=IND+1
	IF(IND.LE.LBLK+1) GOTO 100
	CALL RTAPEW(FDB,TAPBUF,ST)
	IF(ST.EQ.136.OR.ST.EQ.144.OR.ST.EQ.152) THEN
	  CALL XREWIND(FDB,ST)
	  CALL WIMG(5,'Mount next tape and hit return [E-exit] ')
	  READ(5,901) ANS
	  IF(ANS.EQ.'E') THEN
	    EOT=.TRUE.
	    RETURN
	  ENDIF
	  GOTO 10
	ENDIF
C
C
	IF(ST.NE.0) THEN
	  WRITE(5,902) ST
	  CALL GPAUSE
	  EOT=.TRUE.
	  RETURN
	ENDIF
C
C CHECK FOR HEADER BLOCK
C
	IF(TAPBUF(2,1).EQ.-1) THEN
	  TT=TAPBUF(3,1)+1
	  IF(TT.LT.1.OR.TT.GT.2) TT=3
	  DATE(VCDC)=TAPBUF(1,2)
	  CALL LCDATE(DATE)
	  WRITE(5,903) TAPTYP(TT),DATE(VMON),DATE(VDAY),
     *	               DATE(VYEAR2),DATE(VCDC)
	  GOTO 10
	ENDIF
	IND=2
C
C
100	CONTINUE
	IF(TAPBUF(1,IND).EQ.0) THEN
	  EOTCNT=EOTCNT+1
	  IF(EOTCNT.GT.1000) THEN
	    EOT=.TRUE.
	    RETURN
	  ENDIF
	  GOTO 10
	ENDIF
C
C
	EOTCNT=0
	RTYPE=I1TAPBUF(LREC*4,IND)
	RTYPE=IAND(RTYPE,7)
	IF(RTYPE.GT.LONE) GOTO 10
C
C
	CNT=1
	IF(RTYPE.EQ.LONE) THEN
	  RTYPE=I1TAPBUF(LREC*4,IND+1)
	  RTYPE=IAND(RTYPE,7)
	  IF(RTYPE.EQ.LTWO) CNT=3
	  IF(RTYPE.EQ.LEND) CNT=2
	ENDIF
	LENGTH=CNT*LREC
	CALL FASTMOV(TAPBUF(1,IND),LOGREC,LENGTH)
	IND=IND+CNT-1
	RETURN
C
C
901	FORMAT(A1)
902	FORMAT(' Tape read error > ',I4)
903	FORMAT(1X,A8,' tape created on ',I2.2,'/',I2.2,'/',I4.4,
     *	        ' cdc ',I4)
	END
