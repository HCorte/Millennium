C
C SUBROUTINE SIMCHKINP
C $Log:   GXAFXT:[GOLS]SIMCHKINP.FOV  $
C  
C     Rev 1.0   17 Apr 1996 15:05:48   HXK
C  Release of Finland for X.25, Telephone Betting, Instant Pass Thru Phase 1
C  
C     Rev 1.0   21 Jan 1993 17:37:38   DAB
C  Initial Release
C  Based on Netherlands Bible, 12/92, and Comm 1/93 update
C  DEC Baseline
C
C ** Source - encpro.for **
C
C
C***************************************************************
C	CHECK FOR SIMULATED INPUT TRANSACTION
C
C	CALL SIMCHKINP(BUF_NO)
C	IN:
C	BUF_NO	-   BUFFER # TO CHECK
C
C	ROUTINE WILL CHECK IF INCOMING TRANSACTION SHOULD BE
C	SIMULATED, IF IT SHOULD, INCOMING BUFFER WILL BE "WAITED"
C	AND SIMULATION BUFFER WILL BE PASSED THROUGH THE SYSTEM
C
C
C=======OPTIONS /CHECK=NOOVERFLOW
	SUBROUTINE SIMCHKINP(BUF_NO)
	IMPLICIT NONE
C
	INCLUDE 'INCLIB:SYSPARAM.DEF'
	INCLUDE 'INCLIB:SYSEXTRN.DEF'
	INCLUDE 'INCLIB:GLOBAL.DEF'
	INCLUDE 'INCLIB:CONCOM.DEF'
	INCLUDE 'INCLIB:PROCOM.DEF'
	INCLUDE 'INCLIB:QUECOM.DEF'
	INCLUDE 'INCLIB:TASKID.DEF'
	INCLUDE 'INCLIB:SIMCOM.DEF'
C
	
	INTEGER*4 BUF_NO,SIMBUF			!BUFFER PROCESSED
	INTEGER*4 STATUS
	INTEGER*4 TYPE_MASK /Z0000FF00/		!TYPE/SUBTYPE MASK
	INTEGER*4 LOOPBACK_TYPE /Z0000C000/	!LOOPBACK TYPE/SUBTYPE
	LOGICAL*4 LOOPBACK			!.TRUE. IF LOOPBACK TRANS
C
C	SKIP IF INTERNAL SIMULATION
C
	IF (BUF_NO.LT.0) GOTO 100
C
	LOOPBACK=IAND(PRO(INPTAB,BUF_NO),TYPE_MASK)
     *			 .EQ.LOOPBACK_TYPE
C
C	REPLACE TRANSACTION WITH SIMULATED TRANSACTION IF LOOPBACK
C
	IF (LOOPBACK) THEN
C
C	GET TRANSACTION FROM THE SIMULATION QUEUE, REPLACE THE BUFFER
C
		CALL RTL(SIMBUF,SIM_SIMQUE_IN,STATUS)
		IF (STATUS.NE.2) THEN
		   SIM_XREF(SIMBUF)=BUF_NO
C
C	REMEMBER TIME TRANSACTION SIMULATION STARTED (FOR STATS)
C	AND TRANSACTION LENGTH (SO TERMINAL WILL SEND NEXT TRANSACTION
C	OF THE LENGTH THE SAME AS CURRENTLY PROCESSED TRANSACTION
C
		    SIM_MSG_INPUT_LEN(SIMBUF)=HPRO(INPLEN,SIMBUF)
		    SIM_DELAY(SIMBUF)=SYSTIM
		    BUF_NO=SIMBUF
		ELSE
		     SIM_PASS_LOOPBACK=SIM_PASS_LOOPBACK+1 !WANTED BUT COULD
C                                                           SIMULATE
		ENDIF
C
C	PUT SOME PROTECTION FOR NOT SIMULATED TRANSACATIONS HERE !!!
C
	ENDIF
	RETURN
C
C	INTERNAL SIMULATION BUFFER PROCESSING
C
100	CONTINUE
        CALL RTL(SIMBUF,SIM_SIMQUE_IN,STATUS)
        IF (STATUS.NE.2) THEN
      	     SIM_XREF(SIMBUF)=BUF_NO
C
C       REMEMBER TIME TRANSACTION SIMULATION STARTED (FOR STATS)
C       AND TRANSACTION LENGTH (SO TERMINAL WILL SEND NEXT TRANSACTION
C       OF THE LENGTH THE SAME AS CURRENTLY PROCESSED TRANSACTION
C
             SIM_MSG_INPUT_LEN(SIMBUF)=HPRO(INPLEN,SIMBUF)
             SIM_DELAY(SIMBUF)=SYSTIM
             BUF_NO=SIMBUF
	ENDIF
	RETURN 	
	END
