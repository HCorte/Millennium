C FMAINT.FOR
C
C V02 16-DEC-91 WLM ROTATION OF RENAMEs INSTEAD OF DELETE FILE1.OLD
C		    TO AVOID DISK FRAGMENTATION
C V01 01-AUG-90 XXX RELEASED FOR VAX
C
C V01 01-OCT-89 LOU R. INITIAL RELEASE FOR FINLAND
C
C SUBROUTINE TO DO FILE MAITENANCE
C
C
C
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C This item is the property of GTECH Corporation, Providence, Rhode
C Island, and contains confidential and trade secret information. It
C may not be transferred from the custody or control of GTECH except
C as authorized in writing by an officer of GTECH. Neither this item
C nor the information it contains may be used, transferred,
C reproduced, published, or disclosed, in whole or in part, and
C directly or indirectly, except as expressly authorized by an
C officer of GTECH, pursuant to written agreement.
C
C Copyright 1991 GTECH Corporation. All rights reserved.
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C
C=======OPTIONS /CHECK=NOOVERFLOW
	SUBROUTINE FMAINT(FILE1,FILE2,STAT)
	IMPLICIT NONE
C
	INCLUDE 'INCLIB:SYSPARAM.DEF'
	INCLUDE 'INCLIB:SYSEXTRN.DEF'
	INCLUDE 'INCLIB:GLOBAL.DEF'
	INCLUDE 'INCLIB:CONCOM.DEF'
	INTEGER*4 TMPNAM(5),OLDNAM(5),FILNAM1(5),FILNAM2(5)
	CHARACTER*20 CXTMPNAM,CXOLDNAM,CXFILNAM1,CXFILNAM2
	EQUIVALENCE (TMPNAM, CXTMPNAM)
	EQUIVALENCE (OLDNAM, CXOLDNAM)
	EQUIVALENCE (FILNAM1,CXFILNAM1)
	EQUIVALENCE (FILNAM2,CXFILNAM2)
C
	INTEGER*4 ST, STAT, FILE2, FILE1
C
C
	STAT=-1
	IF(FILE1.LT.1.OR.FILE1.GT.MAXFIL) RETURN
	IF(FILE2.LT.1.OR.FILE2.GT.MAXFIL) RETURN
	CALL FASTMOV(SFNAMES(1,FILE1),FILNAM1,5)
	CALL FASTMOV(SFNAMES(1,FILE2),FILNAM2,5)
C
C
	CALL GETTMP(FILNAM1,TMPNAM,ST)
	IF(ST.NE.0) THEN
	  WRITE(5,900) IAM(),FILE1,FILNAM1
	  RETURN
	ENDIF
C
C
	CALL GETOLD(FILNAM1,OLDNAM,ST)
	IF(ST.NE.0) THEN
	  WRITE(5,900) IAM(),FILE1,FILNAM1
	  RETURN
	ENDIF
C
C
	IF(FILNAM1(1).NE.FILNAM2(1)) THEN
	  TYPE*,IAM(),'Files must be on the same disk volume'
	  RETURN
	ENDIF
C
C RENAME FILE1.OLD TO FILE1.TMP
C
	WRITE(5,920) IAM(),OLDNAM,TMPNAM
	CALL OPENW(1,OLDNAM,7,0,0,ST)
	IF(ST.NE.0) THEN
	  WRITE(5,930) IAM(),OLDNAM,ST
	  RETURN
	ENDIF
C
C
	CALL FILRENAM(1,CXTMPNAM,ST)
	IF(ST.NE.0) THEN
	  WRITE(5,940) IAM(),OLDNAM,TMPNAM,ST
	  RETURN
	ENDIF
	CALL USRCLOS1(     1)
C
C RENAME FILE1.FIL TO FILE1.OLD
C
	WRITE(5,920) IAM(),FILNAM1,OLDNAM
	CALL OPENW(1,FILNAM1,7,0,0,ST)
	IF(ST.NE.0) THEN
	  WRITE(5,930) IAM(),FILNAM1,ST
	  RETURN
	ENDIF
C
C
	CALL FILRENAM(1,CXOLDNAM,ST)
	IF(ST.NE.0) THEN
	  WRITE(5,940) IAM(),FILNAM1,OLDNAM,ST
	  RETURN
	ENDIF
	CALL USRCLOS1(     1)
C
C RENAME FILE2.FIL TO FILE1.FIL
C
	WRITE(5,920) IAM(),FILNAM2,FILNAM1
	CALL OPENW(1,FILNAM2,7,0,0,ST)
	IF(ST.NE.0) THEN
	  WRITE(5,930) IAM(),FILNAM2,ST
	  RETURN
	ENDIF
C
C
	CALL FILRENAM(1,CXFILNAM1,ST)
	IF(ST.NE.0) THEN
	  WRITE(5,940) IAM(),FILNAM2,FILNAM1,ST
	  CALL GPAUSE
	ENDIF
	CALL USRCLOS1(     1)
C
C RENAME FILE1.TMP TO FILE2.FIL
C
	WRITE(5,920) IAM(),TMPNAM,FILNAM2
	CALL OPENW(1,TMPNAM,7,0,0,ST)
	IF(ST.NE.0) THEN
	  WRITE(5,930) IAM(),TMPNAM,ST
	  RETURN
	ENDIF
C
C
	CALL FILRENAM(1,CXFILNAM2,ST)
	IF(ST.NE.0) THEN
	  WRITE(5,940) IAM(),TMPNAM,FILNAM2,ST
	  CALL GPAUSE
	ENDIF
	CALL USRCLOS1(     1)
	STAT=0
	RETURN
C
C
900	FORMAT(1X,A,' File name error for file ',I2,' name ',5A4)
910	FORMAT(1X,A,' Deleting ',5A4)
920	FORMAT(1X,A,' Renaming ',5A4,' to ',5A4)
930	FORMAT(1X,A,1X,5A4,' open error> ',I4)
940	FORMAT(1X,A,' Error renaming ',5A4,' to ',5A4,' error> ',I4)
	END
C
C SUBROUTINE TO GET "OLD" NAME FROM FILE NAME
C
C
C=======OPTIONS /CHECK=NOOVERFLOW
	SUBROUTINE GETOLD(NAME,OLDNAM,ST)
	IMPLICIT NONE
C
	INCLUDE 'INCLIB:SYSPARAM.DEF'
	INCLUDE 'INCLIB:SYSEXTRN.DEF'
	INTEGER*4 NAME(5),OLDNAM(5),WRKNAM(5)
	INTEGER*4 I, ST
	CHARACTER CWRKNAM(20)
	EQUIVALENCE (WRKNAM,CWRKNAM)
C
C
	ST=-1
	CALL FASTMOV(NAME,WRKNAM,5)
	DO 10 I=1,17
	IF(CWRKNAM(I).EQ.'.') GOTO 20
10	CONTINUE
	RETURN
C
C
20	CONTINUE
	ST=0
	CWRKNAM(I+1)='O'
	CWRKNAM(I+2)='L'
	CWRKNAM(I+3)='D'
	CALL FASTMOV(WRKNAM,OLDNAM,5)
	RETURN
	END
C
C SUBROUTINE TO GET "TMP" NAME FROM FILE NAME
C
C
C=======OPTIONS /CHECK=NOOVERFLOW
	SUBROUTINE GETTMP(NAME,TMPNAM,ST)
	IMPLICIT NONE
C
	INCLUDE 'INCLIB:SYSPARAM.DEF'
	INCLUDE 'INCLIB:SYSEXTRN.DEF'
	INTEGER*4 NAME(5),TMPNAM(5),WRKNAM(5)
	INTEGER*4 I, ST
	CHARACTER CWRKNAM(20)
	EQUIVALENCE (WRKNAM,CWRKNAM)
C
C
	ST=-1
	CALL FASTMOV(NAME,WRKNAM,5)
	DO 10 I=1,17
	IF(CWRKNAM(I).EQ.'.') GOTO 20
10	CONTINUE
	RETURN
C
C
20	CONTINUE
	ST=0
	CWRKNAM(I+1)='T'
	CWRKNAM(I+2)='M'
	CWRKNAM(I+3)='P'
	CALL FASTMOV(WRKNAM,TMPNAM,5)
	RETURN
	END
