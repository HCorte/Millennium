C
C SUBROUTINE CMDWIT
C  
C V06 04-OCT-2000 UXN  GLOBAL RFSS #91. CLRSUM ADDED.
C V05 28-JUL-1998 RXK  Avoided to get 0 for revision # (byte 0) if updating
C V04 20-FEB-1996 HXK  Fix for rev#
C V03 21-JAN-1993 DAB  Initial Release
C                      Based on Netherlands Bible, 12/92, and Comm 1/93 update
C                      DEC Baseline
C V02 13-JUL-1992 GCAN ADDED CLOSING TIME AND DATE CHANGE COMMANDS.
C V01 01-AUG-1990 XXX  RELEASED FOR VAX
C
C SUBROUTINE TO PROCESS WINNERS TIP GAME COMMANDS
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C This item is the property of GTECH Corporation, Providence, Rhode
C Island, and contains confidential and trade secret information. It
C may not be transferred from the custody or control of GTECH except
C as authorized in writing by an officer of GTECH. Neither this item
C nor the information it contains may be used, transferred,
C reproduced, published, or disclosed, in whole or in part, and
C directly or indirectly, except as expressly authorized by an
C officer of GTECH, pursuant to written agreement.
C
C Copyright 1998 GTECH Corporation. All rights reserved.
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C
C=======OPTIONS /CHECK=NOOVERFLOW
	SUBROUTINE CMDWIT(TRABUF,MESS)
	IMPLICIT NONE
	INCLUDE 'INCLIB:SYSPARAM.DEF'
	INCLUDE 'INCLIB:SYSEXTRN.DEF'
	INCLUDE 'INCLIB:GLOBAL.DEF'
	INCLUDE 'INCLIB:WITCOM.DEF'
	INCLUDE 'INCLIB:CONCOM.DEF'
	INCLUDE 'INCLIB:DESTRA.DEF'
	INTEGER*4 MESS(EDLEN)
	INTEGER*4 GIND,ROW,GAMMAP(2),GNUM,CMDNUM,TEMP
	INTEGER*2 I2TEMP(2)
        BYTE      I1TEMP(4)
        EQUIVALENCE (TEMP,I2TEMP,I1TEMP)
C
C
C
	CMDNUM=TRABUF(TCMNUM)
	GOTO (10,20,30,40,50,60,70,80,90,100) CMDNUM
	GOTO 1000
C
C CHANGE WINNERS TIP GAME STATUS
C
10	CONTINUE
	GIND=TRABUF(TCMDT1)
	TRABUF(TCMOLD)=WITSTS(GIND)
	WITSTS(GIND)=TRABUF(TCMNEW)
	TEMP=WITREV(GIND)
	I2TEMP(1)=I2TEMP(1)+7
        IF(I1TEMP(1).EQ.0) I1TEMP(1)=1
	WITREV(GIND)=TEMP
	IF(TRABUF(TCMNEW).EQ.GAMBFD) THEN
	  WITCTM(GIND)=TRABUF(TTIM)
	  CALL BSET(WITTIM(GIND),1)
	  CALL CLRSUM
	ENDIF
	MESS(2)=TECMD
	MESS(3)=3
	MESS(6)=GIND
	MESS(9)=TRABUF(TCMOLD)
	MESS(10)=TRABUF(TCMNEW)
	RETURN
C
C CHANGE WINNERS TIP ROW STATUS
C
20	CONTINUE
	GIND=TRABUF(TCMDT1)
	ROW =TRABUF(TCMDT2)
	TRABUF(TCMOLD)=WITSTA(ROW,GIND)
	WITSTA(ROW,GIND)=TRABUF(TCMNEW)
	WITRTM(ROW,GIND)=TRABUF(TTIM)
        TEMP=WITREV(GIND)
        I2TEMP(1)=I2TEMP(1)+7
        IF(I1TEMP(1).EQ.0) I1TEMP(1)=1
        WITREV(GIND)=TEMP
	MESS(2)=TECMD
	MESS(3)=8
	MESS(6)=GIND
	MESS(9)=ROW
	MESS(10)=TRABUF(TCMOLD)
	MESS(11)=TRABUF(TCMNEW)
	GNUM=GTNTAB(TWIT,GIND)
	GAMMAP(1)=0
	GAMMAP(2)=0
	CALL BSET(GAMMAP,GNUM)
	CALL SUBCNTRL(GAMMAP,0)
	RETURN
C
C CHANGE GAME CLOSING TIME
C
30	CONTINUE
        GIND = TRABUF(TCMDT1)
        TRABUF(TCMOLD) = WITTIM(GIND)
        WITTIM(GIND) = TRABUF(TCMNEW)
        MESS(2) = TECMD
        MESS(3) = 12
        MESS(6) = GIND
	MESS(9) = 0
        MESS(10)= TRABUF(TCMOLD)
        MESS(11)= TRABUF(TCMNEW)
        RETURN
C
C CHANGE GAME CLOSING DATE (CHECK IF TODAY, IF NOT SET TIME BIT)
C
40	CONTINUE
	GIND = TRABUF(TCMDT1)
	TRABUF(TCMOLD) = WITDAT(GIND)
	WITDAT(GIND) = TRABUF(TCMNEW)
	IF(WITTIM(GIND).GE.'40000000'X) THEN
	   WITTIM(GIND) = WITTIM(GIND) - '40000000'X
	ENDIF
	IF(WITSTS(GIND).NE.GAMOPN.OR.
     *	   WITTIM(GIND).EQ.0.OR.
     *     WITDAT(GIND).NE.DAYCDC) THEN
	   WITTIM(GIND) = WITTIM(GIND) + '40000000'X
	ENDIF	     
	MESS(2) = TECMD
	MESS(3) = 18
	MESS(6) = GIND
	MESS(9) = 0
	MESS(10)= TRABUF(TCMOLD)
	MESS(11)= TRABUF(TCMNEW)
	GAMMAP(1) = 0
	GAMMAP(2) = 0
	GNUM = GTNTAB(TWIT,GIND)
	CALL BSET(GAMMAP,GNUM)
	CALL SUBCNTRL(GAMMAP,0)
	RETURN
C
C PUT NEXT WINNERS TIP COMMAND HERE
C
50	CONTINUE
60	CONTINUE
70	CONTINUE
80	CONTINUE
90	CONTINUE
100	CONTINUE
C
C INVALID COMMAND NUMBER
C
1000	CONTINUE
	TRABUF(TSTAT)=REJT
	TRABUF(TERR)=INVL
	MESS(2)=TECMD
	MESS(3)=1
	MESS(4)=TRABUF(TCMTYP)
	MESS(5)=TRABUF(TCMNUM)
	RETURN
	END
