C
C SUBROUTINE TATSNP
C  
C V11 17-APR-1996 HXK Release of Finland for X.25, Telephone Betting,
C                     Instant Pass Thru Phase 1
C V10 08-MAR-1994 JXP Display net sales for all clerks per agent in 
C                     page 2 of snap
C V09 24-JAN-1994 JXP Print change
C V08 23-JAN-1994 JXP  Calculate odds here for display
C V07 11-JAN-1994 JXP Added new page in snap for highest odds played today
C V06 21-NOV-1993 SXH FIX OVERFLOW PROBLEM
C V05 19-NOV-1993 GXA Increased Total amount field width to 12 and
C                     changed display of agent number.
C V04 13-JUN-1993 HXK added AGTINF.DEF, PRMAGT.DEF
C V03 21-JAN-1993 DAB Initial Release Based on Netherlands Bible, 12/92,
C                     and Comm 1/93 update DEC Baseline
C V02 17-JUL-1991 XXX RELEASED FOR VAX
C V01 22-AUG-1991  JB  INITIAL RELEASE FOR SWEDEN
C
C
C VIS_TATSNP.FOR    TOTO-SELECT COMBINATION ALL AGENT TOP 30 SNAPSHOT
C
C
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C This item is the property of GTECH Corporation, Providence, Rhode
C Island, and contains confidential and trade secret information. It
C may not be transferred from the custody or control of GTECH except
C as authorized in writing by an officer of GTECH. Neither this item
C nor the information it contains may be used, transferred,
C reproduced, published, or disclosed, in whole or in part, and
C directly or indirectly, except as expressly authorized by an
C officer of GTECH, pursuant to written agreement.
C
C Copyright 1991 GTECH Corporation. All rights reserved.
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C
C=======OPTIONS /CHECK=NOOVERFLOW
	SUBROUTINE TATSNP(PAGE,GIND,ROW,MLIM)
	IMPLICIT NONE
C
	INCLUDE 'INCLIB:SYSPARAM.DEF'
	INCLUDE 'INCLIB:SYSEXTRN.DEF'
C
	INCLUDE 'INCLIB:GLOBAL.DEF'
	INCLUDE 'INCLIB:CONCOM.DEF'
        INCLUDE 'INCLIB:AGTINF.DEF'
        INCLUDE 'INCLIB:AGTCOM.DEF'
	INCLUDE 'INCLIB:VISCOM.DEF'
	INCLUDE 'INCLIB:TSLCOM.DEF'
C
	INTEGER*4 LAT, MLIM, GNUM, ANT, TER, AMTAGT, I
	INTEGER*4 AMT, GIND, CLRKNUM
	INTEGER*4 J, K, ROW, LIN, OFFSET, NUMROW, AGT
	INTEGER*4 AMOUNT, NETSAL
	PARAMETER (LAT=30)
	INTEGER*4 TERTOP(LAT+1)
	INTEGER*4 INDTOP(LAT+1)
	INTEGER*4 AMTTOP(LAT+1)
	INTEGER*4  INDVTAB(AGAMLEN,MAXGAM)      
	LOGICAL   FLG
	CHARACTER*29 BETLIN
	INTEGER*4 PAGE,ROWNRS(6),TAB1X2(6)
	REAL*8	  ODDLIAB
C
	IF (PAGE.NE.2) THEN
	    PAGE=1
	ENDIF
	SMODE=.FALSE.
	IF(MLIM.LT.0) MLIM=0
C	IF(MLIM.LT.50.OR.MLIM.GT.90000) MLIM=5000
	 
C
C  SCAN FOR THE TOP 30 TERMINALS AND SORT THEM
C
	CALL FASTSET(0,TERTOP,LAT+1)
	CALL FASTSET(0,INDTOP,LAT+1)
	CALL FASTSET(0,AMTTOP,LAT+1)
	GNUM=GTNTAB(TTSL,GIND)
	IF(GNUM.LT.1) THEN
	  WRITE(CLIN23,3010) GIND
	  RETURN
	ENDIF
	ANT=0
	DO 20 TER=1,NUMAGT
	  FLG=.FALSE.
	  AMTAGT=AGTGAM(GSAMT,GNUM,TER)-AGTGAM(GCAMT,GNUM,TER)
	  IF(AMTAGT.GT.MLIM) THEN
	    DO 25 I=1,ATSTOP
	      IF(PAGE.EQ.1) THEN
	          AMT=(TSPWTL(ATSAMT,I,TER,GIND)/16)
	      ELSE
	          AMT=(TSPATL(ATSAMT,I,TER,GIND)/16)
	      ENDIF
	      FLG=.TRUE.
	      DO 30 J=1,LAT
	        IF(AMT.GT.AMTTOP(J)) GOTO 40
30	      CONTINUE
	      GOTO 25
40	      CONTINUE
	      DO 50 K=LAT+1,(J+1),-1
	        TERTOP(K)=TERTOP(K-1)
	        INDTOP(K)=INDTOP(K-1)
	        AMTTOP(K)=AMTTOP(K-1)
50	      CONTINUE
	      TERTOP(J)=TER
	      INDTOP(J)=I
	      AMTTOP(J)=AMT
25	    CONTINUE
	  ENDIF
	  IF(FLG) ANT=ANT+1
20	CONTINUE
C
C   ENCODE THE HEADER OF THE TAT SNAPSHOT
C
	WRITE(CLIN1,9000)
	IF(PAGE.EQ.1) THEN
	    WRITE(CLIN2,9011) CMONY(MLIM,8,BETUNIT)
	    WRITE(CLIN4,9012)
	    WRITE(CLIN5,9013)
	ELSE
	    WRITE(CLIN2,9001) CMONY(MLIM,8,BETUNIT)
	    WRITE(CLIN4,9002)
	    WRITE(CLIN5,9003)
	ENDIF
      WRITE(CLIN22,9004) ANT,CMONY(DAYTYP(DOLAMT,TWAG,GNUM),14,BETUNIT)
C
C   ENCODE TOP 30 ROWS
C
	IF(ROW.GT.(LAT-14)) ROW=LAT-14
	IF(ROW.LT.1)        ROW=1
	LIN=5
	DO 200 I=ROW,ROW+14
	  LIN=LIN+1
	  IF(TERTOP(I).EQ.0) THEN
	    WRITE(XNEW(  LIN),9005) I
	  ELSE
	    IF(PAGE.EQ.1) THEN
		OFFSET=TSPWTL(ATSOFF,INDTOP(I),TERTOP(I),GIND)
		NUMROW=IAND(TSPWTL(ATSAMT,INDTOP(I),TERTOP(I),GIND),15)
		ODDLIAB=TSPWTL(ATSTIM,INDTOP(I),TERTOP(I),GIND)
		IF(OFFSET.EQ.0.OR.NUMROW.LT.1.OR.NUMROW.GT.6) THEN
		    WRITE(XNEW(  LIN),9005) I
		    GOTO 200
		ENDIF
		AGT=AGTTAB(AGTNUM,TERTOP(I))
		CALL OFFODDS(OFFSET,NUMROW,ROWNRS,TAB1X2)
		ODDLIAB=1
		DO J=1,NUMROW
		    IF (ROWNRS(J).NE.0) THEN
			IF (TAB1X2(J).EQ.4) TAB1X2(J)=3
		    ENDIF
		    ODDLIAB=ODDLIAB*TSLODS(TAB1X2(J),ROWNRS(J),GIND)
		END DO
		IF(NUMROW.GT.2) ODDLIAB = DNINT(ODDLIAB/DFLOAT(100**(NUMROW-2)))
		IF(NUMROW.GT.1) ODDLIAB = DNINT(ODDLIAB/100.0D0)
		ODDLIAB = ODDLIAB/100.0D0
		IF(ODDLIAB.NE.0) THEN
		    AMOUNT=DNINT(AMTTOP(I)/ODDLIAB)
		ELSE
		    AMOUNT=0
		ENDIF
		WRITE(XNEW(  LIN),9016) I,AGT,
     *			BETLIN(OFFSET,NUMROW),
     *		        CMONY(AMOUNT*TSLPRC(GIND),12,BETUNIT),
     *			ODDLIAB,
     *		        CMONY(AMTTOP(I)*TSLPRC(GIND),12,BETUNIT)
	    ELSE
	        OFFSET=TSPATL(ATSOFF,INDTOP(I),TERTOP(I),GIND)
	        NUMROW=IAND(TSPATL(ATSAMT,INDTOP(I),TERTOP(I),GIND),15)
	        ODDLIAB=TSPWTL(ATSTIM,INDTOP(I),TERTOP(I),GIND)
	        IF(OFFSET.EQ.0.OR.NUMROW.LT.1.OR.NUMROW.GT.6) THEN
		    WRITE(XNEW(  LIN),9005) I
		    GOTO 200
		ENDIF
C
C SUM UP FOR ALL CLERKS FOR THIS TERMINAL
C
		NETSAL=0
		IF(P(CLRKACT).EQ.0) THEN
		   CLRKNUM=AGTHTB(AGTPASOFF,TERTOP(I))
		   CALL GETCLERK(TERTOP(I),CLRKNUM,1,INDVTAB)
	           NETSAL=INDVTAB(GSAMT,GNUM)-INDVTAB(GCAMT,GNUM)
		ENDIF
		NETSAL=NETSAL+AGTGAM(GSAMT,GNUM,TERTOP(I))
     *		             -AGTGAM(GCAMT,GNUM,TERTOP(I))
	        NETSAL=NETSAL/100
		AGT=AGTTAB(AGTNUM,TERTOP(I))
		AMOUNT=TSPATL(ATSAMT,INDTOP(I),TERTOP(I),GIND)/16
		WRITE(XNEW(  LIN),9006) I,AGT,
     *	           CMONY(NETSAL*TSLPRC(GIND),12,BETUNIT),
     *	                 BETLIN(OFFSET,NUMROW),
     *		   CMONY(AMOUNT*TSLPRC(GIND),12,BETUNIT)
	    ENDIF
	  ENDIF
200	CONTINUE
C
C
3010	FORMAT('Select ',I1,' game not active')
9000	FORMAT('TATSNP snapshot')
9001	FORMAT(15X,'Today TOTO SELECT Sales/Agent exceeding MK',A8)
9002	FORMAT(22X,'    MOST PLAYED COMBINATIONS TODAY')
9003	FORMAT('     AGENT         SALES  ',
     *	      '-COMBINATION-----------------    AMOUNT BET')
C     *	      '   WARNING  DISABLED')
9004	FORMAT('Number of agents: ',I4,10X,
     *	       'Total amount bet today: ',A14)
9005	FORMAT(I2.2,'  --- --- ---  NOT INITIALIZED --- --- ---    ',
     *	            '            ')
9006	FORMAT(I2.2,' ',I7,'  ',A12,'  ',A29,1X,A12)
C
C
9011	FORMAT(15X,'Today PITKA Sales/Agent exceeding MK',A8)
9012	FORMAT(22X,'    HIGHEST ODDS PLAYED TODAY')
9013	FORMAT('     AGENT  ',
     *	 'COMBINATION------------------   AMOUNT BET',
     *   '     ODDS AMOUNT LIABLE')
9016	FORMAT(I2.2,' ',I7,'  ',A29,1X,A12,1X,F8.2,2X,A12)
	END
