C
C SUBROUTINE CHKCAN
C
C CHKCAN.FOR
C
C V15 31-MAR-2010 RXK ePassive changes
C V14 29-NOV-2000 UXN TOTOGOLA ADDED.
C V13 13-OCT-1999 RXK World Tour added.
C V12 13-MAY-1999 UXN Super Triple added.
C V11 23-NOV-1995 HXK Merge of post 65 stuff; changes for Double/Couple
C V10 15-OCT-1994 HXK Adding /developing Bingo (15.Oct.94)
C V09 16-DEC-1993 HXK FORCE CHKCAN TO COMPILE.
C V08 28-OCT-1993 GXA Added checking of cancel time after draw for all games.
C V07 12-AUG-1993 HXK No change.
C V06 02-AUG-1993 SXH Added RAVI and SPEDEN
C V05 21-JAN-1993 DAB Initial Release
C                     Based on Netherlands Bible, 12/92, and Comm 1/93 update
C                     DEC Baseline
C V04 17-APR-1992 GCAN CHECK IF KICKER (Y/N) FLAG, BEFORE SUPPRESSION DECICION.
C V03 20-JAN-1992 GCAN FIXED TOTO SELECT CANCELLATION (*TWTBLEN)
C V02 01-NOV-1991 MTK  INITAL RELEASE FOR NETHERLANDS
C V01 01-AUG-1990 XXX  RELEASED FOR VAX
C
C SUBROUTINE TO CHECK IF TICKET CAN BE CANCELLED AFTER THE DRAW
C
C
C
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C This item is the property of GTECH Corporation, Providence, Rhode
C Island, and contains confidential and trade secret information. It
C may not be transferred from the custody or control of GTECH except
C as authorized in writing by an officer of GTECH. Neither this item
C nor the information it contains may be used, transferred,
C reproduced, published, or disclosed, in whole or in part, and
C directly or indirectly, except as expressly authorized by an
C officer of GTECH, pursuant to written agreement.
C
C Copyright 1999 GTECH Corporation. All rights reserved.
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C 
C=======OPTIONS /CHECK=NOOVERFLOW
	SUBROUTINE CHKCAN(TRABUF,ST)
	IMPLICIT NONE
C
	INCLUDE 'INCLIB:SYSPARAM.DEF'
	INCLUDE 'INCLIB:SYSEXTRN.DEF'
	INCLUDE 'INCLIB:GLOBAL.DEF'
	INCLUDE 'INCLIB:CONCOM.DEF'
	INCLUDE 'INCLIB:LTOCOM.DEF'
	INCLUDE 'INCLIB:SPTCOM.DEF'
	INCLUDE 'INCLIB:TGLCOM.DEF'
	INCLUDE 'INCLIB:KIKCOM.DEF'
	INCLUDE 'INCLIB:SCRCOM.DEF'
	INCLUDE 'INCLIB:WITCOM.DEF'
	INCLUDE 'INCLIB:TSLCOM.DEF'
	INCLUDE 'INCLIB:NBRCOM.DEF'
        INCLUDE 'INCLIB:BNGCOM.DEF'
        INCLUDE 'INCLIB:DBLCOM.DEF'
        INCLUDE 'INCLIB:CPLCOM.DEF'
        INCLUDE 'INCLIB:SSCCOM.DEF'
        INCLUDE 'INCLIB:TRPCOM.DEF'
        INCLUDE 'INCLIB:STRCOM.DEF'
        INCLUDE 'INCLIB:PASCOM.DEF'
	INCLUDE 'INCLIB:DESTRA.DEF'
C
        ! arguments
        INTEGER*4  ST              !

        ! variables
	INTEGER*4  TSROFF(3)       !
	INTEGER*4  TSSOFF(3)       !
	INTEGER*4  KGIND           !
	INTEGER*4  DRWTIM          !Time when no cancel is possible.
	INTEGER*4  KGAM            !
	INTEGER*4  GIND            !
	INTEGER*4  ROW             !
	INTEGER*4  I               !
	INTEGER*4  J               !
        INTEGER*4  YEAR,EMIS

	DATA TSROFF/TWTROW1,TWTROW2,TWTROW3/
	DATA TSSOFF/TWTSEL1,TWTSEL2,TWTSEL3/
C
	ST=0
	GIND=TRABUF(TGAMIND)
	KGAM=TRABUF(TWKGME)
	DRWTIM = P(CANDRW)*60
C
C CHECK KICKER GAME
C
	IF(TRABUF(TWKGME).EQ.0) KGAM = 0
	IF(KGAM.NE.0) THEN
	   KGIND=GNTTAB(GAMIDX,KGAM)
	   IF(KIKSTS(KGIND).GE.GAMBFD.AND.
     *	      TRABUF(TWKBEG).LE.KIKDRW(KGIND)) THEN
	      IF(P(ACTTIM).GT.KIKCTM(KGIND)+DRWTIM) THEN
	         ST=-1
		 RETURN
	      ENDIF
	   ENDIF
	   IF(TRABUF(TGAMTYP).EQ.TKIK) RETURN
	ENDIF
C
C
	IF(TRABUF(TGAMTYP).EQ.TLTO) THEN
	   IF(LTOSTS(GIND).LT.GAMBFD) RETURN
	   IF(TRABUF(TWBEG).GT.LTODRW(GIND)) RETURN 
	   IF(P(ACTTIM).GT.LTOCTM(GIND)+DRWTIM) ST = -1
	   RETURN
	ENDIF
C
	IF(TRABUF(TGAMTYP).EQ.TSPT) THEN
	   IF(SPTSTS(GIND).LT.GAMBFD) RETURN
	   IF(TRABUF(TWBEG).GT.SPTDRW(GIND)) RETURN
	   IF(P(ACTTIM).GT.SPTCTM(GIND)+DRWTIM) ST = -1
	   RETURN
	ENDIF
C
	IF(TRABUF(TGAMTYP).EQ.TTGL) THEN
	   IF(TGLSTS(GIND).LT.GAMBFD) RETURN
	   IF(TRABUF(TWBEG).GT.TGLDRW(GIND)) RETURN
	   IF(P(ACTTIM).GT.TGLCTM(GIND)+DRWTIM) ST = -1
	   RETURN
	ENDIF
C
        IF(TRABUF(TGAMTYP).EQ.TPAS) THEN
           YEAR=MOD(TRABUF(TWEPYR),10)
           EMIS = PASEXTDRW(TRABUF(TWEPWK),YEAR,GIND)  
 	   IF(PASSTS(EMIS,GIND).LT.GAMBFD) RETURN
	   IF(P(ACTTIM).GT.PASCTM(EMIS,GIND)+DRWTIM) ST = -1
        ENDIF
C
        IF(TRABUF(TGAMTYP).EQ.TBNG) THEN
           IF(BNGSTS(GIND).LT.GAMBFD) RETURN
           IF(TRABUF(TWBEG).GT.BNGDRW(GIND)) RETURN
           IF(P(ACTTIM).GT.BNGCTM(GIND)+DRWTIM) ST = -1
           RETURN
        ENDIF
C
	IF(TRABUF(TGAMTYP).EQ.TNBR) THEN
	   IF(NBRSTS(GIND).LT.GAMBFD) RETURN
	   IF(TRABUF(TWNAND).EQ.0) THEN
	      IF(TRABUF(TWBEG).GT.NBRDRW(GIND)) RETURN
	   ELSE
              IF(TRABUF(TWBEG).NE.NBRDRW(GIND).AND.
     *           TRABUF(TWEND).NE.NBRDRW(GIND)) RETURN
	   ENDIF
	   IF(P(ACTTIM).GT.NBRCTM(GIND)+DRWTIM) ST = -1
	   RETURN
	ENDIF
C
        IF(TRABUF(TGAMTYP).EQ.TSCR) THEN
           IF(SCRSTS(GIND).LT.GAMBFD) RETURN
           IF(TRABUF(TWBEG).GT.SCRDRW(GIND)) RETURN
           IF(P(ACTTIM).GT.SCRCTM(GIND)+DRWTIM) ST = -1
           RETURN
        ENDIF
C
        IF(TRABUF(TGAMTYP).EQ.TWIT) THEN
           IF(WITSTS(GIND).LT.GAMBFD) RETURN
           IF(TRABUF(TWBEG).GT.WITDRW(GIND)) RETURN
           IF(P(ACTTIM).GT.WITCTM(GIND)+DRWTIM) ST = -1
           RETURN
        ENDIF
C
        IF(TRABUF(TGAMTYP).EQ.TDBL) THEN
           IF(DBLSTS(GIND).LT.GAMBFD) RETURN
           IF(TRABUF(TWBEG).GT.DBLDRW(GIND)) RETURN
           IF(P(ACTTIM).GT.DBLCTM(GIND)+DRWTIM) ST = -1
           RETURN
        ENDIF
C
        IF(TRABUF(TGAMTYP).EQ.TCPL) THEN
           IF(CPLSTS(GIND).LT.GAMBFD) RETURN
           IF(TRABUF(TWBEG).GT.CPLDRW(GIND)) RETURN
           IF(P(ACTTIM).GT.CPLCTM(GIND)+DRWTIM) ST = -1
           RETURN
        ENDIF
C
        IF(TRABUF(TGAMTYP).EQ.TSSC) THEN
           IF(SSCSTS(GIND).LT.GAMBFD) RETURN
           IF(TRABUF(TWBEG).GT.SSCDRW(GIND)) RETURN
           IF(P(ACTTIM).GT.SSCCTM(GIND)+DRWTIM) ST = -1
           RETURN
        ENDIF
C
        IF(TRABUF(TGAMTYP).EQ.TTRP) THEN
           IF(TRPSTS(GIND).LT.GAMBFD) RETURN
           IF(TRABUF(TWBEG).GT.TRPDRW(GIND)) RETURN
           IF(P(ACTTIM).GT.TRPCTM(GIND)+DRWTIM) ST = -1
           RETURN
        ENDIF
C
        IF(TRABUF(TGAMTYP).EQ.TSTR) THEN
           IF(STRSTS(GIND).LT.GAMBFD) RETURN
           IF(TRABUF(TWBEG).GT.STRDRW(GIND)) RETURN
           IF(P(ACTTIM).GT.STRCTM(GIND)+DRWTIM) ST = -1
           RETURN
        ENDIF

        IF(TRABUF(TGAMTYP).EQ.TTSL) THEN
	   DO 10 I = 1,TRABUF(TWNBET)
	      DO 10 J = 0,TRABUF(TSSOFF(I))-1
	         ROW = TRABUF(TSROFF(I)+(J*TWTBLEN))
		 IF(TSLSTA(ROW,GIND).GE.GAMBFD.AND.
     *		    P(ACTTIM).GT.TSLCTM(ROW,GIND)+DRWTIM) ST = -1
10	   CONTINUE
	   RETURN
        ENDIF
C
	ST=-1
	RETURN
	END
