C
C SUBROUTINE TSODSNP
C
C V15 27-NOV-1997 UXN ROWTYP field added for PITKA.
C V14 17-APR-1996 HXK Release of Finland for X.25, Telephone Betting,
C                     Instant Pass Thru Phase 1
C V13 06-FEB-1996 RXK If TSLRWS(gind)<3 then game is not active, return   
C V12 22-JAN-1996 RXK Real value calculation for amounts
C V11 16-JAN-1996 RXK RFSS 95190. Multiplier 6 for TSPPOL introduced
C V09 04-SEP-1995 PXB
C V08 02-FEB-1994 HXK CHANGES FOR FINLAND ODDSET INSTALLATION
C V07 01-FEB-1994 HXK ENLARGED AMOUNTS BET FIELD
C V06 22-OCT-1993 HXK BUG FIX.
C V05 19-OCT-1993 HXK CHANGED OREDER OF ODDS FROM 12X TO 1X2.
C V04 13-JUN-1993 HXK added AGTINF.DEF, PRMAGT.DEF
C V03 21-JAN-1993 DAB Initial Release Based on Netherlands Bible, 12/92,
C                     and Comm 1/93 update DEC Baseline
C V02 22-OCT-1991 GCAN INITIAL RELEASED FOR THE NETHERLANDS
C V01 01-AUG-1990 XXX  RELEASED FOR VAX
C
C
C VIS_TSODSNP.FOR
C
C
C TO SHOW COMPUTED ODDS AND FIXED ODDS FOR TOTOSELECT GAME.
C
C
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C This item is the property of GTECH Corporation, Providence, Rhode
C Island, and contains confidential and trade secret information. It
C may not be transferred from the custody or control of GTECH except
C as authorized in writing by an officer of GTECH. Neither this item
C nor the information it contains may be used, transferred,
C reproduced, published, or disclosed, in whole or in part, and
C directly or indirectly, except as expressly authorized by an
C officer of GTECH, pursuant to written agreement.
C
C Copyright 1994 GTECH Corporation. All rights reserved.
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C
C=======OPTIONS /CHECK=NOOVERFLOW
	SUBROUTINE TSODSNP(DRAW,GIND,ROWNUM)
	IMPLICIT NONE
C
	INCLUDE 'INCLIB:SYSPARAM.DEF'
	INCLUDE 'INCLIB:SYSEXTRN.DEF'
C
	INCLUDE 'INCLIB:GLOBAL.DEF'
	INCLUDE 'INCLIB:CONCOM.DEF'
        INCLUDE 'INCLIB:AGTINF.DEF'
        INCLUDE 'INCLIB:PRMAGT.DEF'
	INCLUDE 'INCLIB:VISCOM.DEF'
	INCLUDE 'INCLIB:TSLCOM.DEF'
	INCLUDE 'INCLIB:DTSREC.DEF'
	INCLUDE 'INCLIB:HASHMEM.DEF'
 	INCLUDE 'INCLIB:RECTPF.DEF'
	INCLUDE 'INCLIB:DATBUF.DEF'
	INCLUDE 'INCLIB:GTNAMES.DEF'
C
C DEFINE TABLES
C
	INTEGER*2 BEGSAL(LDATE_LEN),ENDSAL(LDATE_LEN)
	INTEGER*4 FDB(7),PFDB(7)
	INTEGER*4 PARODD(3,MAXSRW)
	INTEGER*4 GIND,GNUM
	INTEGER*4 DRAW,ROW,COLUM,ST,INDEX
	INTEGER*4 SELSAL,ROWNUM
	INTEGER*4 LNS,I,K
	INTEGER*4 R_ODD1,R_ODD2,R_ODD3

        REAL*8    TOTSAL(MAXSRW),TSTPOL(MAXSRW,3),SELPOL

C
C CHECK FOR VALID PARAMETERS
C
	IF(GIND.LT.1.OR.GIND.GT.NUMTSL) THEN
	   WRITE(CLIN23,3000) GTNAMES(TTSL)
	   RETURN
	ENDIF
C
	GNUM=GTNTAB(TTSL,GIND)
	IF(GNUM.LT.1) THEN
	   WRITE(CLIN23,3010) GTNAMES(TTSL),GIND
	   RETURN
	ENDIF
        IF(TSLRWS(GIND).LT.3) THEN
	   WRITE(CLIN23,3010) GTNAMES(TTSL),GIND
           RETURN
        ENDIF
C
	IF(DRAW.LT.1) DRAW=DAYDRW(GNUM)
	IF(DRAW.EQ.0) DRAW=DAYHDR(GNUM)
	IF(DRAW.LE.0) DRAW=1
C
	IF(ROWNUM.LT.1.OR.ROWNUM.GT.TSLRWS(GIND)) ROWNUM=1
	IF(ROWNUM.GT.TSLRWS(GIND)-17) ROWNUM=TSLRWS(GIND)-17
C
C GET DATA FROM COMMON OR DISK
C
	IF(DRAW.EQ.DAYDRW(GNUM)) THEN
	   CALL GAMLOG(TTSL,GIND,DTSREC,TSLSTS)
	   DO 100 ROW=1,TSLRWS(GIND)
	      DO 100 COLUM=1,3
	         TSTPOL(ROW,COLUM)=
     *              DFLOAT(TSPPOL(DOLAMT,ROW,COLUM,GIND))/6.D0
100	   CONTINUE
	ELSE
C
C OPEN TOTOSELECT GAME FILE AND READ IN RECORD PASSED AS DRAW
C
	   CALL OPENW(1,GFNAMES(1,GNUM),4,0,0,ST)
	   CALL IOINIT(FDB,1,DTSSEC*256)
	   IF(ST.NE.0) THEN
	      WRITE(CLIN23,3020) (GFNAMES(K,GNUM),K=1,5),ST
	      CALL USRCLOS1(1)
	      RETURN
	   ENDIF
C
	   CALL READW(FDB,DRAW,DTSREC,ST)
	   IF(ST.NE.0) THEN
	      WRITE(CLIN23,3030) (GFNAMES(K,GNUM),K=1,5),DRAW,ST
	      CALL USRCLOS1(1)
	      RETURN
	   ENDIF
C
C CHECK IF GAME IS INITILIZED
C
	   IF(DTSSTS.EQ.GAMNUL) THEN
	      WRITE(CLIN23,3040) GTNAMES(TTSL),GIND,DRAW
	      CALL USRCLOS1(1)
	      RETURN
	   ENDIF
C
C TRYE TO OPEN SELECT POOL FILE, IF IT DOES NOT EXIST NOTIFY OP
C
	   CALL OPENW(2,DTSPFN(1),4,0,0,ST)
	   CALL IOINIT(PFDB,2,TPFBUF*256)
	   IF(ST.NE.0) THEN
	      WRITE(CLIN23,3050) (DTSPFN(K),K=1,5),ST
	      CALL USRCLOS1(1)
	      CALL USRCLOS1(2)
	      RETURN
	   ENDIF
C
	   CALL READW(PFDB,1,TPFREC,ST)
	   IF(ST.NE.0) THEN
	      WRITE(CLIN23,3030) (DTSPFN(K),K=1,5),1,ST
	      CALL USRCLOS1(1)
	      CALL USRCLOS1(2)
	      RETURN
	   ENDIF
C
C STUFF TEMP POOL VARIABLES WITH POOL FILE VARIABLES
C
	   INDEX=2
	   DO 110 ROW=1,TSLRWS(GIND)
	      DO 110 COLUM=1,3
	         TSTPOL(ROW,COLUM)=DFLOAT(TPFPOL(INDEX))
	         INDEX=INDEX+3
110	   CONTINUE
	   CALL USRCLOS1(1)
	   CALL USRCLOS1(2)
	ENDIF
C
C CALCULATE TOTAL SALES FOR EACH ROW THEN DO ALL CALCULATIONS
C
	DO 220 ROW=1,TSLRWS(GIND)
	   TOTSAL(ROW)=0.D0
	   DO 200 COLUM=1,3
	      TOTSAL(ROW)=TOTSAL(ROW)+TSTPOL(ROW,COLUM)
200	   CONTINUE
	   DO 210 COLUM=1,3
	      IF(DTSSAL.EQ.0) THEN
	         SELSAL=1
	      ELSE
	         SELSAL=DTSSAL
	      ENDIF
	      IF(TSTPOL(ROW,COLUM).NE.0.D0) SELPOL=TSTPOL(ROW,COLUM)
	      IF(TOTSAL(ROW).EQ.0D0.OR.TSTPOL(ROW,COLUM).EQ.0.D0) THEN
	         PARODD(COLUM,ROW)=0
	      ELSE
	         PARODD(COLUM,ROW)=INT(TOTSAL(ROW)/SELPOL*100)
	      ENDIF
              IF(PARODD(COLUM,ROW).GT.99999) PARODD(COLUM,ROW)=99999
210	   CONTINUE
220	CONTINUE
C
C GET DATES FOR SNAP HEADING
C
	BEGSAL(VCDC)=DTSBSD
	ENDSAL(VCDC)=DTSESD
	CALL LCDATE(BEGSAL)
	CALL LCDATE(ENDSAL)
C
C ENCODE DATA FOR TSODSNP
C
	WRITE(CLIN1,1001) GTNAMES(TTSL),GIND,(BEGSAL(I),I=7,11),
     *			  (ENDSAL(I),I=9,13)
	WRITE(CLIN2,1004) GTNAMES(TTSL)
	WRITE(CLIN3,1002) DRAW
	WRITE(CLIN4,1005)
	LNS=5
	DO 300 ROW=ROWNUM,ROWNUM+17
	   R_ODD1 = MOD(PARODD(1,ROW),100)
	   R_ODD1 = IABS(R_ODD1)
	   R_ODD2 = MOD(PARODD(2,ROW),100)
	   R_ODD2 = IABS(R_ODD2)
	   R_ODD3 = MOD(PARODD(3,ROW),100)
	   R_ODD3 = IABS(R_ODD3)
	   WRITE(XNEW(  LNS),1003) ROW,(DTSNMS(I,1,ROW),I=1,2),
     *	   (DTSNMS(I,2,ROW),I=1,2),
     *     DTSROWTYP(ROW),
     *	   PARODD(1,ROW)/100,R_ODD1,     ! 1
     *     PARODD(3,ROW)/100,R_ODD3,     ! X
     *     PARODD(2,ROW)/100,R_ODD2,     ! 2
     *	   DTSODS(1,ROW)/100,MOD(DTSODS(1,ROW),100),     ! 1
     *     DTSODS(3,ROW)/100,MOD(DTSODS(3,ROW),100),     ! X
     *     DTSODS(2,ROW)/100,MOD(DTSODS(2,ROW),100),     ! 2
     *	   TOTSAL(ROW)*DYN_BETUNIT/100.D0

C     *	   PARODD(1,ROW)/100,ABS(MOD(PARODD(1,ROW),100)),     ! 1
C     *     PARODD(3,ROW)/100,ABS(MOD(PARODD(3,ROW),100)),     ! X
C     *     PARODD(2,ROW)/100,ABS(MOD(PARODD(2,ROW),100)),     ! 2

	   LNS=LNS+1
300	CONTINUE
	RETURN
C
C FORMAT STATEMENTS FOR TSODSNP
C
1001	FORMAT('*',A8,I1,' Odds:',5A2,'- ',5A2,' *')
1002	FORMAT(1X,'Event code ',I4,14X,'Calculated odds',8X,
     *	       'Fixed odds',9X,'Amt. bet')
1003	FORMAT(1X,I2.2,1X,2A4,1X,' - ',2A4,2X,I1,
     *         1X,I3,'.',I2.2,
     *         1X,I3,'.',I2.2,
     *         1X,I3,'.',I2.2,
     *	       1X,I3,'.',I2.2,
     *         1X,I3,'.',I2.2,
     *         1X,I3,'.',I2.2,
     *         1X,F10.2)
1004	FORMAT(1X,A8,1X,'CALCULATED ODDS')
1005	FORMAT(1X,'Row',1X,'Team names',10X,'Typ',3X,'1',6X,'X',6X,'2',6X,
     *         '1',6X,'X',6X,'2',4X,'Bet')
3000	FORMAT('Enter !',A8,' game index ')
3010	FORMAT(A8,1X,I1,' game not active')
3020	FORMAT(5A4,' Open error  st - ',I4)
3030	FORMAT(5A4,' Read error  record - ',I4,'  st - ',I4)
3040	FORMAT(A8,1X,I1,' game not initialized event - ',I4)
3050	FORMAT(5A4,' File open error  - ',I4,
     *	       ' (File does not exist on pack) ')
	END
