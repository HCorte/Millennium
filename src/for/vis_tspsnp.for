C SUBROUTINE TSPSNP
C  
C V12 17-APR-1996 HXK Release of Finland for X.25, Telephone Betting,
C                     Instant Pass Thru Phase 1
C V11 06-FEB-1996 RXK If TSLRWS(gind)<3 then game is not active, return
C V10 22-JAN-1996 RXK Real value calculation for amounts
C V09 16-JAN-1996 RXK RFSS 95190. Multiplier 6 for TSPPOL introduced
C V08 04-SEP-1995 PXB
C V07 08-AUG-1995 HXK Changed snapshot to allow large sales (RXK)
C V06 18-NOV-1993 SXH Made count fields I6
C V05 13-SEP-1993 GXA Changed display of fields from home away draw to
C                     home draw away.
C V04 13-JUN-1993 HXK added AGTINF.DEF, PRMAGT.DEF
C V03 21-JAN-1993 DAB Initial Release Based on Netherlands Bible, 12/92,
C                     and Comm 1/93 update DEC Baseline
C V02 22-OCT-1991 GCAN INITIAL RELEASED FOR THE NETHERLANDS
C V01 01-AUG-1990 XXX  RELEASED FOR VAX
C
C VISION SNAPSHOT FOR TOTO SELET POOLS WITH LOCKING OR
C UNLOCKING OF INDIVIDUAL ROWS AND MARKS.
C
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C This item is the property of GTECH Corporation, Providence, Rhode
C Island, and contains confidential and trade secret information. It
C may not be transferred from the custody or control of GTECH except
C as authorized in writing by an officer of GTECH. Neither this item
C nor the information it contains may be used, transferred,
C reproduced, published, or disclosed, in whole or in part, and
C directly or indirectly, except as expressly authorized by an
C officer of GTECH, pursuant to written agreement.
C
C Copyright 1991 GTECH Corporation. All rights reserved.
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C
C=======OPTIONS /CHECK=NOOVERFLOW
	SUBROUTINE TSPSNP(GIND,ROWNUM,CLINE)
	IMPLICIT NONE
C
	INCLUDE 'INCLIB:SYSPARAM.DEF'
	INCLUDE 'INCLIB:SYSEXTRN.DEF'
C
	INCLUDE 'INCLIB:GLOBAL.DEF'
	INCLUDE 'INCLIB:CONCOM.DEF'
	INCLUDE 'INCLIB:DATBUF.DEF'
	INCLUDE 'INCLIB:TSLCOM.DEF'
	INCLUDE 'INCLIB:DTSREC.DEF'
        INCLUDE 'INCLIB:AGTINF.DEF'
        INCLUDE 'INCLIB:PRMAGT.DEF'
	INCLUDE 'INCLIB:VISCOM.DEF'
	INCLUDE 'INCLIB:GTNAMES.DEF'
C
C
	REAL*8 LOKTAB(MAXSRW),UNLTAB(MAXSRW),LOCK,UNLOCK
	INTEGER*2 DATBUF(12)
	INTEGER*4 CBUF(CDLEN),CLINE(20)
	INTEGER*4 GIND,ROWNUM,ROW,UNLFLG,POS,VALUE,KEYNUM 
	INTEGER*4 SETVAL,ST,LNS
	CHARACTER*3 POLSTS(2)
	LOGICAL DEFIND/.FALSE./
C
	DATA POLSTS/'OPN','CLS'/
	DATA LOCK/'LOCK    '/
	DATA UNLOCK/'UNLOCK  '/
C
	IF(GIND.LT.1.OR.GIND.GT.NUMTSL) THEN
	   WRITE(CLIN23,1000) GTNAMES(TTSL), NUMTSL
	   RETURN
	ENDIF
	IF(TSLRWS(GIND).LE.3) THEN
	   WRITE(CLIN23,1005) GTNAMES(TTSL),GIND
	   RETURN
	ENDIF
C
C INIT VARIABLES
C
	UNLFLG=0
	CALL FASTSET(0,CBUF,CDLEN)
C
C DEFINE COMMANDS IF NOT ALREADY DEFINED
C
	IF(.NOT.DEFIND) THEN
	   DO 100 ROW=1,TSLRWS(GIND)
	      LOKTAB(ROW)=LOCK
	      UNLTAB(ROW)=UNLOCK
	      CALL BINASC(LOKTAB(ROW),5,2,ROW)
	      CALL BINASC(UNLTAB(ROW),7,2,ROW)
100	   CONTINUE
	   DEFIND=.TRUE.
	ENDIF
C
C CHECK COMMAND LINE FOR INFO
C
	POS=1
	CALL NUMB(CLINE,POS,VALUE)
	IF(VALUE.GE.1) ROWNUM=VALUE
C
C CHECK INPUT PARAMETERS FOR BOUNDRY ERRORS
C
	IF(ROWNUM.LT.1.OR.ROWNUM.GT.TSLRWS(GIND)) ROWNUM=1
	IF(ROWNUM.GT.TSLRWS(GIND)-17) ROWNUM=TSLRWS(GIND)-17
	POS=1
C
C GET CURRENT CDC DAY FOR HEADING
C
	DATBUF(VCDC)=DAYCDC
	CALL CDATE(DATBUF)
C
C LOCK OR UNLOCK A ROW AND BET
C
	CALL KEY(CLINE,LOKTAB,TSLRWS(GIND),POS,KEYNUM)
	IF(POS.GT.40) GOTO 300
	IF(KEYNUM.EQ.0) THEN
	   UNLFLG=1
	   CALL KEY(CLINE,UNLTAB,TSLRWS(GIND),POS,KEYNUM)
	   IF(POS.GT.40) GOTO 300
	ENDIF
	CALL NUMB(CLINE,POS,VALUE)
	IF(VALUE.LT.1.OR.VALUE.GT.3) THEN
	   WRITE(CLIN23,1023) 
	   RETURN
	ENDIF
C
C CONVERT VALUE
C
	SETVAL=VALUE
C
C SET COMMAND MESSAGE BUFFER
C
	CBUF(1)=3
	IF(UNLFLG.EQ.1) THEN
	   CBUF(2)=0
	ELSE
	   CBUF(2)=1
	ENDIF
	CBUF(3)=TCTSL
	CBUF(6)=IDNUM
	CBUF(8)=GIND
	CBUF(9)=KEYNUM
	CBUF(10)=SETVAL

	CALL VISCMD(CBUF,ST)
	CALL XWAIT(2,1,ST)
C
C ENCODE DATA FOR TSPSNP
C
300	CONTINUE
	WRITE(CLIN1,1001) GTNAMES(TTSL),GIND
	WRITE(CLIN2,1002)
	WRITE(CLIN3,1003)
	LNS=4
	DO 320 ROW=ROWNUM,ROWNUM+17
	   WRITE(XNEW(  LNS),1004) ROW,TSPPOL(1,ROW,ROWWIN,GIND),
     *		  DFLOAT(TSPPOL(2,ROW,ROWWIN,GIND))/6.D0*
     *                   DFLOAT(DYN_BETUNIT)/100.D0,
     *	          POLSTS(TSPLOK(ROW,ROWWIN,GIND)+1),
     *	          TSPPOL(1,ROW,ROWTIE,GIND),
     *		  DFLOAT(TSPPOL(2,ROW,ROWTIE,GIND))/6.D0*
     *                   DFLOAT(DYN_BETUNIT)/100.D0,
     *	          POLSTS(TSPLOK(ROW,ROWTIE,GIND)+1),
     *	          TSPPOL(1,ROW,ROWLOS,GIND),
     *		  DFLOAT(TSPPOL(2,ROW,ROWLOS,GIND))/6.D0*
     *                   DFLOAT(DYN_BETUNIT)/100.D0,
     *	          POLSTS(TSPLOK(ROW,ROWLOS,GIND)+1)
	   LNS=LNS+1
320	CONTINUE
C
C FORMAT STATEMENTS FOR TSPSNP
C
1000	FORMAT('Enter valid ',A8,' game index:  1  through ',I2) 
1001	FORMAT('* TSPSNP - ',A8,1X,I1,' pool snapshot *')
1002	FORMAT(11X,'(1)=1',21X,'(X)=3',20X,'(2)=2')
1003	FORMAT(4X,'COUNT',3X,'  AMOUNT',1X,' *STAT ',1X,'COUNT',3X,
     *	  '  AMOUNT',1X,' *STAT ',1X,'COUNT',3X,'  AMOUNT',1X,' *STAT ')
1004	FORMAT(I2,1X,I6,1X,F12.2,1X,A3,2X,I6,1X,F12.2,1X,A3,
     *	       2X,I6,1X,F12.2,1X,A3)
1005	FORMAT(A8,1X,I1,' game not active') 
1023	FORMAT('*** Value error ***')
	END
