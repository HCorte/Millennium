C
C PROGRAM YEARRPT
C
C V05 15-JUN-2000 UXN Unused variables removed.
C V04 14-SEP-1995 RXK On MAXTYP dependend array dimensions instead of 
C                     hardcoded ones
C V03 27-JUN-1993 HXK REARRANGED AGTINF.DEF
C V02 21-JAN-1993 DAB Initial Release
C                     Based on Netherlands Bible, 12/92, and Comm 1/93 update
C                     DEC Baseline
C V01 12-NOV-1991 MTK INITIAL RELEASE FOR NETHERLANDS
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C This item is the property of GTECH Corporation, Providence, Rhode
C Island, and contains confidential and trade secret information. It
C may not be transferred from the custody or control of GTECH except
C as authorized in writing by an officer of GTECH. Neither this item
C nor the information it contains may be used, transferred,
C reproduced, published, or disclosed, in whole or in part, and
C directly or indirectly, except as expressly authorized by an
C officer of GTECH, pursuant to written agreement.
C
C Copyright 1991 GTECH Corporation. All rights reserved.
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C
C=======OPTIONS /CHECK=NOOVERFLOW
	PROGRAM YEARRPT
	IMPLICIT NONE
C
	INCLUDE 'INCLIB:SYSPARAM.DEF'
	INCLUDE 'INCLIB:SYSEXTRN.DEF'
	INCLUDE 'INCLIB:GLOBAL.DEF'
	INCLUDE 'INCLIB:CONCOM.DEF'
	INCLUDE 'INCLIB:TASKID.DEF'
        INCLUDE 'INCLIB:AGTINF.DEF'
	INCLUDE 'INCLIB:AGTCOM.DEF'
	INCLUDE 'INCLIB:RECAGT.DEF'
	INCLUDE 'INCLIB:GTNAMES.DEF'
	INCLUDE 'INCLIB:DATBUF.DEF'
C
        INTEGER*4 LMAXIND
        PARAMETER(LMAXIND=MAXTYP+6)
C
	CHARACTER CZERO
	INTEGER*2 DBUF(LDATE_LEN)
	INTEGER*4 CANIND,CLMIND,DSCIND,SALIND,VALIND,REFIND
C
	INTEGER*4 GTYP, GAM, SCOM(2)
	INTEGER*4 I, ST, PAGE, LINCNT/60/, COPY, CNTACT
	INTEGER*4 DAT, REC, XREC, K, SRTCNT
	INTEGER*4 SORT(NUMAGT), TOT_ADJUST(2)
	INTEGER*4 AGT_ADJUST(2),TOT_WCOM(2)/2*0/
	INTEGER*4 VCOM(2),WCOM(2),TOT_SCOM(2)
	INTEGER*4 TOT_AMT(LMAXIND)/LMAXIND*0/,TOT_CNT(LMAXIND)/LMAXIND*0/
        INTEGER*4 TOT_VCOM(2)/2*0/
	INTEGER*4 TOT_AMTDUE(2)
C
	INTEGER*4 FDB(7),CNT(LMAXIND),AMT(LMAXIND)
	DATA CZERO/Z0/
C
C
C
	CNTACT = 0
        SALIND=MAXTYP+1
        VALIND=MAXTYP+2
        CANIND=MAXTYP+3
        CLMIND=MAXTYP+4
        DSCIND=MAXTYP+5
	REFIND=MAXTYP+6
	DAT=DAYCDC
	DBUF(5)=DAT
	CALL LCDATE(DBUF)
	COPY=1
C
C OPEN THE REPORT FILE
C
	CALL ROPEN('YEARRPT.REP',7,ST)
	IF(ST.NE.0) THEN
	   TYPE*,'INVRPT.REP Open error  st - ',ST
	   CALL USRCLOS1(7)
	   CALL GSTOP(GEXIT_SUCCESS)
	ENDIF
C
C OPEN ASF.FIL
C
	CALL OPENW(1,SFNAMES(1,ASF),0,0,0,ST)
	CALL IOINIT(FDB,1,ASFSEC*256)
	IF(ST.NE.0) THEN
	  CALL USRCLOS1(     1)
	ENDIF
C
C SORT BY AGENT NUMBER
C
	CALL SRTFLD(1,1,SORT,SRTCNT)
C
C READ ALL AGENTS
C
	DO 100 REC=1,SRTCNT
	   XREC = SORT(REC)
	   CALL READW(FDB,XREC,ASFREC,ST)
	   IF(ST.NE.0) THEN
	     CALL USRCLOS1(     1)
	   ENDIF
	   DO 110 I=1,512
	      IF(ASFBYT(I).EQ.CZERO) ASFBYT(I)=' '
110	   CONTINUE
C
C CLEAR ACCUMULATORS
C
           CALL FASTSET(0,AMT,LMAXIND)
           CALL FASTSET(0,CNT,LMAXIND)
C
C SALES DATA FROM FILE
C
	   DO 150 GAM=1,MAXGAM
	      GTYP=GNTTAB(GAMTYP,GAM)
	      IF(GTYP.LT.1.OR.GTYP.GT.MAXTYP) GOTO 150
	      CNT(GTYP)=CNT(GTYP)+ASFYTD(GSCNT,GAM,1)-
     *	                          ASFYTD(GCCNT,GAM,1)
	      AMT(GTYP)=AMT(GTYP)+ASFYTD(GSAMT,GAM,1)-
     *	                          ASFYTD(GCAMT,GAM,1)
	      CNT(SALIND)=CNT(SALIND)+ASFYTD(GSCNT,GAM,1)-
     *	                              ASFYTD(GCCNT,GAM,1)
	      AMT(SALIND)=AMT(SALIND)+ASFYTD(GSAMT,GAM,1)-
     *	                              ASFYTD(GCAMT,GAM,1)
	      CNT(VALIND)=CNT(VALIND)+ASFYTD(GVCNT,GAM,1)
	      AMT(VALIND)=AMT(VALIND)+ASFYTD(GVAMT,GAM,1)
	      CNT(CANIND)=CNT(CANIND)+ASFYTD(GCCNT,GAM,1)
	      AMT(CANIND)=AMT(CANIND)+ASFYTD(GCAMT,GAM,1)
	      CNT(CLMIND)=CNT(CLMIND)+ASFYTD(GCLCNT,GAM,1)
	      AMT(CLMIND)=AMT(CLMIND)+ASFYTD(GCLAMT,GAM,1)
	      CNT(DSCIND)=CNT(DSCIND)+ASFYTD(GDCNT,GAM,1)
	      AMT(DSCIND)=AMT(DSCIND)+ASFYTD(GDAMT,GAM,1)
              CNT(REFIND)=CNT(REFIND)+ASFYTD(GRCNT,GAM,1)
              AMT(REFIND)=AMT(REFIND)+ASFYTD(GRAMT,GAM,1)
150	   CONTINUE
C
C GET TOTAL COMMISION
C
	   SCOM(1)=0
	   SCOM(2)=0
	   VCOM(1)=0
	   VCOM(2)=0
	   WCOM(1)=0
	   WCOM(2)=0
	   AGT_ADJUST(1)=0
	   AGT_ADJUST(2)=0
	   CALL ADDI8I8(SCOM,ASFYTDINV(ASFSCMU,1),BETUNIT)
	   CALL ADDI8I8(VCOM,ASFYTDINV(ASFVCMU,1),BETUNIT)
	   CALL ADDI8I8(WCOM,ASFYTDINV(ASFWCMU,1),BETUNIT)
	   CALL ADDI8I8(AGT_ADJUST,ASFYTDINV(ASFPADU,1),BETUNIT)
	   CALL ADDI8I8(AGT_ADJUST,ASFYTDINV(ASFADJU,1),BETUNIT)
C
C WRITE TITLE IF NEEDED
C
	   IF(LINCNT.GT.LINSPP) THEN
	      CALL TITLE('AGENT YEAREND REPORT',
     *	                 'YEARRPT ',1,7,PAGE,DAYCDC)
	      WRITE(7,900)
	     LINCNT=6
	   ENDIF
C
C WRITE A LINE ON REPORT
C
           IF(AMT(SALIND).GT.0.OR.CNT(CANIND).GT.0) THEN
             CNTACT = CNTACT + 1
           ELSE
             GOTO 888
	   ENDIF
	   WRITE(7,901) (ASFBYT(K),K=SAGNO,EAGNO),
     *			CSMONY(AMT(SALIND),11,BETUNIT),
     *			CSMONYI8(AGT_ADJUST,10,BETUNIT),
     *			CNT(CANIND),CMONY(AMT(CANIND),11,BETUNIT),
     *			CNT(VALIND),CMONY(AMT(VALIND),11,VALUNIT),
     *                  CNT(REFIND),CMONY(AMT(REFIND),11,BETUNIT),
     *			CNT(CLMIND),CMONY(AMT(CLMIND),11,VALUNIT),
     *			CMONYI8(SCOM(1),10,BETUNIT),
     *                  CMONYI8(VCOM(1),8,BETUNIT),
     *                  CMONYI8(WCOM(1),8,BETUNIT),
     *			CSMONYI8(ASFYTDINV(ASFDUEU,1),12,BETUNIT)
	   LINCNT=LINCNT+1
888	   CONTINUE
C
C UPDATE GRAND TOTALS
C
	   DO 120 I=1,LMAXIND
	      TOT_CNT(I) = TOT_CNT(I) + CNT(I)
	      TOT_AMT(I) = TOT_AMT(I) + AMT(I)
120	   CONTINUE
	   CALL ADDI8I8(TOT_ADJUST,ASFYTDINV(ASFADJU,1),BETUNIT)
	   CALL ADDI8I8(TOT_ADJUST,ASFYTDINV(ASFPADU,1),BETUNIT)
	   CALL ADDI8I8(TOT_AMTDUE,ASFYTDINV(ASFDUEU,1),BETUNIT)
	   CALL ADDI8I8(TOT_SCOM,SCOM,BETUNIT)
           CALL ADDI8I8(TOT_VCOM,VCOM,BETUNIT)
	   CALL ADDI8I8(TOT_WCOM,WCOM,BETUNIT)
100	CONTINUE
C
C WRITE OUT TOTAL PAGE
C
        CALL TITLE('AGENT YEAREND REPORT',
     *	           'YEARRPT ',2,7,PAGE,DAYCDC)
	WRITE(7,902) CSMONYI8(TOT_ADJUST,12,BETUNIT),
     *		     CSMONY(TOT_AMT(SALIND),12,BETUNIT),
     *		     CMONY(TOT_AMT(CANIND),12,BETUNIT),
     *		     CMONY(TOT_AMT(VALIND),12,VALUNIT),
     *               CMONY(TOT_AMT(REFIND),12,BETUNIT),
     *		     CMONY(TOT_AMT(CLMIND),12,VALUNIT),
     *		     CMONYI8(TOT_SCOM(1),12,BETUNIT),
     *               CMONYI8(TOT_VCOM(1),12,BETUNIT),
     *               CMONYI8(TOT_WCOM(1),12,BETUNIT),
     *		     CSMONYI8(TOT_AMTDUE(1),12,BETUNIT),
     *               CNTACT
C
C SPOOL REPORTS
C
	CALL USRCLOS1(7)
	CALL SPOOL('YEARRPT.REP',COPY,ST)
C
C FORMAT STATEMENTS
C
900	FORMAT(30X,'-----CANCEL----',
     *         1X,'-----CASH------',
     *         1X,'----REFUND-----',
     *         1X,'-----CLAIM-----',/,
     *         1X,'AGTNUM',3X,'NET SALES',4X,'ADJUST',
     *         1X,4('CNT      AMOUNT '),
     *         4X,'SALCOM  VALCOM  WINCOM     NET DUE',/)
901	FORMAT(1X,<LAGNO>(A1),1X,A11,A10,4(I4,1X,A11),A10,2(A8),A12)
902	FORMAT(42X,'TOTAL ADJUSTMENT AMOUNT .........    ',A12,/,
     *	       42X,'TOTAL NET SALES AMOUNT...........    ',A12,/,
     *	       42X,'TOTAL DISCOUNT AMOUNT............    ',A12,/,
     *	       42X,'TOTAL CANCEL AMOUNT..............    ',A12,/,
     *         42X,'TOTAL CASH AMOUNT................    ',A12,/,
     *         42X,'TOTAL CLAIM AMOUNT...............    ',A12,/,
     *         42X,'TOTAL SALES COMMISSION ..........    ',A12,/,
     *         42X,'TOTAL VALIDATION COMMISSION .....    ',A12,/,
     *         42X,'TOTAL WINNERS COMMISSION ........    ',A12,/,
     *         42X,'TOTAL NET DUE AMOUNT.............    ',A12,/
     *         42X,'TOTAL ACTIVE AGENTS..............    ',I12)
	END
