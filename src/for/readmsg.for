C SUBROUTINE READMSG
C
C V03 21-JUN-2000 OXK CLEANUP W/ WARNINGS=ALL
C V02 06-MAR-1996 wsm Return if length is zero.
C V01 04-MAR-1996 wsm Extracted from ALLDLL for Finland.
C
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C READ MESSAGE FROM MSGCOM OR DISCIMG INTO MSGBUF:
C
C=======OPTIONS /CHECK=NOOVERFLOW
C
	SUBROUTINE READMSG(IMGCHR, MSGNUM, MSGBUF, MSGLEN)
C
	IMPLICIT NONE
C
	INCLUDE 'INCLIB:SYSPARAM.DEF'
	INCLUDE 'INCLIB:SYSEXTRN.DEF'
	INCLUDE 'INCLIB:MSGCOM.DEF'
C
	INTEGER*4	LENGTH,
     *			LOCMSG,
     *			MSGLEN,
     *			MSGNUM
C
	CHARACTER*(*)		MSGBUF
	CHARACTER*(MSGSZH*2)	IMGCHR(*)
C
	LOCMSG = MSGNUM					! LOCAL COPY OF MSGNUM.
	MSGLEN = 0
10	LENGTH = I4MSGTAB(SEGLEN, LOCMSG)
        IF (LENGTH.LE.0) RETURN                         !V02
	MSGBUF(MSGLEN+1: MSGLEN+LENGTH) = IMGCHR(LOCMSG)(:LENGTH)
	MSGLEN = MSGLEN + LENGTH
C
	IF (MSGLEN .GT. LEN(MSGBUF))THEN
	  WRITE(6, *) 'ERROR: MESSAGE TOO BIG, TRUNCATED TO FIT.'
	  RETURN
	ENDIF
C
	LOCMSG = I4MSGTAB(MSGLNK, LOCMSG)			! LOCMSG = NEXT SEGMENT.
	IF (LOCMSG .LE. 0) RETURN			! NO MORE SEGMENTS.
	GOTO 10						! CONTINUE.
C
	END
C
