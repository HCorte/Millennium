C
C SUBROUTINE X2RSTART
C
C*************************** START X2X PVCS HEADER ****************************
C
C  $Logfile::   GXAFXT:[GOLS]X2RSTART.FOV                                 $
C  $Date::   17 Apr 1996 16:32:22                                         $
C  $Revision::   1.0                                                      $
C  $Author::   HXK                                                        $
C
C**************************** END X2X PVCS HEADER *****************************
C
C  Based on Netherlands Bible, 12/92, and Comm 1/93 update
C  DEC Baseline
C
C ** Source - x2rstart.for;1 **
C
C X2RSTART.FOR
C
C V04 12-DEC-94 DAS Integrate UK changes into X2X Baseline
C V02 21-JUL-94 WS MULTINETWORK CHANGES - COMPLETE REWRITE OF THIS SUBROUTINE
C V01 01-AUG-90 XXX RELEASED FOR VAX
C
C
C     X2RSTART.FTN
C     ____________
C
C     X2RSTART AND X2RSTOP SUBROUTINES - START AND STOP RELAY
C     PROCESS SUBROUTINES
C
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++
C
C     START PROCESS
C
C
C     X2RSTART(BUFFER,PROCESS,POLL_STATUS,DESTINATION,MES_NUM,LENGTH,
C              DATA,MESSAGE_DESTINATION,FORMAT,SUBNETWORK)		!V02
C
C     IN:
C     PROCESS     -  PROCESS #
C     POLL STATUS -  0 -- POLL ENABLED
C		     1 -- POLL DISABLED
C     DESTINATION -  DESTINATION GROUP/TERMINAL NUMBER
C                    NEGATIVE 1 IF COMMAND TO ALL STATIONS/GROUPS
C     MES_NUM     -  MESSAGE NO TO SEND (ONLY FOR SINGLE MESSAGE BRO)
C     LENGTH      -  LENGTH OF DATA TO SEND (SINGLE MESSAGE BROADCAST
C     DATA        -  DATA TO BE SENT FOR SINGLE MESSAGE BROADCAST
C     MESSAGE_DESTINATION - SAME AS DESTINATION FLAGS IN FLAG FIELD
C                           1 - TERMINALS
C                           2 - STATIONS
C                           3 - HOST
C     FORMAT      -  SAME AS RELAY ATRIBUTE:
C                    GROUP RELAY - 1 (RELAY FORMAT)
C                    ALL STATIONS- 2 (RELAY FORMAT)
C                    NON FORMATED BROADCAST TO TERMINALS - 3
C                    NON FORMATED BROADCAST TO STATION   - 4
C     SUBNETWORK  - SUBNETWORK NO (-1 FOR ALL SUBNETWORKS) - V02
C     E.G. TO START CHAIN DOWNLOAD TO THIS:
C     (1) CALL GETBUF(PROBUF)
C     (2) CALL X2RSTART(PRO(1,PROBUF),1[CHAIN DLL],0[ALLOW POLLING],
C         -1 [TO ALL GROUPS],0[NO MESSAGE NO],0[NO LENGTH],DUMMY[DUMMY TAB],
C         1[TERMINALS],1[GROUP RELAY FORMAT],0[SUBNETWORK NO 0]) - V02
C     (3) CALL X2RADDBF(PROBUF)   - ADD BUFFER TO X2XREL QUE
C
C     TO DO UNSOLICITED DLL TO ALL SET PROCESS=2, FORMAT=4
C
C     TO SEND SINGLE MESSAGE "HELLO" TO TERMINALS DO THIS
C     INTEGER*4 HELLO_MES(2) /'HELL','O   '/
C
C     CALL GETBUF(PROBUF)
C     CALL X2START(PRO(1,PROBUF),3 [APP 3..6 IS VALID],0[ALLOWPOLLING]
C                  -1[ALL STATNS,0[NO MESSAGE],5[LENGTH],HELLO_MES,
C                   1[TERMINALS],3[BRO TO TERMS],-1 [ALL SUBNETWORKS]) - V02
C
C
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C This item is the property of GTECH Corporation, Providence, Rhode
C Island, and contains confidential and trade secret information. It
C may not be transferred from the custody or control of GTECH except
C as authorized in writing by an officer of GTECH. Neither this item
C nor the information it contains may be used, transferred,
C reproduced, published, or disclosed, in whole or in part, and
C directly or indirectly, except as expressly authorized by an
C officer of GTECH, pursuant to written agreement.
C
C Copyright 1994 GTECH Corporation. All rights reserved.
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C
C=======OPTIONS /CHECK=NOOVERFLOW
	SUBROUTINE X2RSTART(BUFFER,PROCESS,POLL_STATUS,DESTINATION,
     *                      MES_NUM,LENGTH,DATA_BUFFER,MSG_DESTINATION,
     *                      MSG_FORMAT,SUBNETWORK)		!V02
	IMPLICIT NONE
C
	INCLUDE 'INCLIB:SYSPARAM.DEF'
	INCLUDE 'INCLIB:SYSEXTRN.DEF'
	INCLUDE 'INCLIB:PROCOM.DEF'
	INCLUDE 'INCLIB:X2RCMD.DEF'
	INCLUDE 'INCLIB:X2XCOM.DEF'			!V02
	INCLUDE 'INCLIB:X2XREL.DEF'			!V02
C
C
	INTEGER*4  INPTAB2
	PARAMETER (INPTAB2=INPTAB*2-1)
C
	INTEGER*2 BUFFER(*)
	INTEGER*2 DATA_BUFFER(*)
	INTEGER*4 SPARE_BUF(128)
	INTEGER*4 MSG_FORMAT, MSG_DESTINATION, LENGTH, MES_NUM
	INTEGER*4 DESTINATION, PROCESS, POLL_STATUS
	INTEGER*4 SUBNETWORK				!V02

	INTEGER*4 ALREADY_SENT(0:255)			!V02
	INTEGER*4 NEXT_SUBNETWORK, PROBUF		!V02
	INTEGER*4 NEXT_PROCESS
C
C	START OF V02 CHANGE BLOCK

	IF (LENGTH.GT.0)
     *	      CALL MOVBYT(DATA_BUFFER,1,SPARE_BUF,1,LENGTH)
	IF (SUBNETWORK.GE.0) THEN
	    BUFFER(TRCODE)=TYPX2X_RELAY_CMD
	    CALL ISBYTE(X2RCMD_START,BUFFER(INPTAB2),X2ROFF_CMD-1)
	    CALL ISBYTE(PROCESS,BUFFER(INPTAB2),X2ROFF_PROCESS-1)
	    CALL ISBYTE(POLL_STATUS,BUFFER(INPTAB2),X2ROFF_POLL-1)
	    CALL I4TOBUF4(DESTINATION,BUFFER(INPTAB2),X2ROFF_DEST-1)
	    CALL ISBYTE(SUBNETWORK,BUFFER(INPTAB2),X2ROFF_SUBNETWORK-1)
	    CALL I4TOBUF2(MES_NUM,BUFFER(INPTAB2),X2ROFF_DATA_MSGNUM-1)
	    CALL I4TOBUF2(LENGTH,BUFFER(INPTAB2),X2ROFF_DATA_LEN-1)
	    CALL ISBYTE(MSG_DESTINATION,BUFFER(INPTAB2),X2ROFF_DATA_DEST-1)
	    CALL ISBYTE(MSG_FORMAT,BUFFER(INPTAB2),X2ROFF_DATA_ATRIBUTE-1)
C
C****	    TYPE *,'Sending to subnet ',SUBNETWORK,PROBUF
	    IF (LENGTH.GT.0)
     *	      CALL MOVBYT(SPARE_BUF,1,BUFFER(INPTAB2),X2ROFF_DATA,LENGTH)
	ELSE
	    IF (PROCESS.GT.0.AND.PROCESS.LT.X2XR_FIRST_COMMON_PROCESS)
     *				  GOTO 9000
	    CALL FASTSET(0,ALREADY_SENT,256)
	    DO 100, NEXT_PROCESS=X2XR_FIRST_COMMON_PROCESS,
     *			      X2X_RELAY_APPS
C****		TYPE *,'Checking RELAY PROCESS ',NEXT_PROCESS
		IF (X2XR_APP_STATUS(NEXT_PROCESS).EQ.0) GOTO 100
		NEXT_SUBNETWORK=X2XR_SUBNETWORK(NEXT_PROCESS)
		IF (ALREADY_SENT(NEXT_SUBNETWORK).NE.0) THEN
		    CALL OPS('Subnetwork defined in to many relays ',
     *				 NEXT_SUBNETWORK,0)
		    GOTO 100
		ENDIF
C****		TYPE *,'should send, SUBNET ',NEXT_SUBNETWORK
		ALREADY_SENT(NEXT_SUBNETWORK)=-1
		CALL GETBUF(PROBUF)
		IF (PROBUF.LE.0) GOTO 9000
		HPRO(TRCODE,PROBUF)=TYPX2X_RELAY_CMD
		CALL ISBYTE(X2RCMD_START,HPRO(INPTAB2,PROBUF),
     *		      X2ROFF_CMD-1)
		CALL ISBYTE(PROCESS,HPRO(INPTAB2,PROBUF),
     *		      X2ROFF_PROCESS-1)
		CALL ISBYTE(POLL_STATUS,HPRO(INPTAB2,PROBUF),
     *		      X2ROFF_POLL-1)
		CALL I4TOBUF4(DESTINATION,HPRO(INPTAB2,PROBUF),
     *		      X2ROFF_DEST-1)
		CALL ISBYTE(NEXT_SUBNETWORK,HPRO(INPTAB2,PROBUF),
     *		      X2ROFF_SUBNETWORK-1)
		CALL I4TOBUF2(MES_NUM,HPRO(INPTAB2,PROBUF),
     *		      X2ROFF_DATA_MSGNUM-1)
		CALL I4TOBUF2(LENGTH,HPRO(INPTAB2,PROBUF),
     *		      X2ROFF_DATA_LEN-1)
		CALL ISBYTE(MSG_DESTINATION,HPRO(INPTAB2,PROBUF),
     *		      X2ROFF_DATA_DEST-1)
		CALL ISBYTE(MSG_FORMAT,HPRO(INPTAB2,PROBUF),
     *		      X2ROFF_DATA_ATRIBUTE-1)
C
		IF (LENGTH.GT.0) CALL MOVBYT(SPARE_BUF,1,
     *			  HPRO(INPTAB2,PROBUF),X2ROFF_DATA,LENGTH)

C****		TYPE *,'Sending PROBUF ',PROBUF,LENGTH
		CALL X2RADDBF(PROBUF)
100	    CONTINUE
	ENDIF		
9000	CONTINUE
C	END OF V02 CHANGE BLOCK
	RETURN
	END
