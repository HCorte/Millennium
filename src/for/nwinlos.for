C
C SUBROUTINE NWINLOS
C $Log:   GXAFXT:[GOLS]NWINLOS.FOV  $
C  
C     Rev 1.0   17 Apr 1996 14:15:34   HXK
C  Release of Finland for X.25, Telephone Betting, Instant Pass Thru Phase 1
C  
C     Rev 1.0   21 Jan 1993 17:10:54   DAB
C  Initial Release
C  Based on Netherlands Bible, 12/92, and Comm 1/93 update
C  DEC Baseline
C
C ** Source - dwnsub.for **
C
C
C
C
C=======OPTIONS /CHECK=NOOVERFLOW
	SUBROUTINE NWINLOS(TRABUF,SHARES,WIN)
	IMPLICIT NONE
C
	INCLUDE 'INCLIB:SYSPARAM.DEF'
	INCLUDE 'INCLIB:SYSEXTRN.DEF'
	INCLUDE 'INCLIB:GLOBAL.DEF'
	INCLUDE 'INCLIB:DWNCOM.DEF'
	INCLUDE 'INCLIB:CONCOM.DEF'
	INCLUDE 'INCLIB:DESTRA.DEF'
	INTEGER*4 SHARES(3,NMAXBT),DIG(4)
	INTEGER*4 WIN, GIND, K, I, NUM, AMT, POL, N, FLAG, TEMP, BOXNUM
	INTEGER*4 BNS, J
C
C
	WIN=0
	GIND=TRABUF(TGAMIND)
	CALL FASTSET(0,SHARES,NMAXBT*3)
        IF(TRABUF(TWNTYP).EQ.NB4TYP) GOTO 1000
        IF(TRABUF(TWNTYP).NE.NB3TYP) RETURN
C
C THREE DIGIT GAME
C
	DO 100 J=0,LNBBDR(GIND)
	BNS=0
	IF(J.NE.0) BNS=1
        DO 100 K=0,TRABUF(TWNBET)-1
        NUM=TRABUF(TWNNUM1+K*3)
        AMT=TRABUF(TWNAMT1+K*3)/LNBPRC(GIND)
        POL=TRABUF(TWNPOL1+K*3)
	IF(POL.GT.TNB3ST) THEN
          N=NUM
          DO 10 I=1,3
          DIG(I)=MOD(N,10)
          N=N/10
10        CONTINUE
20        CONTINUE
          FLAG=0
          DO 30 I=2,3
          IF(DIG(I).GE.DIG(I-1)) GOTO 30
          TEMP=DIG(I)
          DIG(I)=DIG(I-1)
          DIG(I-1)=TEMP
          FLAG=1
30        CONTINUE
          IF(FLAG.NE.0) GOTO 20
          BOXNUM=DIG(3)+DIG(2)*10+DIG(1)*100
        ENDIF
C
C CHECK STRAIGHT BETS
C
        IF(POL.LE.TNB3ST) THEN
          IF(NUM.EQ.LNBWIN(POL,J+1,GIND)) THEN
	    WIN=WIN+1
	    SHARES(1,WIN)=POL
	    SHARES(2,WIN)=AMT
	    SHARES(3,WIN)=BNS
	  ENDIF
          GOTO 100
        ENDIF
C
C CHECK BOX BETS
C
        IF(POL.EQ.TNB3B3.OR.POL.EQ.TNB3B6) THEN
          IF(BOXNUM.EQ.LNBWIN(POL,J+1,GIND)) THEN
	    WIN=WIN+1
	    SHARES(1,WIN)=POL
	    SHARES(2,WIN)=AMT
	    SHARES(3,WIN)=BNS
	  ENDIF
          GOTO 100
        ENDIF
C
C CHECK COMBO BETS
C
        IF(POL.EQ.TNB3C6.OR.POL.EQ.TNB3C3) THEN
          AMT=AMT/2
          IF(BOXNUM.EQ.LNBWIN(POL-2,J+1,GIND)) THEN
	    WIN=WIN+1
	    SHARES(2,WIN)=AMT
	    SHARES(1,WIN)=POL-2
	    SHARES(3,WIN)=BNS
            IF(NUM.EQ.LNBWIN(TNB3ST,J+1,GIND)) SHARES(1,WIN)=POL
	  ENDIF
          GOTO 100
        ENDIF
C
C CHECK WHEEL BETS
C
        IF(POL.EQ.TNB3W6.OR.POL.EQ.TNB3W3) THEN
          IF(POL.EQ.TNB3W3) AMT=AMT/3
          IF(POL.EQ.TNB3W6) AMT=AMT/6
          IF(BOXNUM.EQ.LNBWIN(POL,J+1,GIND)) THEN
	    WIN=WIN+1
	    SHARES(1,WIN)=POL
	    SHARES(2,WIN)=AMT
	    SHARES(3,WIN)=BNS
	  ENDIF
          GOTO 100
        ENDIF
100     CONTINUE
        RETURN
C
C FOUR DIGIT GAME
C
1000    CONTINUE
	DO 1100 J=0,LNBBDR(GIND)
	BNS=0
	IF(J.NE.0) BNS=1
        DO 1100 K=0,TRABUF(TWNBET)-1
        NUM=TRABUF(TWNNUM1+K*3)
        AMT=TRABUF(TWNAMT1+K*3)/LNBPRC(GIND)
        POL=TRABUF(TWNPOL1+K*3)
        IF(POL.GT.TNB3ST) THEN
          N=NUM
          DO 1010 I=1,4
          DIG(I)=MOD(N,10)
          N=N/10
1010      CONTINUE
1020      CONTINUE
          FLAG=0
          DO 1030 I=2,4
          IF(DIG(I).GE.DIG(I-1)) GOTO 1030
          TEMP=DIG(I)
          DIG(I)=DIG(I-1)
          DIG(I-1)=TEMP
          FLAG=1
1030      CONTINUE
          IF(FLAG.NE.0) GOTO 1020
          BOXNUM=DIG(4)+DIG(3)*10+DIG(2)*100+DIG(1)*1000
        ENDIF
C
C CHECK STRAIGHT BETS
C
        IF(POL.LE.TNB4ST) THEN
          IF(NUM.EQ.LNBWIN(POL,J+1,GIND)) THEN
	    WIN=WIN+1
	    SHARES(1,WIN)=POL
	    SHARES(2,WIN)=AMT
	    SHARES(3,WIN)=BNS
	  ENDIF
          GOTO 1100
        ENDIF
C
C CHECK BOX BETS
C
        IF(POL.GE.TNB4B24.AND.POL.LE.TNB4B4) THEN
          IF(BOXNUM.EQ.LNBWIN(POL,J+1,GIND)) THEN
	    WIN=WIN+1
	    SHARES(1,WIN)=POL
	    SHARES(2,WIN)=AMT
	    SHARES(3,WIN)=BNS
	  ENDIF
          GOTO 1100
        ENDIF
 
C
C CHECK COMBO BETS
C
        IF(POL.GE.TNB4C24.OR.POL.LE.TNB4C4) THEN
          AMT=AMT/2
          IF(BOXNUM.EQ.LNBWIN(POL-2,J+1,GIND)) THEN
	    WIN=WIN+1
	    SHARES(2,WIN)=AMT
	    SHARES(1,WIN)=POL-4
	    SHARES(3,WIN)=BNS
            IF(NUM.EQ.LNBWIN(TNB4ST,J+1,GIND)) SHARES(1,WIN)=POL
	  ENDIF
          GOTO 1100
        ENDIF
C
C CHECK WHEEL BETS
C
        IF(POL.GE.TNB4W24.AND.POL.LE.TNB4W4) THEN
          IF(POL.EQ.TNB4W4) AMT=AMT/4
          IF(POL.EQ.TNB4W6) AMT=AMT/6
          IF(POL.EQ.TNB4W12) AMT=AMT/12
          IF(POL.EQ.TNB4W24) AMT=AMT/24
          IF(BOXNUM.EQ.LNBWIN(POL,J+1,GIND)) THEN
	    WIN=WIN+1
	    SHARES(1,WIN)=POL
	    SHARES(2,WIN)=AMT
	    SHARES(3,WIN)=BNS
	  ENDIF
          GOTO 1100
        ENDIF
1100    CONTINUE
        RETURN
        END
