C ODDINF_TTRP.FOR
C
C V04 23-MAY-2000 OXK Layout fixes
C V03 07-JUN-1999 UXN Minimum stake added to the report.
C V02 10-MAY-1999 UXN Today's Triple changed to Today's Trio.
C V01 14-MAY-1998 UXN Initial release.
C
C This subroutine reads ODDINF file and updates Today's Trio game file,
C verification file and DAF.
C 
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C This item is the property of GTECH Corporation, Providence, Rhode
C Island, and contains confidential and trade secret information. It
C may not be transferred from the custody or control of GTECH except
C as authorized in writing by an officer of GTECH. Neither this item
C nor the information it contains may be used, transferred,
C reproduced, published, or disclosed, in whole or in part, and
C directly or indirectly, except as expressly authorized by an
C officer of GTECH, pursuant to written agreement.
C
C Copyright 1998 GTECH Corporation. All rights reserved.
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C
	SUBROUTINE ODDINF_TTRP(LUN,UPDATE,STATUS)
	IMPLICIT NONE
	INCLUDE 'INCLIB:SYSDEFINE.DEF'
	INCLUDE 'INCLIB:SYSEXTRN.DEF'
	INCLUDE 'INCLIB:GLOBAL.DEF'
	INCLUDE 'INCLIB:CONCOM.DEF'
	INCLUDE 'INCLIB:GTNAMES.DEF'
	INCLUDE 'INCLIB:DATBUF.DEF'
	INCLUDE 'INCLIB:RECDAF.DEF'
	INCLUDE 'INCLIB:RECSCF.DEF'
	INCLUDE 'INCLIB:DTRREC.DEF'
	INCLUDE 'INCLIB:ODDINF.DEF'
C
	INTEGER*4	LUN,STATUS
	LOGICAL*4	UPDATE
C
	COMMON		SCFREC
	INTEGER*4	ST,DRAW,FDB(7),VFDB(7),DFDB(7)
	INTEGER*4	GIND,GNUM,FLAG,HRS,MINS
	INTEGER*4	REV1,REV2,REV3,REV4,PREV3
	INTEGER*2	I2DATE(LDATE_LEN),I2DATE2(LDATE_LEN),I2DATE3(LDATE_LEN)
	INTEGER*4	I,J,K,ROW,CONTEST,CONTEST_CNT,EVENT_IND
	INTEGER*4	I4TV,COUNT,MIN_STAKE
	CHARACTER*4	TV
	EQUIVALENCE	(TV,I4TV)
	CHARACTER*80	TNAME
	INTEGER*4	I4TNAME(20)
	EQUIVALENCE	(TNAME,I4TNAME)
	INTEGER*4	TRP_NAME_LEN
	PARAMETER	(TRP_NAME_LEN=14)
	CHARACTER*20	CDTRPFN
	EQUIVALENCE	(CDTRPFN,DTRPFN)
	LOGICAL		SKIP,FIRST 
	CHARACTER*4	TV_CHANNEL(3)
	INTEGER*4	REPLUN,PAGE
	CHARACTER*40	TITL_NAME
	CHARACTER*20	FILNAM
	CHARACTER*9	HDR_DATE
	CHARACTER*7	HDR_TIME
	INTEGER*4	HDR_WEEK,HDR_YEAR,DUMMY	
C
	SKIP = .FALSE.
	FIRST=.TRUE.
C
C Read file header
C
	READ(UNIT=LUN,IOSTAT=ST,FMT='(190A)') INF.INLINE
	IF(ST.NE.0) THEN
	    WRITE(6,918) IAM(),GTNAMES(TTRP),ST    
	    GOTO 9999
	ENDIF
	IF(INF.HDR_TYPE.NE.'0') THEN
	    TYPE*,IAM(),'Invalid record type in the file header ...'   
	    GOTO 9999
	ENDIF
	IF(INF.HDR_GAME(4:4).NE.'7') THEN
	    TYPE*,IAM(),'Invalid game code in the file header ...'   
	    GOTO 9999
	ENDIF
	HDR_DATE = INF.HDR_DATE
	HDR_TIME = INF.HDR_TIME
	READ(INF.HDR_WEEK,I4FMT) HDR_WEEK
	READ(INF.HDR_YEAR(2:),I4FMT) HDR_YEAR
C
C Read header record.
C	
	READ(UNIT=LUN,IOSTAT=ST,FMT='(190A)') INF.INLINE
	IF(ST.NE.0) THEN    
	    WRITE(6,918) IAM(),GTNAMES(TTRP),ST    
	    GOTO 9999
	ENDIF
C
C Get event header record..
C
	IF(INF.EVHDR_TYPE.NE.'1') THEN
	    TYPE*,IAM(),'Invalid record type in the event header  ...'   
	    GOTO 9999
	ENDIF
C
	IF(INF.EVHDR_GAME(4:4).NE.'7') THEN
	    TYPE*,IAM(),'Invalid game code in the event header  ...'   
	    GOTO 9999
	ENDIF
C
C Read event record. 
C
40	CONTINUE
	READ(UNIT=LUN,IOSTAT=ST,FMT='(190A)') INF.INLINE
	IF(ST.NE.0) THEN    
	    WRITE(6,918) IAM(),GTNAMES(TTRP),ST    
	    GOTO 9999
	ENDIF
50	CONTINUE
C	
	IF(INF.TRP_TYPE.EQ.'9') THEN ! end record   
	    SKIP=.FALSE.
	    GOTO 1000 
	ENDIF
	IF(SKIP.AND.(INF.TRP_TYPE.EQ.'3'.OR.INF.TRP_TYPE.EQ.'4')) GOTO 40
	IF(INF.TRP_TYPE.NE.'2') THEN
	    TYPE*,IAM(),'Invalid record type ...'   
	    GOTO 9999
	ENDIF
	SKIP = .FALSE.
C
	IF(INF.TRP_GAME(4:4).NE.'7') THEN
	    TYPE*,IAM(),'Invalid game code ...'   
	    GOTO 9999
	ENDIF
C
C Get game index
C
	READ(INF.TRP_GAME_IND,I4FMT) GIND
	IF(GIND.LE.0.OR.GIND.GT.NUMTRP) THEN
	    WRITE(6,912) IAM(),GTNAMES(TTRP),GIND
	    GOTO 9999
	ENDIF	    
C
C Open game, verification and DAF file.
C
	GNUM = SCFGTN(TTRP,GIND)    
	IF(GNUM.LE.0.OR.GNUM.GT.MAXGAM) THEN
	    WRITE(6,900) IAM(),GTNAMES(TTRP),GIND
	    GOTO 9999
	ENDIF
	CALL OPENW(1,SCFSFN(1,DAF),4,0,0,ST)
	CALL IOINIT(DFDB,1,DAFSEC*256)
	IF(ST.NE.0) CALL FILERR(SCFSFN(1,DAF),1,ST,0)
	CALL OPENW(2,SCFGFN(1,GNUM),4,0,0,ST)
	CALL IOINIT(FDB,2,DTRSEC*256)
	IF(ST.NE.0) CALL FILERR(SCFGFN(1,GNUM),1,ST,0)	
	CALL OPENW(3,SCFGVN(1,GNUM),4,0,0,ST)
	CALL IOINIT(VFDB,3,DTRSEC*256)
	IF(ST.NE.0) CALL FILERR(SCFGVN(1,GNUM),1,ST,0)	
C
C Read draw number
C
	READ(INF.TRP_DRAW_NO,I4FMT) DRAW
	IF(DRAW.LE.0) THEN
	    WRITE(6,909) IAM(),GTNAMES(TTRP),GIND,DRAW
	    GOTO 9999
	ENDIF
C
C Read the file for the previous draw
C
	PREV3 = 0
        IF((DRAW.GT.1).AND.UPDATE) THEN
	    CALL READW(FDB,DRAW-1,DTRREC,ST)
	    IF(ST.NE.0) CALL FILERR(SCFGFN(1,GNUM),2,ST,DRAW-1)
	    CALL ILBYTE(PREV3,DTRREV,2)		! Get previous text checksum
	    IF(DTRSTS.EQ.0) THEN
		WRITE(6,901) IAM(),GTNAMES(TTRP),GIND,DRAW,DRAW-1
		GOTO 9999
	    ENDIF	    
	ENDIF
C
C Read file for the current draw
C
	CALL READW(FDB,DRAW,DTRREC,ST)
	IF(ST.NE.0) CALL FILERR(SCFGFN(1,GNUM),2,ST,DRAW)
C
C Checking if draw is not already set
C
        IF(DTRSTS.EQ.GAMINF.OR.DTRSTS.EQ.GAMOPN) THEN
           WRITE(6,902) IAM(),GTNAMES(TTRP),GIND,DRAW
	   IF(UPDATE) THEN
             CALL INPYESNO('Do you want to overwrite [Y/N] ?',FLAG)
             IF(FLAG.NE.1) THEN
	       SKIP = .TRUE.
	       GOTO 1000
	     ENDIF
	   ENDIF
        ENDIF
C
C Checking if draw is closed.
C
        IF(DTRSTS.GT.GAMOPN) THEN
           WRITE(6,903) IAM(),GTNAMES(TTRP),GIND,DRAW
           GOTO 9999
	ENDIF
C
	DO I=1,3
	  DO J=1,MAXTRPRW
	    IF(DTRSTA(J,I).GT.GAMOPN) THEN
             WRITE(6,915) IAM(),GTNAMES(TTRP),GIND,J,I
             GOTO 9999
	    ENDIF
	  ENDDO
	  IF(DTREST(I).GT.GAMOPN) THEN
	    WRITE(6,916)  IAM(),GTNAMES(TTRP),GIND
	    GOTO 9999
	  ENDIF
	ENDDO
C
C Initialize some variables...
C
	CALL LIB$MOVC5(0,0,ICHAR(' '),SIZEOF(DTRMNM),DTRMNM)
	CALL LIB$MOVC5(0,0,ICHAR(' '),SIZEOF(DTRENM),DTRENM)
	CALL LIB$MOVC5(0,0,ICHAR(' '),SIZEOF(DTRDES),DTRDES)
	CALL LIB$MOVC5(0,0,ICHAR(' '),SIZEOF(DTRNMS),DTRNMS)
	DO I=1,3
	  DO J=1,MAXTRPRW
	    DTRSTA(J,I) = 0
	  ENDDO
	  DTREST(I) = 0
	  DTREVD(I) = 0
	  DTREVT(I) = 0
	ENDDO
C
C Read game start date
C
	I2DATE(VCDC) = 0
	READ(INF.TRP_SDATE(4:5),I2FMT) I2DATE(VYEAR)
	READ(INF.TRP_SDATE(6:7),I2FMT) I2DATE(VMON)
	READ(INF.TRP_SDATE(8:9),I2FMT) I2DATE(VDAY)
	CALL BDATE(I2DATE)
	DTRBSD = I2DATE(VCDC)
C
C Get draw end date
C
	I2DATE(VCDC) = 0
	READ(INF.TRP_EDATE(4:5),I2FMT) I2DATE(VYEAR)
	READ(INF.TRP_EDATE(6:7),I2FMT) I2DATE(VMON)
	READ(INF.TRP_EDATE(8:9),I2FMT) I2DATE(VDAY)
	CALL BDATE(I2DATE)
	DTRESD = I2DATE(VCDC)
C
C Set week number
C
	CALL FIGWEK(DTRESD-WEEK_OFFSET,DTRWEK,DUMMY)
C
C Get draw date
C
	I2DATE(VCDC) = 0
	READ(INF.TRP_DRAW_DATE(4:5),I2FMT) I2DATE(VYEAR)
	READ(INF.TRP_DRAW_DATE(6:7),I2FMT) I2DATE(VMON)
	READ(INF.TRP_DRAW_DATE(8:9),I2FMT) I2DATE(VDAY)
	CALL BDATE(I2DATE)
	DTRDAT = I2DATE(VCDC)
C
C Draw closing time.
C
	READ(INF.TRP_CLOS_TIME(2:3),I2FMT) HRS
	READ(INF.TRP_CLOS_TIME(4:5),I2FMT) MINS
	DTRTIM = HRS*3600+MINS*60
C
C TV-channel
C
	TV = INF.TRP_TV
C
C Number of contests
C
	READ(INF.TRP_CONTEST_CNT,I4FMT) CONTEST_CNT
	IF(CONTEST_CNT.LE.0.OR.CONTEST_CNT.GT.3) THEN
	  WRITE(6,919)	IAM(),GTNAMES(TTRP),GIND,CONTEST_CNT
	  GOTO 9999
	ENDIF
C
C Minimum stake in pennies.
C
	READ(INF.TRP_MIN_STAKE,I6FMT) MIN_STAKE
	IF(MIN_STAKE.LT.100.OR.MIN_STAKE.GT.SCFPAR(MAXSTAKE)*DYN_BETUNIT) THEN
	  WRITE(6,920)	IAM(),GTNAMES(TTRP),GIND,MIN_STAKE
	  GOTO 9999
	ENDIF
	DTRPRC = MIN_STAKE/DYN_BETUNIT
C
C Event master name.
C
        CALL STR$UPCASE(TNAME,INF.TRP_MASTER_NAME)
        CALL STR$TRANSLATE(TNAME,TNAME,TRANSLATE_TABLE,MATCH_TABLE)
        CALL MOVBYT(I4TNAME,1,DTRMNM,1,TRPENM_LEN)
C
C Read competition record.
C
	DO 100 EVENT_IND=1,CONTEST_CNT
C
	READ(UNIT=LUN,IOSTAT=ST,FMT='(190A)') INF.INLINE
	IF(ST.NE.0) THEN    
	    WRITE(6,918) IAM(),GTNAMES(TTRP),ST    
	    GOTO 9999
	ENDIF
	IF(INF.TRP_TYPE.NE.'3') THEN
	    TYPE*,IAM(),'Invalid record type ...'   
	    GOTO 9999
	ENDIF
C
	IF(INF.TRP_GAME(4:4).NE.'7') THEN
	    TYPE*,IAM(),'Invalid game code ...'   
	    GOTO 9999
	ENDIF
C
C Read contest number
C
	READ(INF.TRP_CONTEST,I4FMT) CONTEST
	IF(CONTEST.LT.1.OR.CONTEST.GT.CONTEST_CNT) THEN
	  WRITE(6,917)	IAM(),GTNAMES(TTRP),GIND,CONTEST
	  GOTO 9999
	ENDIF
C
C TV channel
C
	TV_CHANNEL(CONTEST) = INF.TRP_TV2
C
C Number of competitors
C	
	READ(INF.TRP_COMPETITORS,I4FMT) COUNT
	IF(COUNT.LE.0.OR.COUNT.GT.MAXTRPRW) THEN
	    WRITE(6,913) IAM(),GTNAMES(TTRP),GIND,COUNT
	    GOTO 9999
	ENDIF
	DTRRWS(CONTEST) = COUNT
C
C Event end date
C
	I2DATE(VCDC) = 0
	READ(INF.TRP_EVENT_EDATE(4:5),I2FMT) I2DATE(VYEAR)
	READ(INF.TRP_EVENT_EDATE(6:7),I2FMT) I2DATE(VMON)
	READ(INF.TRP_EVENT_EDATE(8:9),I2FMT) I2DATE(VDAY)
	CALL BDATE(I2DATE)
	DTREVD(CONTEST) = I2DATE(VCDC)
C
C Draw closing time.
C
	READ(INF.TRP_EVENT_STIME(2:3),I2FMT) HRS
	READ(INF.TRP_EVENT_STIME(4:5),I2FMT) MINS
	DTREVT(CONTEST) = HRS*3600+MINS*60
C
	DTREST(CONTEST) = GAMOPN
C
C Get event name.
C
        CALL STR$UPCASE(TNAME,INF.TRP_CONTEST_NAME)
        CALL STR$TRANSLATE(TNAME,TNAME,TRANSLATE_TABLE,MATCH_TABLE)
        CALL MOVBYT(I4TNAME,1,DTRENM(1,CONTEST),1,TRPENM_LEN)
C
C Get description lines 1 - 3
C	
        CALL STR$UPCASE(TNAME,INF.TRP_DESC1)
        CALL STR$TRANSLATE(TNAME,TNAME,TRANSLATE_TABLE,MATCH_TABLE)
        CALL MOVBYT(I4TNAME,1,DTRDES(1,CONTEST),1,28)
C
        CALL STR$UPCASE(TNAME,INF.TRP_DESC2)
        CALL STR$TRANSLATE(TNAME,TNAME,TRANSLATE_TABLE,MATCH_TABLE)
        CALL MOVBYT(I4TNAME,1,DTRDES(1,CONTEST),29,28)
C
        CALL STR$UPCASE(TNAME,INF.TRP_DESC3)
        CALL STR$TRANSLATE(TNAME,TNAME,TRANSLATE_TABLE,MATCH_TABLE)
        CALL MOVBYT(I4TNAME,1,DTRDES(1,CONTEST),57,28)
C
C Read all the competitors for this event.
C
	DO I=1,COUNT
	  READ(UNIT=LUN,IOSTAT=ST,FMT='(190A)') INF.INLINE
	  IF(ST.NE.0) THEN    
	    WRITE(6,918) IAM(),GTNAMES(TTRP),ST    
	    GOTO 9999
	  ENDIF
	  IF(INF.TRP_TYPE2.NE.'4') THEN
	    TYPE*,IAM(),'Invalid competitor record type ...'
	    GOTO 9999
	  ENDIF
	  IF(INF.TRP_GAME(4:4).NE.'7') THEN
            TYPE*,IAM(),'Invalid competitor game code ...'
            GOTO 9999
          ENDIF
C
C Read competiton number.
C
	  READ(INF.TRP_CONTEST_NR,I4FMT) CONTEST
	  IF(CONTEST.LT.1.OR.CONTEST.GT.CONTEST_CNT) THEN
	    WRITE(6,917) IAM(),GTNAMES(TTRP),GIND,CONTEST
	    GOTO 9999
	  ENDIF
C
C Read competitor number
C
	  READ(INF.TRP_COMPETITOR_NO,I4FMT) ROW
	  IF(ROW.LE.0.OR.ROW.GT.MAXTRPRW) THEN
	    WRITE(6,914) IAM(),GTNAMES(TTRP),GIND,ROW
	    GOTO 9999
	  ENDIF
C
	  DTRSTA(ROW,CONTEST) = GAMOPN
C
C Read competitor name.
C
      	  CALL STR$UPCASE(TNAME,INF.TRP_PLAYER_NAME)
          CALL STR$TRANSLATE(TNAME,TNAME,TRANSLATE_TABLE,MATCH_TABLE)
          CALL MOVBYT(I4TNAME,1,DTRNMS(1,ROW,CONTEST),1,TRPNMS_LEN)
C
	ENDDO
100	CONTINUE
C
C Read next record, to be sure that COUNT had correct value....
C
	READ(UNIT=LUN,IOSTAT=ST,FMT='(190A)') INF.INLINE
	IF(ST.NE.0) THEN    
	    WRITE(6,918) IAM(),GTNAMES(TTRP),ST    
	    GOTO 9999
	ENDIF
C
	IF(INF.TRP_TYPE.NE.'2'.AND.INF.TRP_TYPE.NE.'9') THEN
	    TYPE*,IAM(),'Invalid competitor count or record type...'
	    GOTO 9999	
	ENDIF
C
C Set pool file name.
C
        WRITE (CDTRPFN,904) GIND,DRAW
        DTRPFN(1) = FILEPACK
        IF(UPDATE) WRITE(6,905) IAM(),CDTRPFN
C
	DTRDRW = DRAW
	DTRSTS = GAMOPN
C
C Calculate new checksum
C
	BUFIDX = 1
        CALL MOVBYT(DTRDES,1,BYTTAB,BUFIDX,SIZEOF(DTRDES))
        BUFIDX = BUFIDX + SIZEOF(DTRDES)
        CALL MOVBYT(DTRMNM,1,BYTTAB,BUFIDX,SIZEOF(DTRMNM))
        BUFIDX = BUFIDX + SIZEOF(DTRMNM)
        CALL MOVBYT(DTRENM,1,BYTTAB,BUFIDX,SIZEOF(DTRENM))
        BUFIDX = BUFIDX + SIZEOF(DTRENM)
        CALL MOVBYT(DTRNMS,1,BYTTAB,BUFIDX,SIZEOF(DTRNMS))
        BUFIDX = BUFIDX + SIZEOF(DTRNMS)
	BUFIDX = BUFIDX - 1
	CALL CHECKSUM(BYTTAB,1,BUFIDX,REV4)
	CALL ILBYTE(REV1,DTRREV,0)	    
        IF(DTRDRW.EQ.M251-1) THEN
	   REV1 = MOD(REV1+DTRDRW,(M251-10))+ 1
        ELSE
	   REV1 = MOD(REV1+DTRDRW,M251)+ 1
        ENDIF
	REV2 = MOD(DTRDRW,255)
	CALL ILBYTE(REV3,DTRREV,2)          !GET PREVIOUS TEXT REV #
	REV3 = MOD(PREV3 + REV3,255) + 1
	CALL ISBYTE(REV1,DTRREV,0)          !CONTROL REV BYTE (SEQUENCE#)
	CALL ISBYTE(REV2,DTRREV,1)          !DRAW REV BYTE
	CALL ISBYTE(REV3,DTRREV,2)          !TEXT REV # BYTE  (SEQUENCE#)
	CALL ISBYTE(REV4,DTRREV,3)          !TEXT CHECKSUM BYTE
C
C Verify all data.
C
        IF(DTRBSD.GT.DTRESD) THEN
           TYPE*,IAM(),'Begining sales date greater then ending sales date'
	   GOTO 9999
        ENDIF
        IF(DTRBSD.EQ.0) THEN
           TYPE*,IAM(),'Begining sales date not set '
           GOTO 9999
        ENDIF
        IF(DTRDAT.LT.DTRESD) THEN
           TYPE*,IAM(),'Event date is before last sales date'
           GOTO 9999
        ENDIF
        IF(DTRESD.EQ.0) THEN
           TYPE*,IAM(),'Ending sales date not set'
           GOTO 9999
        ENDIF
        IF(DTRPRC.EQ.0) THEN
           TYPE*,IAM(),'Base price not set'
           GOTO 9999
        ENDIF
        IF(DTRSPR.EQ.0) THEN
           TYPE*,IAM(),'Pool percentage not set'
           GOTO 9999
        ENDIF
C
        DO I=DTRBSD,DTRESD
          CALL READW(DFDB,I,DAFREC,ST)
          IF(ST.NE.0) CALL FILERR(SCFSFN(1,DAF),2,ST,I)
          I2DATE(5)=I
          CALL LCDATE(I2DATE)
          IF(DAFSTS.GT.DSOPEN) THEN
            WRITE(6,907) IAM(),(I2DATE(K),K=7,13)
            GOTO 9999
          ENDIF
          IF(DAFDRW(GNUM).NE.0.AND.DAFDRW(GNUM).NE.DRAW) THEN
            WRITE(6,906) IAM(),(I2DATE(K),K=7,13),GIND,DAFDRW(GNUM)
	    IF(UPDATE) THEN
              CALL INPYESNO('Do you want to overwrite [Y/N] ?',FLAG)
              IF(FLAG.NE.1) THEN
	       SKIP = .TRUE.
	       GOTO 1000
	      ENDIF
	    ENDIF
          ENDIF
	ENDDO
C
	IF(UPDATE) THEN
          DO I=DTRBSD,DTRESD
           CALL READW(DFDB,I,DAFREC,ST) 
	   IF(ST.NE.0)CALL FILERR(SCFSFN(1,DAF),2,ST,I)
           DAFDRW(GNUM)=DRAW
           CALL WRITEW(DFDB,I,DAFREC,ST)
           IF(ST.NE.0) CALL FILERR(SCFSFN(1,DAF),3,ST,I)
	   WRITE(6,910) IAM(),(SCFSFN(K,DAF),K=1,5),I
	  ENDDO
C
	  CALL WRITEW(FDB,DRAW,DTRREC,ST)
	  IF(ST.NE.0) CALL FILERR(SCFGFN(1,GNUM),3,ST,DRAW)
	  WRITE(6,911) IAM(),(SCFGFN(K,GNUM),K=1,5),DRAW
	  CALL WRITEW(VFDB,DRAW,DTRREC,ST)
	  IF(ST.NE.0) CALL FILERR(SCFGVN(1,GNUM),3,ST,DRAW)
	  WRITE(6,911) IAM(),(SCFGVN(K,GNUM),K=1,5),DRAW
C
	  WRITE(6,908) IAM(),GTNAMES(TTRP),GIND,DRAW
	ENDIF
C
C Generating report...
C
	IF(FIRST) THEN
          FIRST = .FALSE.
	  WRITE(FILNAM,921) 
	  REPLUN = 7
	  CALL ROPEN(FILNAM,REPLUN,ST)
          IF(ST.NE.0) THEN
            TYPE*,IAM(),'Error opening ',FILNAM,' status=',ST
	    GOTO 9999
          ENDIF
	  PAGE = 0
	  WRITE(TITL_NAME,922) HDR_WEEK,HDR_YEAR 
	  CALL TITLE(TITL_NAME,FILNAM,1,REPLUN,PAGE,DAYCDC)
	  WRITE(REPLUN,927)
	  WRITE(REPLUN,923) HDR_DATE(8:9),HDR_DATE(6:7),HDR_DATE(2:5),
     *        HDR_TIME(2:3),HDR_TIME(4:5),HDR_TIME(6:7)
	  WRITE(REPLUN,924)
	ENDIF
	WRITE(REPLUN,925)
	WRITE(REPLUN,926)
	I2DATE(VCDC) = DTRBSD
	CALL LCDATE(I2DATE)
	I2DATE2(VCDC) = DTRESD
	CALL LCDATE(I2DATE2)
	I2DATE3(VCDC) = DTRDAT
	CALL LCDATE(I2DATE3)
	HRS = DTRTIM/3600
	MINS= (DTRTIM-HRS*3600)/60
	WRITE(REPLUN,936) GIND,DTRDRW,(DTRMNM(K),K=1,7),(I2DATE(K),K=9,13),
     *               (I2DATE2(K),K=9,13),HRS,MINS,(I2DATE3(K),K=9,13),TV,
     *               DTRPRC*DYN_BETUNIT/DOLL_BASE,
     *               MOD(DTRPRC*DYN_BETUNIT,DOLL_BASE)
	DO I=1,CONTEST_CNT
	  I2DATE2(VCDC) = DTREVD(I)
	  CALL LCDATE(I2DATE2)
	  HRS=DTREVT(I)/3600
	  MINS=(DTREVT(I)-HRS*3600)/60
	  IF(DTREVT(I).EQ.0.AND.DTREVD(I).NE.0) THEN
	    WRITE(REPLUN,933)  (DTRENM(K,I),K=1,7),
     *       (' ',K=9,13),(' ',K=9,13),(I2DATE2(K),K=9,13),
     *       TV_CHANNEL(I)
	  ELSEIF(DTREVT(I).NE.0.AND.DTREVD(I).EQ.0) THEN
	    WRITE(REPLUN,934)  (DTRENM(K,I),K=1,7),
     *       (' ',K=9,13),HRS,MINS,
     *       (I2DATE3(K),K=9,13),TV_CHANNEL(I)
	  ELSEIF(DTREVT(I).EQ.0.AND.DTREVD(I).EQ.0) THEN
	    WRITE(REPLUN,935)  (DTRENM(K,I),K=1,7),
     *       (' ',K=9,13),
     *       (I2DATE3(K),K=9,13),TV_CHANNEL(I)
	  ELSE
	     WRITE(REPLUN,932)  (DTRENM(K,I),K=1,7),
     *       (' ',K=9,13),(' ',K=9,13),HRS,MINS,
     *       (I2DATE2(K),K=9,13),TV_CHANNEL(I)
	  ENDIF
	  WRITE(REPLUN,924)
	  DO ROW=1,MAXTRPRW/2
	    IF(DTRSTA(ROW,I).NE.GAMOPN) GOTO 500
	    IF(DTRSTA(ROW+MAXTRPRW/2,I).NE.GAMOPN) THEN
	      WRITE(REPLUN,930) ROW,(DTRNMS(K,ROW,I),K=1,4)
	    ELSE
	      WRITE(REPLUN,929) ROW,(DTRNMS(K,ROW,I),K=1,4),
     *               ROW+MAXTRPRW/2,(DTRNMS(K,ROW+MAXTRPRW/2,I),K=1,4)
	    ENDIF
	  ENDDO
500	  CONTINUE
	  WRITE(REPLUN,924)
	ENDDO
C
C Close game files and DAF
C
1000	CONTINUE
	CALL CLOSEFIL(FDB)			  
	CALL CLOSEFIL(VFDB)			  
	CALL CLOSEFIL(DFDB)
C
C Get next record.
C
	IF(SKIP) GOTO 40
	IF(INF.TRP_TYPE.NE.'9')	GOTO 50	! Get next record.
	STATUS = 0
	CLOSE(REPLUN)
	RETURN
C
C ODDINF file processed with errors....
C
9999	CONTINUE
	CALL CLOSEFIL(FDB)			  
	CALL CLOSEFIL(VFDB)			  
	CALL CLOSEFIL(DFDB)
	STATUS = -1
	CLOSE(REPLUN)
	TYPE*,IAM(),'********** ERRORS FOUND ****************'
	TYPE*,INF.INLINE
	TYPE*,IAM(),'********** ERRORS FOUND ****************'
	RETURN
C
C Format statements.
C
900     FORMAT(1X,A,A8,1X,I1,' draw ',I4,' is not correct')
901     FORMAT(1X,A,A8,1X,I1,' draw ',I4,' draw not defined')
902     FORMAT(1X,A,A8,1X,I1,' draw ',I4,' data has been already entered')
903     FORMAT(1X,A,A8,1X,I1,' draw ',I4,' has already been closed')
904	FORMAT(4X,':TR',I1,'P',I4.4,'.FIL  ')
905     FORMAT(1X,A,'Pool file name is ',A20)
906     FORMAT(1X,A,7A2,' is already active for ',A8,1X,I1,' event # ',I4)
907     FORMAT(1X,A,7A2,' - Day has already been closed')
908     FORMAT(1X,A,A8,1X,I1,' event ',I4,' verify complete')
909	FORMAT(1X,A,A8,1X,I1,' invalid draw number >',I4)
910	FORMAT(1X,A,1X,5A4,' updated for CDC  ',I4.4)
911	FORMAT(1X,A,1X,5A4,' updated for draw ',I4.4)
912	FORMAT(1X,A,A8,' invalid game index >',I4)	
913	FORMAT(1X,A,A8,1X,I1,' invalid number of competitors >',I4)
914	FORMAT(1X,A,A8,1X,I1,' invalid row number >',I4)
915	FORMAT(1X,A,A8,1X,I1,' row ',I4,' has already been closed for set ',I4)
916     FORMAT(1X,A,A8,1X,I1,' event ',I4,' has already been closed')
917     FORMAT(1X,A,A8,1X,I1,' invalid event number >',I4)
918	FORMAT(1X,A,'Error reading ',A8,' ODDINF file, status = ',I4)
919     FORMAT(1X,A,A8,1X,I1,' invalid contest count >',I4)
920     FORMAT(1X,A,A8,1X,I1,' invalid minimum stake >',I4)
921	FORMAT('TRODDINF.REP')
922	FORMAT('PÄIVÄN TRIO KOHTEET VIIKOLLA ',I2.2,'/',I4.4)
923	FORMAT(1X,'Tiedosto ',A2,'.',A2,'.',A4,2X,A2,':',A2,':',A2)
924	FORMAT(132X)
925	FORMAT(1X,'N:o Draw Target',T48,'Start Date    End Date    Time',
     *         '     Draw Date     TV')
926	FORMAT(1X,98('-'))
927	FORMAT(132('='))
928	FORMAT(1X,I2,1X,7A4,T42,5A2,4X,5A2,2X,I2.2,':',I2.2,
     *         4X,5A2,4X,A4)
929	FORMAT(16X,I2,'. ',4A4,T53,I2,'. ',4A4)
930	FORMAT(16X,I2,'. ',4A4)
932	FORMAT(10X,7A4,T47,5A2,4X,5A2,2X,I2.2,':',I2.2,
     *         4X,5A2,4X,A4)
933	FORMAT(10X,7A4,T47,5A2,4X,5A2,2X,5X,
     *         4X,5A2,4X,A4)
934	FORMAT(10X,7A4,T47,5A2,4X,10X,2X,I2.2,':',I2.2,
     *         4X,5A2,4X,A4)
935	FORMAT(10X,7A4,T47,5A2,4X,10X,2X,5X,
     *         4X,5A2,4X,A4)
936	FORMAT(/,2X,I2,1X,I4,1X,7A4,T47,5A2,4X,5A2,2X,I2.2,':',I2.2,
     *         4X,5A2,4X,A4,/,2X,'Minimum Bet',2X,I2,'.',I2.2,/)
	END	
