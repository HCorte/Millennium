C
C SUBROUTINE DNBR
C $Log:   GXAFXT:[GOLS]DNBR.FOV  $
C  
C     Rev 1.0   17 Apr 1996 12:56:20   HXK
C  Release of Finland for X.25, Telephone Betting, Instant Pass Thru Phase 1
C  
C     Rev 1.0   21 Jan 1993 16:06:42   DAB
C  Initial Release
C  Based on Netherlands Bible, 12/92, and Comm 1/93 update
C  DEC Baseline
C
C ** Source - dnbr.for **
C
C DNBR.FOR
C
C V02 01-NOV-91 MTK INITAL RELEASE FOR NETHERLANDS
C V01 01-AUG-90 XXX RELEASED FOR VAX
C
C SUBROUTINE TO DECODE NUMBERS WAGERS
C
C
C
C
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C This item is the property of GTECH Corporation, Providence, Rhode
C Island, and contains confidential and trade secret information. It
C may not be transferred from the custody or control of GTECH except
C as authorized in writing by an officer of GTECH. Neither this item
C nor the information it contains may be used, transferred,
C reproduced, published, or disclosed, in whole or in part, and
C directly or indirectly, except as expressly authorized by an
C officer of GTECH, pursuant to written agreement.
C
C Copyright 1991 GTECH Corporation. All rights reserved.
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C
C=======OPTIONS /CHECK=NOOVERFLOW
	SUBROUTINE DNBR(TERMES,TRABUF,MESLEN)
	IMPLICIT NONE
C
	INCLUDE 'INCLIB:SYSPARAM.DEF'
	INCLUDE 'INCLIB:SYSEXTRN.DEF'
	INCLUDE 'INCLIB:GLOBAL.DEF'
	INCLUDE 'INCLIB:CONCOM.DEF'
	INCLUDE 'INCLIB:AGTCOM.DEF'
	INCLUDE 'INCLIB:NBRCOM.DEF'
	INCLUDE 'INCLIB:POLCOM.DEF'
	INCLUDE 'INCLIB:DESTRA.DEF'
	INCLUDE 'INCLIB:TASKID.DEF'
	INCLUDE 'INCLIB:CHKSUMCM.DEF'
	INTEGER*4 MESS(EDLEN),P3TAB(0:15),P4TAB(0:15)
	INTEGER*4 P3MULT(NUMPL3),P4MULT(NUMPL4),DIG(4)
	INTEGER*4 I, PTYPE, NUM, TYPE, OFF, IND, MYCHKSUM, CHKLEN
	INTEGER*4 GIND, TEMP, TERNUM, OPTIONS, AMT
	INTEGER*4 TEMP1, TEMP2, TEMP3, TEMP4, TREV, CREV
	INTEGER*2 MESLEN
	BYTE TERMES(*)
	DATA TERNUM/0/
	DATA P3TAB/TNB3F2,TNB3F2,TNB3F2,TNB3F2,TNB3W6,TNB3ST,TNB3B6,
     *	          TNB3C6,8*0/
	DATA P4TAB/TNB4F2,TNB4F2,TNB4F2,TNB4F2,0,0,0,0,TNB4W24,
     *             TNB4ST,TNB4B24,TNB4C24,0,0,0,0/
	DATA P3MULT/1,1,1,1,1,1,2,2,6,3/
	DATA P4MULT/1,1,1,1,1,1,1,1,2,2,2,2,24,12,6,4/
C
C GET GENERIC GAME INFORMATION
C
	TERNUM=0
	SYNTERRCOD=0
	TRABUF(TSTAT)=REJT
	TRABUF(TGAMTYP)=TNBR
	TEMP=ZEXT(TERMES(1))
	TRABUF(TTRN)=IAND(TEMP,15)
C
C GET TRANSACTION NUMBER
C
        TEMP = ZEXT(TERMES(1))
        TRABUF(TTRN)=IAND(TEMP,15)
C
C GET CHECKSUM
C
        TEMP1 = ZEXT(TERMES(3))
        TEMP2 = ZEXT(TERMES(4))
        TRABUF(TCHK) = ISHFT(TEMP1,8) + TEMP2
C
C
        TRABUF(TTSTCS) = ZEXT(TERMES(5))
        TEMP = ZEXT(TERMES(6))
        TRABUF(TGAMIND)=ISHFT(TEMP,-4)
	GIND=TRABUF(TGAMIND)
        IF(GIND.GE.1.AND.GIND.LE.MAXIND)
     *    TRABUF(TGAM)=GTNTAB(TNBR,GIND)
        IF(TRABUF(TGAM).LT.1.OR.TRABUF(TGAM).GT.MAXGAM) THEN
          TRABUF(TERR)=SYNT
          SYNTERRCOD=5
          RETURN
        ENDIF
C
C
	TRABUF(TWNTYP)=NBRTYP(GIND)
	TEMP=ZEXT(TERMES(7))
	TRABUF(TWNBET)=IAND(TEMP,15)
	TRABUF(TWDUR)=ISHFT(TEMP,-4)
C
C
	IND=9
        OPTIONS=ZEXT(TERMES(8))
C
C CHECK FOR CONTROL REVISION (IGNORE FOR NUMBERS)
C
        IF(IAND(OPTIONS,'01'X).NE.0) THEN
	  CREV=0
          CALL MOVBYT(TERMES,IND,CREV,1,2)
          IND=IND+2
        ENDIF
C
C CHECK FOR QP IF TRUE THEN GET QUICK PICK FLAGS
C
        IF(IAND(OPTIONS,'02'X).NE.0) THEN
          TEMP1 = ZEXT(TERMES(IND+0))
          TEMP2 = ZEXT(TERMES(IND+1))
          TRABUF(TWQPF) = ISHFT(TEMP1,8) + TEMP2
          IND=IND+2
        ENDIF
C
C CHECK FOR AND FLAG
C
        IF(IAND(OPTIONS,'08'X).NE.0) THEN
           TRABUF(TWNAND)=1
	   TRABUF(TERR)=SYNT
	   SYNTERRCOD=15
	   RETURN
        ENDIF
C
C CHECK FOR TEXT REVISION (IGNORE FOR NUMBERS)
C
        IF(IAND(OPTIONS,'10'X).NE.0) THEN
	  TREV=0
          CALL MOVBYT(TERMES,IND,TREV,1,2)
          IND=IND+2
        ENDIF
C
C CHECK MESSAGE CHECKSUM
C
        IF(P(SUPSUM).EQ.0) THEN
	  IF(.NOT.BTEST(AGTTAB(AGTTYP,TRABUF(TTER)),AGTSUM)) THEN
            I4CCITT   = IAND(BASECHKSUM+TRABUF(TTER),'FFFF'X)
            TERMES(3) = I1CCITT(2)
            TERMES(4) = I1CCITT(1)
            CHKLEN=MESLEN-1
            CALL GETCCITT(TERMES,1,CHKLEN,MYCHKSUM)
            IF(MYCHKSUM.NE.TRABUF(TCHK)) THEN
              TRABUF(TERR)=CBAD
              SYNTERRCOD=10
              RETURN
            ENDIF
	  ENDIF
        ENDIF
C
C CHECK GENERIC GAME DATA
C
	IF(TRABUF(TGAM).LT.1.OR.TRABUF(TGAM).GT.MAXGAM) THEN
	  TRABUF(TERR)=SYNT
	  SYNTERRCOD=30
	  RETURN
	ENDIF
C
C
	IF(NBRDRW(GIND).LT.1) THEN
	  TRABUF(TERR)=SYNT
	  SYNTERRCOD=40
	  RETURN
	ENDIF
C
C
	IF(TRABUF(TWNBET).LT.1.OR.TRABUF(TWNBET).GT.NBRMAX(GIND))THEN
	  TRABUF(TERR)=SYNT
	  SYNTERRCOD=70
	  RETURN
	ENDIF
C
C
        IF(TRABUF(TWNBET).GT.4.AND.TRABUF(TSIZE).LE.1) THEN
          TRABUF(TERR)=SYNT
          SYNTERRCOD=80
          RETURN
        ENDIF
C
C
	IF(TRABUF(TWDUR).LT.1.OR.TRABUF(TWDUR).GT.NBRMLT(GIND).OR.
     *     (TRABUF(TWNAND).NE.0.AND.TRABUF(TWDUR).NE.2)) THEN
	  TRABUF(TERR)=SYNT
	  SYNTERRCOD=100
	  RETURN
	ENDIF
C
C GET NUMBERS BET DATA
C
	DO 100 OFF=0,TRABUF(TWNBET)-1
	TEMP=ZEXT(TERMES(IND))
	TYPE=ISHFT(TEMP,-2)+IAND(TEMP,3)
	IND=IND+1
	AMT=ZEXT(TERMES(IND))
	IND=IND+1
	TRABUF(TWNAMT1+OFF*3)=AMT*NBRPRC(GIND)
	IF(TRABUF(TWNAMT1+OFF*3).LT.1) THEN
	  TRABUF(TERR)=SYNT
	  SYNTERRCOD=50
	  RETURN
	ENDIF
	IF(TRABUF(TWNTYP).EQ.NB3TYP) TYPE=P3TAB(TYPE)
	IF(TRABUF(TWNTYP).EQ.NB4TYP) TYPE=P4TAB(TYPE)
	TEMP=ZEXT(TERMES(IND))
	IND=IND+1
	DIG(1)=ISHFT(TEMP,-4)
	DIG(2)=IAND(TEMP,15)
	TEMP=ZEXT(TERMES(IND))
	IND=IND+1
	DIG(3)=ISHFT(TEMP,-4)
	DIG(4)=IAND(TEMP,15)
C
C
	IF(TRABUF(TWNTYP).EQ.NB3TYP) THEN
	  IF(TYPE.EQ.TNB3F2) THEN
	    IF(IAND(NBROPT(GIND),PARACT).EQ.0) TRABUF(TERR)=SYNT
	    IF(DIG(3).EQ.15) THEN
	      IF(DIG(1).GT.9.OR.DIG(2).GT.9) TRABUF(TERR)=SYNT
	      TRABUF(TWNPOL1+OFF*3)=TNB3F2
	      TRABUF(TWNNUM1+OFF*3)=DIG(1)*10+DIG(2)
	    ENDIF
	    IF(DIG(1).EQ.15) THEN
	      IF(DIG(2).GT.9.OR.DIG(3).GT.9) TRABUF(TERR)=SYNT
	      TRABUF(TWNPOL1+OFF*3)=TNB3B2
	      TRABUF(TWNNUM1+OFF*3)=DIG(2)*10+DIG(3)
	    ENDIF
	    IF(DIG(2).EQ.15) THEN
	      IF(DIG(1).GT.9.OR.DIG(3).GT.9) TRABUF(TERR)=SYNT
	      TRABUF(TWNPOL1+OFF*3)=TNB3S2
	      TRABUF(TWNNUM1+OFF*3)=DIG(1)*10+DIG(3)
	    ENDIF
	    IF(TRABUF(TWNPOL1+OFF*3).EQ.0) TRABUF(TERR)=SYNT
	    GOTO 90
	  ENDIF
C
C
	  IF(TYPE.EQ.TNB3ST) THEN
	    IF(DIG(1).GT.9.OR.DIG(2).GT.9.OR.
     *	       DIG(3).GT.9) TRABUF(TERR)=SYNT
	    TRABUF(TWNPOL1+OFF*3)=TNB3ST
	    TRABUF(TWNNUM1+OFF*3)=DIG(1)*100+DIG(2)*10+DIG(3)
	    GOTO 90
	  ENDIF
C
C
	  IF(TYPE.EQ.TNB3B6.OR.TYPE.EQ.TNB3C6.OR.TYPE.EQ.TNB3W6) THEN
            IF((TYPE.EQ.TNB3B6.AND.IAND(NBROPT(GIND),BOXACT).EQ.0).OR.
     *        (TYPE.EQ.TNB3C6.AND.IAND(NBROPT(GIND),CMBACT).EQ.0).OR.
     *        (TYPE.EQ.TNB3W6.AND.IAND(NBROPT(GIND),WHLACT).EQ.0))
     *        TRABUF(TERR)=SYNT
	    IF(TYPE.EQ.TNB3C6) THEN
	      AMT=TRABUF(TWNAMT1+OFF*3)
	      TRABUF(TWNAMT1+OFF*3)=AMT/2
	      IF(TRABUF(TWNAMT1+OFF*3)*2.NE.AMT) THEN
	        TRABUF(TERR)=INVL
	        RETURN
	      ENDIF
	    ENDIF
	    IF(DIG(1).GT.9.OR.DIG(2).GT.9.OR.
     *	       DIG(3).GT.9) TRABUF(TERR)=SYNT
	    NUM=DIG(1)*100+DIG(2)*10+DIG(3)
	    IF(NUM.GT.999) NUM=0
	    PTYPE=P3OFF(NUM+1,BOXPOL)
	    IF(PTYPE.NE.0) THEN
	      IF(TYPE.EQ.TNB3C6) PTYPE=PTYPE+2
	      IF(TYPE.EQ.TNB3W6) PTYPE=PTYPE+4
	    ELSE
	      TRABUF(TERR)=SYNT
	    ENDIF
	    TRABUF(TWNNUM1+OFF*3)=NUM
	    TRABUF(TWNPOL1+OFF*3)=PTYPE
	    GOTO 90
	  ENDIF
	  TRABUF(TERR)=SYNT
	ENDIF
C
C
	IF(TRABUF(TWNTYP).EQ.NB4TYP) THEN
	  IF(TYPE.EQ.TNB4F2) THEN
	    IF(IAND(NBROPT(GIND),PARACT).EQ.0) TRABUF(TERR)=SYNT
	    IF(DIG(3).EQ.15.AND.DIG(4).EQ.15) THEN
	      IF(DIG(1).GT.9.OR.DIG(2).GT.9) TRABUF(TERR)=SYNT
	      TRABUF(TWNPOL1+OFF*3)=TNB4F2
	      TRABUF(TWNNUM1+OFF*3)=DIG(1)*10+DIG(2)
	    ENDIF
	    IF(DIG(1).EQ.15.AND.DIG(2).EQ.15) THEN
	      IF(DIG(3).GT.9.OR.DIG(4).GT.9) TRABUF(TERR)=SYNT
	      TRABUF(TWNPOL1+OFF*3)=TNB4B2
	      TRABUF(TWNNUM1+OFF*3)=DIG(3)*10+DIG(4)
	    ENDIF
	    IF(DIG(1).EQ.15.AND.DIG(4).EQ.15) THEN
	      IF(DIG(2).GT.9.OR.DIG(3).GT.9) TRABUF(TERR)=SYNT
	      TRABUF(TWNPOL1+OFF*3)=TNB4M2
	      TRABUF(TWNNUM1+OFF*3)=DIG(2)*10+DIG(3)
	    ENDIF
	    IF(TRABUF(TWNPOL1+OFF*3).EQ.0) TRABUF(TERR)=SYNT
	    GOTO 90
	  ENDIF
C
C
	  IF(TYPE.EQ.TNB4ST) THEN
	    IF(DIG(1).GT.9.OR.DIG(2).GT.9.OR.
     *	       DIG(3).GT.9.OR.DIG(4).GT.9) TRABUF(TERR)=SYNT
	    TRABUF(TWNPOL1+OFF*3)=TNB4ST
          TRABUF(TWNNUM1+OFF*3)=DIG(1)*1000+DIG(2)*100+DIG(3)*10+DIG(4)
	    GOTO 90
	  ENDIF
C
C
	  IF(TYPE.EQ.TNB4B24.OR.TYPE.EQ.TNB4C24.OR.TYPE.EQ.TNB4W24)THEN
            IF((TYPE.EQ.TNB4B24.AND.IAND(NBROPT(GIND),BOXACT).EQ.0).OR.
     *         (TYPE.EQ.TNB4C24.AND.IAND(NBROPT(GIND),CMBACT).EQ.0).OR.
     *         (TYPE.EQ.TNB4W24.AND.IAND(NBROPT(GIND),WHLACT).EQ.0))
     *         TRABUF(TERR)=SYNT
            IF(TYPE.EQ.TNB4C24) THEN
              AMT=TRABUF(TWNAMT1+OFF*3)
              TRABUF(TWNAMT1+OFF*3)=AMT/2
              IF(TRABUF(TWNAMT1+OFF*3)*2.NE.AMT) THEN
                TRABUF(TERR)=INVL
                RETURN
              ENDIF
            ENDIF
	    IF(DIG(1).GT.9.OR.DIG(2).GT.9.OR.
     *	       DIG(3).GT.9.OR.DIG(4).GT.9) TRABUF(TERR)=SYNT
	    NUM=DIG(1)*1000+DIG(2)*100+DIG(3)*10+DIG(4)
	    IF(NUM.GT.9999) NUM=0
	    PTYPE=P4OFF(NUM+1,BOXPOL)
	    IF(PTYPE.NE.0) THEN
	      IF(TYPE.EQ.TNB4C24) PTYPE=PTYPE+4
	      IF(TYPE.EQ.TNB4W24) PTYPE=PTYPE+8
	    ELSE
	      TRABUF(TERR)=SYNT
	    ENDIF
	    TRABUF(TWNNUM1+OFF*3)=NUM
	    TRABUF(TWNPOL1+OFF*3)=PTYPE
	    GOTO 90
	  ENDIF
	  TRABUF(TERR)=SYNT
	ENDIF
	TRABUF(TERR)=SYNT
90	CONTINUE
	IF(TRABUF(TERR).EQ.SYNT) THEN
	  SYNTERRCOD=90
	  TRABUF(TERR)=SYNT
	  RETURN
	ENDIF
100	CONTINUE
C	
C CALCULATE TOTAL AMOUNT
C
	DO 200 I=0,TRABUF(TWNBET)-1
	PTYPE=TRABUF(TWNPOL1+I*3)
	IF(TRABUF(TWNTYP).EQ.NB3TYP)
     *	  TRABUF(TWNAMT1+I*3)=TRABUF(TWNAMT1+I*3)*P3MULT(PTYPE)
	IF(TRABUF(TWNTYP).EQ.NB4TYP)
     *	  TRABUF(TWNAMT1+I*3)=TRABUF(TWNAMT1+I*3)*P4MULT(PTYPE)
	TRABUF(TWAMT)=TRABUF(TWAMT)+TRABUF(TWNAMT1+I*3)
200	CONTINUE
	TRABUF(TWTOT)=TRABUF(TWAMT)*TRABUF(TWDUR)
C
C GET START/END DRAWS
C
	TRABUF(TFIL)=EARLY
	IF(NBRSTS(GIND).GE.GAMBFD) TRABUF(TFIL)=LATE
	TRABUF(TWBEG)=NBRDRW(GIND)
	IF(TRABUF(TFIL).EQ.LATE) TRABUF(TWBEG)=TRABUF(TWBEG)+1
	TRABUF(TWEND)=TRABUF(TWBEG)+TRABUF(TWDUR)-1
C
C
        TRABUF(TWTKC)=TKTCHG(TRABUF(TGAM))
	TRABUF(TWTOT)=TRABUF(TWTOT)+TRABUF(TWTKC)
	TRABUF(TSTAT)=GOOD
C
	RETURN
C
	END
