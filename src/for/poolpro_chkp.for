C
C SUBROUTINE POOLPRO_CHKP
C $Log:   GXAFXT:[GOLS]POOLPRO_CHKP.FOV  $
C  
C     Rev 1.0   17 Apr 1996 14:25:32   HXK
C  Release of Finland for X.25, Telephone Betting, Instant Pass Thru Phase 1
C  
C     Rev 1.0   21 Jan 1993 17:18:46   DAB
C  Initial Release
C  Based on Netherlands Bible, 12/92, and Comm 1/93 update
C  DEC Baseline
C
C ** Source - poolpro.for **
C
C
C====================================================================
C CHECKPOINT 'LTOPOL' COMMON
C=======OPTIONS /CHECK=NOOVERFLOW
	SUBROUTINE POOLPRO_CHKP (FDB)
	IMPLICIT NONE
C
        INTEGER*4   FDB(*)
C
	INCLUDE 'INCLIB:SYSPARAM.DEF'
	INCLUDE 'INCLIB:SYSEXTRN.DEF'
C
	INCLUDE 'INCLIB:GLOBAL.DEF'
	INCLUDE 'INCLIB:POOLLTO.DEF'
	INCLUDE 'INCLIB:LTOPOL.DEF'
        INCLUDE 'INCLIB:CHKPNT.DEF'
        INCLUDE 'INCLIB:CONCOM.DEF'
        INCLUDE 'INCLIB:TASKID.DEF'
C
        INTEGER*4 CFDB(7),CFILES(0:4)
        DATA CFILES/CP0,CP1,CP2,CP3,CP4/
C
        INTEGER*4 FIRST, SFIL, ST, FILE
C
        FILE=0
        IF(LCHKFIL.GT.0) FILE=LCHKFIL
        SFIL=CFILES(FILE)
        CALL OPENQW(3,SFNAMES(1,SFIL),4,0,0,ST)
        IF(ST.NE.0) THEN
	    CALL POOL_FILERR (SFIL, 3, ST, 0)
	    GOTO 9000
        ENDIF
	CALL IOQINIT(CFDB,3,CHKSEC*256)
C
C
C READ AND WRITE HEADER RECORD TO INVALIDATE THE CHECKPOINT
C
        CALL READQW(CFDB,1,CHKHEADER,ST)
        IF(ST.NE.0) THEN
	  CALL POOL_FILERR (SFIL, 4, ST, 1)
          GOTO 9000
        ENDIF
        CHKHEADER(CHKPNTDAY)=0
        CALL WRITEQW(CFDB,1,CHKHEADER,ST)
        IF(ST.NE.0) THEN
	  CALL POOL_FILERR (SFIL, 5, ST, 1)
          GOTO 9000
        ENDIF
C
C
D	TYPE *, IAM(), 'DOING PARALLEL WRITE OF ',LTOPOL_BYTES,' BYTES'
D	CALL LIB$SHOW_TIMER()
	FIRST=(CHKSEC*256/SECSIZE)+1
	IF(LCHKFIL.LT.0) FIRST=CHKHEADER(CHKGAMLEN)*CHKSEC*256/SECSIZE+1
C
C       INITIATE I/O TO THE POOLS FILE (DATA TO BE USED BY OTHER PROGRAMS)
C
        CALL WRITEQIONW(FDB,1,LTOPOL_SPACE,LTOPOL_BYTES,ST)
 	CALL WRITEQIO(CFDB,FIRST,LTOPOL_SPACE,LTOPOL_BYTES,ST)
        IF (ST .NE. 0) THEN
	  CALL POOL_FILERR (SFIL, 5, ST, FIRST)
        ENDIF
        CALL IOQSTAT(FDB,ST)
        IF (ST .NE. 0) THEN
	  CALL POOL_FILERR (LPR, 5, ST, 1)
        ENDIF
D	CALL LIB$SHOW_TIMER()
C
9000	CONTINUE
        CALL CLOSEQFIL(CFDB)
 	END
